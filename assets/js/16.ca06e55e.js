(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{648:function(s,a,n){"use strict";n.r(a);var t=n(5),e=Object(t.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[s._v("说明")]),s._v(" "),n("p",[s._v("​\tROS2主要针对机器人设计的一套系统，可以把机器人看作由多个节点组成，比如传感有多个节点，执行有多个节点，后续如果做机器人开发ROS2是最好的选择。")]),s._v(" "),n("p",[n("a",{attrs:{href:"www.deep-diary.com"}},[s._v("点击免费观看教学视频")])])]),s._v(" "),n("h1",{attrs:{id:"ros2"}},[s._v("ROS2")]),s._v(" "),n("h2",{attrs:{id:"ros2-and-ros"}},[s._v("ros2 and ros")]),s._v(" "),n("p",[n("img",{attrs:{src:"https://deep-diary.oss-cn-hangzhou.aliyuncs.com/blog/image-20230226102741700.png",alt:"image-20230226102741700"}})]),s._v(" "),n("p",[s._v("编程方式不同")]),s._v(" "),n("p",[s._v("ros1基于函数，ros2基于类")]),s._v(" "),n("h2",{attrs:{id:"ros2-installation"}},[s._v("ros2 installation")]),s._v(" "),n("p",[s._v("vmware")]),s._v(" "),n("p",[n("a",{attrs:{href:"https://www.vmware.com/products/workstation-pro/workstation-pro-evaluation.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("Download VMware Workstation Pro"),n("OutboundLink")],1)]),s._v(" "),n("p",[s._v("许可证密钥")]),s._v(" "),n("p",[s._v("JU090-6039P-08409-8J0QH-2YR7F")]),s._v(" "),n("p",[s._v("Ubuntu 22.04 LTS")]),s._v(" "),n("p",[n("a",{attrs:{href:"https://ubuntu.com/download/desktop/thank-you?version=22.04.2&architecture=amd64",target:"_blank",rel:"noopener noreferrer"}},[s._v("Thank you for downloading Ubuntu Desktop | Ubuntu"),n("OutboundLink")],1)]),s._v(" "),n("p",[s._v("安装虚拟机的时候，发现C盘不够了，就准备删掉一些东西")]),s._v(" "),n("p",[n("img",{attrs:{src:"https://deep-diary.oss-cn-hangzhou.aliyuncs.com/blog/image-20230226110905967.png",alt:"image-20230226110905967"}})]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("如果要删除hiberfil.sys文件，不再使用休眠功能，只需在cmd 里面打如下命令\n\nPowercfg -h off\n\nHibernate.sys文件就消失了。下次如果还是想要使用休眠功能，可以打如下命令开启\n\nPowercfg -h on\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("p",[n("a",{attrs:{href:"https://www.guyuehome.com/38278",target:"_blank",rel:"noopener noreferrer"}},[s._v("《ROS2入门21讲图文教程 | 3、ROS2安装方法》 - 古月居 (guyuehome.com)"),n("OutboundLink")],1)]),s._v(" "),n("h2",{attrs:{id:"ros2-command"}},[s._v("ros2 command")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("  ros2 run demo_nodes_py listener\n    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("  ros2 "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("node")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("  ros2 "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("node")]),s._v(" list\n    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("  ros2 "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("node")]),s._v(" info\n    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("  ros2 "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("node")]),s._v(" info /turtlesim \n    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("  ros2 topic list\n    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v("  ros2 topic "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" /turtle1/pose \n    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v("  ros2 topic pub --rate "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" /turtle1/cmd_vel geometry_msgs/msg/Twist "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{linear: {x: 2.0,y: 0.0,z: 0.0},angular: {x: 0.0,y: 0.0,z: 1.8}}"')]),s._v("\n   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v("  ros2 bag record /turtle1/cmd_vel  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  record the history")]),s._v("\n   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\n   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v("  ros2 bag play rosbag2_2023_02_27-07_39_37/   "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  play the history")]),s._v("\n   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("history")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])]),n("h2",{attrs:{id:"ros2-environment"}},[s._v("ros2 environment")]),s._v(" "),n("h3",{attrs:{id:"git"}},[s._v("git")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h3",{attrs:{id:"vscode"}},[s._v("vscode")]),s._v(" "),n("p",[n("strong",[s._v("download:")])]),s._v(" "),n("p",[s._v("https://code.visualstudio.com/docs/?dv=linux64_deb")]),s._v(" "),n("p",[n("strong",[s._v("install software")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("blue@blue-pc:~/Downloads$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" dpkg -i code_1.75.1-1675893397_amd64.deb\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[n("strong",[s._v("install plug-in")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("python\nC/c++\nCmake\nicorns\nros\nmsg\nURDF\nIntelliCode\nmarkdown\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("h3",{attrs:{id:"download-the-demo-code"}},[s._v("download the demo code")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" clone https://gitee.com/guyuehome/ros2_21_tutorials.git\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h2",{attrs:{id:"workspace-and-package"}},[s._v("workspace and package")]),s._v(" "),n("ul",[n("li",[n("p",[n("strong",[s._v("src，代码空间")]),s._v("，未来编写的代码、脚本，都需要人为的放置到这里；")])]),s._v(" "),n("li",[n("p",[n("strong",[s._v("build，编译空间")]),s._v("，保存编译过程中产生的中间文件；")])]),s._v(" "),n("li",[n("p",[n("strong",[s._v("install，安装空间")]),s._v("，放置编译得到的可执行文件和脚本；")])]),s._v(" "),n("li",[n("p",[n("strong",[s._v("log，日志空间")]),s._v("，编译和运行过程中，保存各种警告、错误、信息等日志。")])])]),s._v(" "),n("p",[s._v("总体来讲，这四个空间的文件夹，我们绝大部分操作都是在src中进行的，编译成功后，就会执行install里边的结果，build和log两个文件夹用的很少。")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" clone https://gitee.com/guyuehome/ros2_21_tutorials.git\n   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("32")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" python3-pip\n   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("33")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" pip "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" rosdepc\n   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("34")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" rosdepc init "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v(" rosdepc update  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 貌似必须要进入src目录")]),s._v("\n   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("78")]),s._v("  rosdepc "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -i --from-path src --rosdistro humble -y\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("h3",{attrs:{id:"install-the-builder-python3-colcon-ros"}},[s._v("install the builder:  python3-colcon-ros")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" python3-colcon-ros\ncolcon build  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 对工作空间进行编译")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[s._v("编译成功后，就可以在工作空间中看到自动生产的build、log、install文件夹了。")]),s._v(" "),n("h3",{attrs:{id:"setting-environment-variables"}},[s._v("Setting environment variables")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("$ "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" install/local_setup.sh "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 仅在当前终端生效")]),s._v("\n$ "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('" source ~/dev_ws/install/local_setup.sh"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" ~/.bashrc "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 所有终端均生效")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("h3",{attrs:{id:"create-package"}},[s._v("create package")]),s._v(" "),n("p",[s._v("如何在ROS2中创建一个功能包呢？我们可以使用这个指令：")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("$ ros2 pkg create --build-type "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("build-type"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("package_name"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("ros2命令中：")]),s._v(" "),n("ul",[n("li",[n("strong",[s._v("pkg")]),s._v("：表示功能包相关的功能；")]),s._v(" "),n("li",[n("strong",[s._v("create")]),s._v("：表示创建功能包；")]),s._v(" "),n("li",[n("strong",[s._v("build-type")]),s._v("：表示新创建的功能包是C++还是Python的，如果使用C++或者C，那这里就跟ament_cmake，如果使用Python，就跟ament_python；")]),s._v(" "),n("li",[n("strong",[s._v("package_name")]),s._v("：新建功能包的名字。")])]),s._v(" "),n("p",[s._v("比如在终端中分别创建C++和Python版本的功能包：")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("$ "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" ~/dev_ws/src\n$ ros2 pkg create --build-type ament_cmake learning_pkg_c               "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# C++")]),s._v("\n$ ros2 pkg create --build-type ament_python learning_pkg_python "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Python")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("h3",{attrs:{id:"build-the-package"}},[s._v("build the package")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("$ colcon build   "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 编译工作空间所有功能包, 需要在根目录上运行")]),s._v("\n$ "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" install/local_setup.bash\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("h3",{attrs:{id:"python功能包"}},[n("strong",[s._v("Python功能包")])]),s._v(" "),n("p",[s._v("C++功能包需要将源码编译成可执行文件，但是Python语言是解析型的，不需要编译，所以会有一些不同，但也会有这两个文件："),n("strong",[s._v("package.xml")]),s._v("和"),n("strong",[s._v("setup.py")]),s._v("。")]),s._v(" "),n("p",[s._v("package.xml文件的主要内容和C++版本功能包一样，包含功能包的版权描述，和各种依赖的声明。")]),s._v(" "),n("h2",{attrs:{id:"node"}},[s._v("node")]),s._v(" "),n("p",[n("img",{attrs:{src:"https://deep-diary.oss-cn-hangzhou.aliyuncs.com/blog/image-20220526231417594.png",alt:"image-20220526231417594"}})]),s._v(" "),n("h3",{attrs:{id:"run"}},[s._v("run")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("$ ros2 run learning_node node_helloworld\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#!/usr/bin/env python3")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -*- coding: utf-8 -*-")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[s._v('"""\n@作者: 古月居(www.guyuehome.com)\n@说明: ROS2节点示例-发布“Hello World”日志信息, 使用面向对象的实现方式\n"""')]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" rclpy                                     "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ROS2 Python接口库")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" rclpy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("node "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" Node                      "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ROS2 节点类")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" time\n\n"),n("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[s._v('"""\n创建一个HelloWorld节点, 初始化时输出“hello world”日志\n"""')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HelloWorldNode")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Node"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("__init__")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("super")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("__init__"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                     "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ROS2节点父类初始化")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" rclpy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ok"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("                          "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ROS2系统是否正常运行")]),s._v("\n            self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("get_logger"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("info"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Hello World"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ROS2日志输出")]),s._v("\n            time"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sleep"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.5")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 休眠控制循环时间")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("args"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("None")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("                               "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ROS2节点主入口main函数")]),s._v("\n    rclpy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("init"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("args"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("args"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                          "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ROS2 Python接口初始化")]),s._v("\n    node "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" HelloWorldNode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node_helloworld_class"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建ROS2节点对象并进行初始化")]),s._v("\n    rclpy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("spin"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("node"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                               "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 循环等待ROS2退出")]),s._v("\n    node"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("destroy_node"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 销毁节点对象")]),s._v("\n    rclpy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("shutdown"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                               "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关闭ROS2 Python接口")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br")])]),n("p",[s._v("完成代码的编写后需要设置功能包的编译选项，让系统知道Python程序的入口，打开功能包的setup.py文件，加入如下入口点的配置：")]),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[s._v("    entry_points"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'console_scripts'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n         "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'node_helloworld       = learning_node.node_helloworld:main'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n         "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'node_helloworld_class = learning_node.node_helloworld_class:main'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("h3",{attrs:{id:"节点命令的常用操作如下"}},[s._v("节点命令的常用操作如下：")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("$ ros2 "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("node")]),s._v(" list               "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看节点列表")]),s._v("\n$ ros2 "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("node")]),s._v(" info "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("node_name"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看节点信息")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("h2",{attrs:{id:"topic"}},[s._v("topic")]),s._v(" "),n("p",[s._v("节点实现了机器人各种各样的功能，但这些功能并不是独立的，之间会有千丝万缕的联系，其中最重要的一种联系方式就是话题，它是"),n("strong",[s._v("节点间传递数据的桥梁")]),s._v("。")]),s._v(" "),n("h3",{attrs:{id:"发布-订阅模型"}},[n("strong",[s._v("发布/订阅模型")])]),s._v(" "),n("p",[s._v("从话题本身的实现角度来看，使用了基于DDS的"),n("strong",[s._v("发布/订阅模型")]),s._v("，什么叫发布和订阅呢？")]),s._v(" "),n("p",[n("img",{attrs:{src:"https://deep-diary.oss-cn-hangzhou.aliyuncs.com/blog/image8.gif",alt:"image8"}})]),s._v(" "),n("p",[s._v("话题数据传输的特性是从一个节点到另外一个节点，发送数据的对象称之为"),n("strong",[s._v("发布者")]),s._v("，接收数据的对象称之为"),n("strong",[s._v("订阅者")]),s._v("，每一个话题都需要有一个名字，传输的数据也需要有固定的数据类型。")]),s._v(" "),n("h3",{attrs:{id:"多对多通信"}},[n("strong",[s._v("多对多通信")])]),s._v(" "),n("p",[n("img",{attrs:{src:"https://book.guyuehome.com/ROS2/2.%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5/image/2.4_%E8%AF%9D%E9%A2%98/image9.gif",alt:"image9"}})]),s._v(" "),n("h3",{attrs:{id:"异步通信"}},[n("strong",[s._v("异步通信")])]),s._v(" "),n("p",[s._v("话题通信还有一个特性，那就是异步，这个词可能有同学是第一次听说？所谓异步，只要是指发布者发出数据后，并不知道订阅者什么时候可以收到，类似古月居公众号发布一篇文章，你什么时候阅读的，古月居根本不知道，报社发出一份报纸，你什么时候收到，报社也是不知道的。这就叫做异步。")]),s._v(" "),n("p",[s._v("异步的特性也让话题更适合用于一些周期发布的数据，比如传感器的数据，运动控制的指令等等，如果某些逻辑性较强的指令，比如修改某一个参数，用话题传输就不太合适了。")]),s._v(" "),n("h3",{attrs:{id:"消息接口"}},[n("strong",[s._v("消息接口")])]),s._v(" "),n("p",[s._v("最后，既然是数据传输，发布者和订阅者就得统一数据的描述格式，不能一个说英文，一个理解成了中文。在ROS中，话题通信数据的描述格式称之为消息，对应编程语言中数据结构的概念。比如这里的一个图像数据，就会包含图像的长宽像素值、每个像素的RGB等等，在ROS中都有标准定义。")]),s._v(" "),n("p",[n("strong",[s._v("消息是ROS中的一种接口定义方式")]),s._v("，与编程语言无关，我们也可以通过**.msg**后缀的文件自行定义，有了这样的接口，各种节点就像积木块一样，通过各种各样的接口进行拼接，组成复杂的机器人系统。")]),s._v(" "),n("h3",{attrs:{id:"发布者代码解析"}},[n("strong",[s._v("发布者代码解析")])]),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#!/usr/bin/env python3")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -*- coding: utf-8 -*-")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[s._v('"""\n@作者: 古月居(www.guyuehome.com)\n@说明: ROS2话题示例-发布“Hello World”话题\n"""')]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" rclpy                                     "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ROS2 Python接口库")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" rclpy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("node "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" Node                      "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ROS2 节点类")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" std_msgs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("msg "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" String                  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 字符串消息类型")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[s._v('"""\n创建一个发布者节点\n"""')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("PublisherNode")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Node"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("__init__")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("super")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("__init__"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                                    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ROS2节点父类初始化")]),s._v("\n        self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pub "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("create_publisher"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("String"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"chatter"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建发布者对象（消息类型、话题名、队列长度）")]),s._v("\n        self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("timer "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("create_timer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.5")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("timer_callback"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建一个定时器（单位为秒的周期，定时执行的回调函数）")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("timer_callback")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("                                     "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建定时器周期执行的回调函数")]),s._v("\n        msg "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" String"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                                            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建一个String类型的消息对象")]),s._v("\n        msg"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("data "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Hello World'")]),s._v("                                  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 填充消息对象中的消息数据")]),s._v("\n        self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pub"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("publish"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("msg"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                                     "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 发布话题消息")]),s._v("\n        self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("get_logger"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("info"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Publishing: \"%s\"'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v(" msg"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("     "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 输出日志信息，提示已经完成话题发布")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("args"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("None")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("                                 "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ROS2节点主入口main函数")]),s._v("\n    rclpy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("init"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("args"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("args"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ROS2 Python接口初始化")]),s._v("\n    node "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" PublisherNode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"topic_helloworld_pub"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("     "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建ROS2节点对象并进行初始化")]),s._v("\n    rclpy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("spin"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("node"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                                 "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 循环等待ROS2退出")]),s._v("\n    node"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("destroy_node"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                              "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 销毁节点对象")]),s._v("\n    rclpy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("shutdown"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                                 "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关闭ROS2 Python接口")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br")])]),n("p",[s._v("完成代码的编写后需要设置功能包的编译选项，让系统知道Python程序的入口，打开功能包的setup.py文件，加入如下入口点的配置：")]),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[s._v("    entry_points"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'console_scripts'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n         "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'topic_helloworld_pub  = learning_topic.topic_helloworld_pub:main'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("h4",{attrs:{id:"流程总结"}},[s._v("流程总结")]),s._v(" "),n("p",[s._v("对以上程序进行分析，如果我们想要实现一个发布者，流程如下：")]),s._v(" "),n("ul",[n("li",[s._v("编程接口初始化")]),s._v(" "),n("li",[s._v("创建节点并初始化")]),s._v(" "),n("li",[s._v("创建发布者对象")]),s._v(" "),n("li",[s._v("创建并填充话题消息")]),s._v(" "),n("li",[s._v("发布话题消息")]),s._v(" "),n("li",[s._v("销毁节点并关闭接口")])]),s._v(" "),n("h3",{attrs:{id:"订阅者代码解析"}},[n("strong",[s._v("订阅者代码解析")])]),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#!/usr/bin/env python3")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -*- coding: utf-8 -*-")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[s._v('"""\n@作者: 古月居(www.guyuehome.com)\n@说明: ROS2话题示例-订阅“Hello World”话题消息\n"""')]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" rclpy                      "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ROS2 Python接口库")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" rclpy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("node   "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" Node     "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ROS2 节点类")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" std_msgs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("msg "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" String   "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ROS2标准定义的String消息")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[s._v('"""\n创建一个订阅者节点\n"""')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SubscriberNode")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Node"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("__init__")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("super")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("__init__"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                             "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ROS2节点父类初始化")]),s._v("\n        self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sub "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("create_subscription"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\\\n            String"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"chatter"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("listener_callback"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建订阅者对象（消息类型、话题名、订阅者回调函数、队列长度）")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("listener_callback")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" msg"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("                      "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建回调函数，执行收到话题消息后对数据的处理")]),s._v("\n        self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("get_logger"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("info"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'I heard: \"%s\"'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v(" msg"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 输出日志信息，提示订阅收到的话题消息")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("args"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("None")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("                               "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ROS2节点主入口main函数")]),s._v("\n    rclpy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("init"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("args"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("args"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                          "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ROS2 Python接口初始化")]),s._v("\n    node "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" SubscriberNode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"topic_helloworld_sub"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建ROS2节点对象并进行初始化")]),s._v("\n    rclpy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("spin"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("node"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                               "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 循环等待ROS2退出")]),s._v("\n    node"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("destroy_node"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 销毁节点对象")]),s._v("\n    rclpy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("shutdown"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                               "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关闭ROS2 Python接口")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br")])]),n("p",[s._v("完成代码的编写后需要设置功能包的编译选项，让系统知道Python程序的入口，打开功能包的setup.py文件，加入如下入口点的配置：")]),s._v(" "),n("div",{staticClass:"language-markup line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-markup"}},[n("code",[s._v("    entry_points={\n        'console_scripts': [\n         'topic_helloworld_pub  = learning_topic.topic_helloworld_pub:main',\n         'topic_helloworld_sub  = learning_topic.topic_helloworld_sub:main',\n        ],\n    },\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("h4",{attrs:{id:"流程总结-2"}},[s._v("流程总结")]),s._v(" "),n("p",[s._v("对以上程序进行分析，如果我们想要实现一个订阅者，流程如下：")]),s._v(" "),n("ul",[n("li",[s._v("编程接口初始化")]),s._v(" "),n("li",[s._v("创建节点并初始化")]),s._v(" "),n("li",[s._v("创建订阅者对象")]),s._v(" "),n("li",[s._v("回调函数处理话题数据")]),s._v(" "),n("li",[s._v("销毁节点并关闭接口")])]),s._v(" "),n("h3",{attrs:{id:"usb相机驱动"}},[s._v("USB相机驱动")]),s._v(" "),n("p",[s._v("常用的usb相机驱动一般都是通用的，ROS中也集成了usb相机的标准驱动，我们只需要通过这样一行指令，就可以安装好，无论你用什么样的相机，只要符合usb接口协议，就可以直接使用ROS中的相机驱动节点，发布标准的图像话题了。")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" ros-humble-usb-cam\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[s._v("这样，我们的代码又得到了进一步精简，刚才自己写的图像发布节点换成了这样一句指令，视觉识别节点不需要做任何变化。")]),s._v(" "),n("div",{staticClass:"language-markup line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-markup"}},[n("code",[s._v("$ ros2 run usb_cam usb_cam_node_exe\n$ ros2 run learning_topic topic_webcam_sub\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[n("a",{attrs:{href:"https://book.guyuehome.com/ROS2/2.%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5/image/2.4_%E8%AF%9D%E9%A2%98/image-20220527231048652.png",target:"_blank",rel:"noopener noreferrer"}},[n("img",{attrs:{src:"https://deep-diary.oss-cn-hangzhou.aliyuncs.com/blog/image-20220527231048652.png",alt:"image-20220527231048652"}}),n("OutboundLink")],1)]),s._v(" "),n("hr"),s._v(" "),n("h3",{attrs:{id:"话题命令行操作"}},[n("strong",[s._v("话题命令行操作")])]),s._v(" "),n("p",[s._v("话题命令的常用操作如下：")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("\n$ ros2 topic list                "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看话题列表")]),s._v("\n$ ros2 topic info "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("topic_name"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看话题信息")]),s._v("\n$ ros2 topic hz "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("topic_name"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("     "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看话题发布频率")]),s._v("\n$ ros2 topic bw "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("topic_name"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("     "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看话题传输带宽")]),s._v("\n$ ros2 topic "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("topic_name"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看话题数据")]),s._v("\n$ ros2 topic pub "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("topic_name"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("msg_type"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("msg_data"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 发布话题消息")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("h2",{attrs:{id:"service"}},[s._v("service")]),s._v(" "),n("p",[s._v("话题通信可以实现多个ROS节点之间数据的单向传输，使用这种异步通信机制，发布者无法准确知道订阅者是否收到消息，本讲我们将一起学习ROS另外一种常用的通信方法——"),n("strong",[s._v("服务")]),s._v("，可以实现类似"),n("strong",[s._v("你问我答的同步通信")]),s._v("效果。")]),s._v(" "),n("h3",{attrs:{id:"通信模型"}},[n("strong",[s._v("通信模型")])]),s._v(" "),n("p",[s._v("在之前的课程中，我们通过一个节点驱动相机，发布图像话题，另外一个节点订阅图像话题，并实现对其中红色物体的识别，此时我们可以按照图像识别的频率，周期得到物体的位置。")]),s._v(" "),n("p",[n("img",{attrs:{src:"https://deep-diary.oss-cn-hangzhou.aliyuncs.com/blog/image-20220527232959464.png",alt:"image-20220527232959464"}})]),s._v(" "),n("p",[s._v("这样的通信模型和话题单向传输有所不同，变成了发送一个请求，反馈一个应答的形式，好像是你问我答一样，这种通信机制在ROS中成为"),n("strong",[s._v("服务，Service")]),s._v("。")]),s._v(" "),n("h3",{attrs:{id:"客户端-服务器模型"}},[n("strong",[s._v("客户端/服务器模型")])]),s._v(" "),n("p",[s._v("从服务的实现机制上来看，这种你问我答的形式叫做"),n("strong",[s._v("客户端/服务器模型")]),s._v("，简称为CS模型，客户端在需要某些数据的时候，针对某个具体的服务，发送请求信息，服务器端收到请求之后，就会进行处理并反馈应答信息。")]),s._v(" "),n("p",[n("a",{attrs:{href:"https://book.guyuehome.com/ROS2/2.%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5/image/2.5_%E6%9C%8D%E5%8A%A1/image8.gif",target:"_blank",rel:"noopener noreferrer"}},[n("img",{attrs:{src:"https://deep-diary.oss-cn-hangzhou.aliyuncs.com/blog/image8.gif",alt:"image8"}}),n("OutboundLink")],1)]),s._v(" "),n("p",[s._v("这种通信机制在生活中也很常见，比如我们经常浏览的各种网页，此时你的电脑浏览器就是客户端，通过域名或者各种操作，向网站服务器发送请求，服务器收到之后返回需要展现的页面数据。")]),s._v(" "),n("h3",{attrs:{id:"同步通信"}},[n("strong",[s._v("同步通信")])]),s._v(" "),n("p",[s._v("这个过程一般要求越快越好，假设服务器半天没有反应，你的浏览器一直转圈圈，那有可能是服务器宕机了，或者是网络不好，所以相比话题通信，在服务通信中，客户端可以通过接收到的应答信息，判断服务器端的状态，我们也称之为同步通信。")]),s._v(" "),n("h3",{attrs:{id:"一对多通信"}},[n("strong",[s._v("一对多通信")])]),s._v(" "),n("p",[n("a",{attrs:{href:"https://book.guyuehome.com/ROS2/2.%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5/image/2.5_%E6%9C%8D%E5%8A%A1/image9.gif",target:"_blank",rel:"noopener noreferrer"}},[n("img",{attrs:{src:"https://deep-diary.oss-cn-hangzhou.aliyuncs.com/blog/image9.gif",alt:"image9"}}),n("OutboundLink")],1)]),s._v(" "),n("p",[s._v("比如古月居这个网站，服务器是唯一存在的，并没有多个完全一样的古月居网站，但是可以访问古月居网站的客户端是不唯一的，大家每一个人都可以看到同样的界面。所以服务通信模型中，服务器端唯一，但客户端可以不唯一。")]),s._v(" "),n("h3",{attrs:{id:"服务接口"}},[n("strong",[s._v("服务接口")])]),s._v(" "),n("p",[s._v("和话题通信类似，服务通信的核心还是要传递数据，数据变成了两个部分，一个"),n("strong",[s._v("请求的数据")]),s._v("，比如请求苹果位置的命令，还有一个"),n("strong",[s._v("反馈的数据")]),s._v("，比如反馈苹果坐标位置的数据，这些数据和话题消息一样，在ROS中也是要标准定义的，话题使用.msg文件定义，服务使用的是.srv文件定义，后续我们会给大家介绍定义的方法。")]),s._v(" "),n("h3",{attrs:{id:"客户端代码解析"}},[n("strong",[s._v("客户端代码解析")])]),s._v(" "),n("p",[s._v("我们来看下客户端的实现方法。")]),s._v(" "),n("h4",{attrs:{id:"程序实现"}},[n("strong",[s._v("程序实现")])]),s._v(" "),n("p",[s._v("learning_service/service_adder_client.py")]),s._v(" "),n("div",{staticClass:"language-markup line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-markup"}},[n("code",[s._v("#!/usr/bin/env python3\n# -*- coding: utf-8 -*-\n\n\"\"\"\n@作者: 古月居(www.guyuehome.com)\n@说明: ROS2服务示例-发送两个加数，请求加法器计算\n\"\"\"\n\nimport sys\n\nimport rclpy                                  # ROS2 Python接口库\nfrom rclpy.node   import Node                 # ROS2 节点类\nfrom learning_interface.srv import AddTwoInts # 自定义的服务接口\n\nclass adderClient(Node):\n    def __init__(self, name):\n        super().__init__(name)                                       # ROS2节点父类初始化\n        self.client = self.create_client(AddTwoInts, 'add_two_ints') # 创建服务客户端对象（服务接口类型，服务名）\n        while not self.client.wait_for_service(timeout_sec=1.0):     # 循环等待服务器端成功启动\n            self.get_logger().info('service not available, waiting again...') \n        self.request = AddTwoInts.Request()                          # 创建服务请求的数据对象\n\n    def send_request(self):                                          # 创建一个发送服务请求的函数\n        self.request.a = int(sys.argv[1])\n        self.request.b = int(sys.argv[2])\n        self.future = self.client.call_async(self.request)           # 异步方式发送服务请求\n\ndef main(args=None):\n    rclpy.init(args=args)                        # ROS2 Python接口初始化\n    node = adderClient(\"service_adder_client\")   # 创建ROS2节点对象并进行初始化\n    node.send_request()                          # 发送服务请求\n\n    while rclpy.ok():                            # ROS2系统正常运行\n        rclpy.spin_once(node)                    # 循环执行一次节点\n\n        if node.future.done():                   # 数据是否处理完成\n            try:\n                response = node.future.result()  # 接收服务器端的反馈数据\n            except Exception as e:\n                node.get_logger().info(\n                    'Service call failed %r' % (e,))\n            else:\n                node.get_logger().info(          # 将收到的反馈信息打印输出\n                    'Result of add_two_ints: for %d + %d = %d' % \n                    (node.request.a, node.request.b, response.sum))\n            break\n\n    node.destroy_node()                          # 销毁节点对象\n    rclpy.shutdown()                             # 关闭ROS2 Python接口\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br")])]),n("p",[s._v("完成代码的编写后需要设置功能包的编译选项，让系统知道Python程序的入口，打开功能包的setup.py文件，加入如下入口点的配置：")]),s._v(" "),n("div",{staticClass:"language-markup line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-markup"}},[n("code",[s._v("    entry_points={\n        'console_scripts': [\n         'service_adder_client  = learning_service.service_adder_client:main',\n        ],\n    },\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("h4",{attrs:{id:"流程总结-3"}},[n("strong",[s._v("流程总结")])]),s._v(" "),n("p",[s._v("对以上程序进行分析，如果我们想要实现一个客户端，流程如下：")]),s._v(" "),n("ul",[n("li",[s._v("编程接口初始化")]),s._v(" "),n("li",[s._v("创建节点并初始化")]),s._v(" "),n("li",[s._v("创建客户端对象")]),s._v(" "),n("li",[s._v("创建并发送请求数据")]),s._v(" "),n("li",[s._v("等待服务器端应答数据")]),s._v(" "),n("li",[s._v("销毁节点并关闭接口")])]),s._v(" "),n("h3",{attrs:{id:"服务端代码解析"}},[n("strong",[s._v("服务端代码解析")])]),s._v(" "),n("p",[s._v("至于服务器端的实现，有点类似话题通信中的订阅者，并不知道请求数据什么时间出现，也用到了回调函数机制。")]),s._v(" "),n("h4",{attrs:{id:"程序实现-2"}},[n("strong",[s._v("程序实现")])]),s._v(" "),n("p",[s._v("learning_service/service_adder_server.py")]),s._v(" "),n("div",{staticClass:"language-markup line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-markup"}},[n("code",[s._v('#!/usr/bin/env python3\n# -*- coding: utf-8 -*-\n\n"""\n@作者: 古月居(www.guyuehome.com)\n@说明: ROS2服务示例-提供加法器的服务器处理功能\n"""\n\nimport rclpy                                     # ROS2 Python接口库\nfrom rclpy.node   import Node                    # ROS2 节点类\nfrom learning_interface.srv import AddTwoInts    # 自定义的服务接口\n\nclass adderServer(Node):\n    def __init__(self, name):\n        super().__init__(name)                                                           # ROS2节点父类初始化\n        self.srv = self.create_service(AddTwoInts, \'add_two_ints\', self.adder_callback)  # 创建服务器对象（接口类型、服务名、服务器回调函数）\n\n    def adder_callback(self, request, response):   # 创建回调函数，执行收到请求后对数据的处理\n        response.sum = request.a + request.b       # 完成加法求和计算，将结果放到反馈的数据中\n        self.get_logger().info(\'Incoming request\\na: %d b: %d\' % (request.a, request.b))   # 输出日志信息，提示已经完成加法求和计算\n        return response                          # 反馈应答信息\n\ndef main(args=None):                             # ROS2节点主入口main函数\n    rclpy.init(args=args)                        # ROS2 Python接口初始化\n    node = adderServer("service_adder_server")   # 创建ROS2节点对象并进行初始化\n    rclpy.spin(node)                             # 循环等待ROS2退出\n    node.destroy_node()                          # 销毁节点对象\n    rclpy.shutdown()                             # 关闭ROS2 Python接口\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br")])]),n("p",[s._v("完成代码的编写后需要设置功能包的编译选项，让系统知道Python程序的入口，打开功能包的setup.py文件，加入如下入口点的配置：")]),s._v(" "),n("div",{staticClass:"language-markup line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-markup"}},[n("code",[s._v("    entry_points={\n        'console_scripts': [\n         'service_adder_client  = learning_service.service_adder_client:main',\n         'service_adder_server  = learning_service.service_adder_server:main',\n        ],\n    },\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("h4",{attrs:{id:"流程总结-4"}},[n("strong",[s._v("流程总结")])]),s._v(" "),n("p",[s._v("对以上程序进行分析，如果我们想要实现一个服务端，流程如下：")]),s._v(" "),n("ul",[n("li",[s._v("编程接口初始化")]),s._v(" "),n("li",[s._v("创建节点并初始化")]),s._v(" "),n("li",[s._v("创建服务器端对象")]),s._v(" "),n("li",[s._v("通过回调函数处进行服务")]),s._v(" "),n("li",[s._v("向客户端反馈应答结果")]),s._v(" "),n("li",[s._v("销毁节点并关闭接口")])]),s._v(" "),n("h3",{attrs:{id:"服务命令行操作"}},[n("strong",[s._v("服务命令行操作")])]),s._v(" "),n("p",[s._v("服务命令的常用操作如下：")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("$ ros2 "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" list                  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看服务列表")]),s._v("\n$ ros2 "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("type")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("service_name"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看服务数据类型")]),s._v("\n$ ros2 "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" call "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("service_name"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("service_type"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("service_data"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 发送服务请求")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("h2",{attrs:{id:"communication-interface"}},[s._v("communication interface")]),s._v(" "),n("p",[s._v("接口可以让程序之间的依赖降低，便于我们使用别人的代码，也方便别人使用我们的代码，这就是ROS的核心目标，减少重复造轮子。")]),s._v(" "),n("p",[n("img",{attrs:{src:"https://deep-diary.oss-cn-hangzhou.aliyuncs.com/blog/image-20230228071805546.png",alt:"image-20230228071805546"}})]),s._v(" "),n("p",[s._v("ROS有三种常用的通信机制，分别是"),n("strong",[s._v("话题、服务、动作")]),s._v("，通过每一种通信种定义的接口，各种节点才能有机的联系到一起。")]),s._v(" "),n("h3",{attrs:{id:"语言无关"}},[n("strong",[s._v("语言无关")])]),s._v(" "),n("p",[s._v("为了保证每一个节点可以使用不同语言编程，ROS将这些接口的设计做成了和"),n("strong",[s._v("语言无关")]),s._v("的，比如这里看到的int32表示32位的整型数，int64表示64位的整型数，bool表示布尔值，还可以定义数组、结构体，这些定义在编译过程中，会自动生成对应到C++、Python等语言里的数据结构。")]),s._v(" "),n("p",[n("a",{attrs:{href:"https://book.guyuehome.com/ROS2/2.%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5/image/2.6_%E9%80%9A%E4%BF%A1%E6%8E%A5%E5%8F%A3/image-20220528001633925.png",target:"_blank",rel:"noopener noreferrer"}},[n("img",{attrs:{src:"https://deep-diary.oss-cn-hangzhou.aliyuncs.com/blog/image-20220528001633925.png",alt:"image-20220528001633925"}}),n("OutboundLink")],1)]),s._v(" "),n("ul",[n("li",[s._v("话题通信接口的定义使用的是.msg文件，由于是单向传输，只需要描述传输的每一帧数据是什么就行，比如在这个定义里，会传输两个32位的整型数，x、y，我们可以用来传输二维坐标的数值。")]),s._v(" "),n("li",[s._v("服务通信接口的定义使用的是.srv文件，包含请求和应答两部分定义，通过中间的“---”区分，比如之前我们学习的加法求和功能，请求数据是两个64位整型数a和b，应答是求和的结果sum。")]),s._v(" "),n("li",[s._v("动作是另外一种通信机制，用来描述机器人的一个运动过程，使用.action文件定义，比如我们让小海龟转90度，一边转一边周期反馈当前的状态，此时接口的定义分成了三个部分，分别是动作的目标，比如是开始运动，运动的结果，最终旋转的90度是否完成，还有一个周期反馈，比如每隔1s反馈一下当前转到第10度、20度还是30度了，让我们知道运动的进度。")])]),s._v(" "),n("h3",{attrs:{id:"标准接口"}},[n("strong",[s._v("标准接口")])]),s._v(" "),n("p",[s._v("大家可能好奇ROS系统到底给我们定义了哪些接口呢？我们可以在ROS安装路径中的share文件夹中找到，涵盖众多标准定义，大家可以打开几个看看。")]),s._v(" "),n("p",[n("a",{attrs:{href:"https://book.guyuehome.com/ROS2/2.%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5/image/2.6_%E9%80%9A%E4%BF%A1%E6%8E%A5%E5%8F%A3/image-20220528001914859.png",target:"_blank",rel:"noopener noreferrer"}},[n("img",{attrs:{src:"https://deep-diary.oss-cn-hangzhou.aliyuncs.com/blog/image-20220528001914859.png",alt:"image-20220528001914859"}}),n("OutboundLink")],1)]),s._v(" "),n("p",[n("a",{attrs:{href:"https://book.guyuehome.com/ROS2/2.%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5/image/2.6_%E9%80%9A%E4%BF%A1%E6%8E%A5%E5%8F%A3/image-20220528001943541.png",target:"_blank",rel:"noopener noreferrer"}},[n("img",{attrs:{src:"https://deep-diary.oss-cn-hangzhou.aliyuncs.com/blog/image-20220528001943541.png",alt:"image-20220528001943541"}}),n("OutboundLink")],1)]),s._v(" "),n("h3",{attrs:{id:"案例一-服务接口的定义与使用"}},[n("strong",[s._v("案例一：服务接口的定义与使用")])]),s._v(" "),n("p",[s._v("了解了通信接口的概念，接下来我们再从代码实现的角度，研究下如何定义以及使用一个接口。")]),s._v(" "),n("p",[s._v("在之前服务概念讲解的课程中，我们编写了这样一个例程，我们再来回顾下。")]),s._v(" "),n("p",[n("a",{attrs:{href:"https://book.guyuehome.com/ROS2/2.%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5/image/2.6_%E9%80%9A%E4%BF%A1%E6%8E%A5%E5%8F%A3/image-20220528002304850.png",target:"_blank",rel:"noopener noreferrer"}},[n("img",{attrs:{src:"https://deep-diary.oss-cn-hangzhou.aliyuncs.com/blog/image-20220528002304850.png",alt:"image-20220528002304850"}}),n("OutboundLink")],1)]),s._v(" "),n("p",[s._v("有三个节点，第一个驱动相机发布图像话题，第二个是机器视觉识别节点，封装了一个服务的服务端对象，提供目标识别位置的查询服务，第三个节点在需要目标位置的时候，就可以发送请求，收到位置进行使用了。")]),s._v(" "),n("p",[n("a",{attrs:{href:"https://book.guyuehome.com/ROS2/2.%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5/image/2.6_%E9%80%9A%E4%BF%A1%E6%8E%A5%E5%8F%A3/image-20220527235132847.png",target:"_blank",rel:"noopener noreferrer"}},[n("img",{attrs:{src:"https://deep-diary.oss-cn-hangzhou.aliyuncs.com/blog/image-20220527235132847.png",alt:"image-20220527235132847"}}),n("OutboundLink")],1)]),s._v(" "),n("h3",{attrs:{id:"接口定义"}},[n("strong",[s._v("接口定义")])]),s._v(" "),n("p",[s._v("在这个例程中，我们使用GetObjectPosition.srv定义了服务通信的接口：")]),s._v(" "),n("p",[s._v("learning_interface/srv/GetObjectPosition.srv")]),s._v(" "),n("div",{staticClass:"language-markup line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-markup"}},[n("code",[s._v("bool get      # 获取目标位置的指令\n---\nint32 x       # 目标的X坐标\nint32 y       # 目标的Y坐标\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("定义中有两个部分，上边是获取目标位置的指令，get为true的话，就表示我们需要一次位置，服务端就会反馈这个x、y坐标了。")]),s._v(" "),n("p",[s._v("完成定义后，还需要在功能包的CMakeLists.txt中配置编译选项，让编译器在编译过程中，根据接口定义，自动生成不同语言的代码：")]),s._v(" "),n("div",{staticClass:"language-markup line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-markup"}},[n("code",[s._v('...\n\nfind_package(rosidl_default_generators REQUIRED)\n\nrosidl_generate_interfaces(${PROJECT_NAME}\n  "srv/GetObjectPosition.srv"\n)\n\n...\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("p",[s._v("功能包的package.xml文件中也需要添加代码生成的功能依赖：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("\n ...\n\n <build_depend>rosidl_default_generators</build_depend>\n <exec_depend>rosidl_default_runtime</exec_depend>\n <member_of_group>rosidl_interface_packages</member_of_group>\n\n ...\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("h3",{attrs:{id:"程序调用"}},[s._v("程序调用")]),s._v(" "),n("p",[s._v("我们在代码中再来重点看下接口的使用方法。")]),s._v(" "),n("h4",{attrs:{id:"客户端接口调用"}},[n("strong",[s._v("客户端接口调用")])]),s._v(" "),n("p",[s._v("learning_service/service_object_client.py")]),s._v(" "),n("div",{staticClass:"language-markup line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-markup"}},[n("code",[s._v("#!/usr/bin/env python3\n# -*- coding: utf-8 -*-\n\n\"\"\"\n@作者: 古月居(www.guyuehome.com)\n@说明: ROS2服务示例-请求目标识别，等待目标位置应答\n\"\"\"\n\nimport rclpy                                            # ROS2 Python接口库\nfrom rclpy.node   import Node                           # ROS2 节点类\nfrom learning_interface.srv import GetObjectPosition    # 自定义的服务接口\n\nclass objectClient(Node):\n    def __init__(self, name):\n        super().__init__(name)                          # ROS2节点父类初始化\n        self.client = self.create_client(GetObjectPosition, 'get_target_position')\n        while not self.client.wait_for_service(timeout_sec=1.0):\n            self.get_logger().info('service not available, waiting again...')\n        self.request = GetObjectPosition.Request()\n\n    def send_request(self):\n        self.request.get = True\n        self.future = self.client.call_async(self.request)\n\ndef main(args=None):\n    rclpy.init(args=args)                             # ROS2 Python接口初始化\n    node = objectClient(\"service_object_client\")      # 创建ROS2节点对象并进行初始化\n    node.send_request()\n\n    while rclpy.ok():\n        rclpy.spin_once(node)\n\n        if node.future.done():\n            try:\n                response = node.future.result()\n            except Exception as e:\n                node.get_logger().info(\n                    'Service call failed %r' % (e,))\n            else:\n                node.get_logger().info(\n                    'Result of object position:\\n x: %d y: %d' %\n                    (response.x, response.y))\n            break\n    node.destroy_node()                              # 销毁节点对象\n    rclpy.shutdown()                                 # 关闭ROS2 Python接口\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br")])]),n("h4",{attrs:{id:"服务端接口调用"}},[n("strong",[s._v("服务端接口调用")])]),s._v(" "),n("p",[s._v("learning_service/service_object_server.py")]),s._v(" "),n("div",{staticClass:"language-markup line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-markup"}},[n("code",[s._v("#!/usr/bin/env python3\n# -*- coding: utf-8 -*-\n\n\"\"\"\n@作者: 古月居(www.guyuehome.com)\n@说明: ROS2服务示例-提供目标识别服务\n\"\"\"\n\nimport rclpy                                           # ROS2 Python接口库\nfrom rclpy.node import Node                            # ROS2 节点类\nfrom sensor_msgs.msg import Image                      # 图像消息类型\nimport numpy as np                                     # Python数值计算库\nfrom cv_bridge import CvBridge                         # ROS与OpenCV图像转换类\nimport cv2                                             # Opencv图像处理库\nfrom learning_interface.srv import GetObjectPosition   # 自定义的服务接口\n\nlower_red = np.array([0, 90, 128])     # 红色的HSV阈值下限\nupper_red = np.array([180, 255, 255])  # 红色的HSV阈值上限\n\nclass ImageSubscriber(Node):\n    def __init__(self, name):\n        super().__init__(name)                              # ROS2节点父类初始化\n        self.sub = self.create_subscription(\n            Image, 'image_raw', self.listener_callback, 10) # 创建订阅者对象（消息类型、话题名、订阅者回调函数、队列长度）\n        self.cv_bridge = CvBridge()                         # 创建一个图像转换对象，用于OpenCV图像与ROS的图像消息的互相转换\n\n        self.srv = self.create_service(GetObjectPosition,   # 创建服务器对象（接口类型、服务名、服务器回调函数）\n                                       'get_target_position',\n                                       self.object_position_callback)    \n        self.objectX = 0\n        self.objectY = 0                              \n\n    def object_detect(self, image):\n        hsv_img = cv2.cvtColor(image, cv2.COLOR_BGR2HSV)      # 图像从BGR颜色模型转换为HSV模型\n        mask_red = cv2.inRange(hsv_img, lower_red, upper_red) # 图像二值化\n        contours, hierarchy = cv2.findContours(\n            mask_red, cv2.RETR_LIST, cv2.CHAIN_APPROX_NONE)   # 图像中轮廓检测\n\n        for cnt in contours:                                  # 去除一些轮廓面积太小的噪声\n            if cnt.shape[0] < 150:\n                continue\n\n            (x, y, w, h) = cv2.boundingRect(cnt)              # 得到苹果所在轮廓的左上角xy像素坐标及轮廓范围的宽和高\n            cv2.drawContours(image, [cnt], -1, (0, 255, 0), 2)# 将苹果的轮廓勾勒出来\n            cv2.circle(image, (int(x+w/2), int(y+h/2)), 5,\n                       (0, 255, 0), -1)                       # 将苹果的图像中心点画出来\n\n            self.objectX = int(x+w/2)\n            self.objectY = int(y+h/2)\n\n        cv2.imshow(\"object\", image)                            # 使用OpenCV显示处理后的图像效果\n        cv2.waitKey(50)\n\n    def listener_callback(self, data):\n        self.get_logger().info('Receiving video frame')        # 输出日志信息，提示已进入回调函数\n        image = self.cv_bridge.imgmsg_to_cv2(data, 'bgr8')     # 将ROS的图像消息转化成OpenCV图像\n        self.object_detect(image)                              # 苹果检测\n\n    def object_position_callback(self, request, response):     # 创建回调函数，执行收到请求后对数据的处理\n        if request.get == True:\n            response.x = self.objectX                          # 目标物体的XY坐标\n            response.y = self.objectY\n            self.get_logger().info('Object position\\nx: %d y: %d' %\n                                   (response.x, response.y))   # 输出日志信息，提示已经反馈\n        else:\n            response.x = 0\n            response.y = 0\n            self.get_logger().info('Invalid command')          # 输出日志信息，提示已经反馈\n        return response\n\n\ndef main(args=None):                                 # ROS2节点主入口main函数\n    rclpy.init(args=args)                            # ROS2 Python接口初始化\n    node = ImageSubscriber(\"service_object_server\")  # 创建ROS2节点对象并进行初始化\n    rclpy.spin(node)                                 # 循环等待ROS2退出\n    node.destroy_node()                              # 销毁节点对象\n    rclpy.shutdown()                                 # 关闭ROS2 Python接口\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br"),n("span",{staticClass:"line-number"},[s._v("76")]),n("br"),n("span",{staticClass:"line-number"},[s._v("77")]),n("br")])]),n("h3",{attrs:{id:"接口命令行操作"}},[s._v("接口命令行操作")]),s._v(" "),n("p",[s._v("接口命令的常用操作如下：")]),s._v(" "),n("div",{staticClass:"language-markup line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-markup"}},[n("code",[s._v("$ ros2 interface list                    # 查看系统接口列表\n$ ros2 interface show "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("interface_name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("   # 查看某个接口的详细定义\n$ ros2 interface package "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("package_name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("  # 查看某个功能包中的接口定义\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[n("a",{attrs:{href:"https://book.guyuehome.com/ROS2/2.%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5/image/2.6_%E9%80%9A%E4%BF%A1%E6%8E%A5%E5%8F%A3/image-20220528004610983.png",target:"_blank",rel:"noopener noreferrer"}},[n("img",{attrs:{src:"https://deep-diary.oss-cn-hangzhou.aliyuncs.com/blog/image-20220528004610983.png",alt:"image-20220528004610983"}}),n("OutboundLink")],1)]),s._v(" "),n("p",[n("a",{attrs:{href:"https://book.guyuehome.com/ROS2/2.%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5/image/2.6_%E9%80%9A%E4%BF%A1%E6%8E%A5%E5%8F%A3/image-20220528004525471.png",target:"_blank",rel:"noopener noreferrer"}},[n("img",{attrs:{src:"https://deep-diary.oss-cn-hangzhou.aliyuncs.com/blog/image-20220528004525471.png",alt:"image-20220528004525471"}}),n("OutboundLink")],1)]),s._v(" "),n("p",[n("a",{attrs:{href:"https://book.guyuehome.com/ROS2/2.%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5/image/2.6_%E9%80%9A%E4%BF%A1%E6%8E%A5%E5%8F%A3/image-20220528004538865.png",target:"_blank",rel:"noopener noreferrer"}},[n("img",{attrs:{src:"https://deep-diary.oss-cn-hangzhou.aliyuncs.com/blog/image-20220528004538865.png",alt:"image-20220528004538865"}}),n("OutboundLink")],1)]),s._v(" "),n("h2",{attrs:{id:"action"}},[s._v("action")]),s._v(" "),n("p",[s._v("机器人是一个复杂的智能系统，并不仅仅是键盘遥控运动、识别某个目标这么简单，我们需要实现的是送餐、送货、分拣等满足具体场景需求的机器人。")]),s._v(" "),n("p",[s._v("在这些应用功能的实现中，另外一种ROS通信机制也会被常常用到——那就是"),n("strong",[s._v("动作")]),s._v("。从这个名字上就可以很好理解这个概念的含义，这种通信机制的目的就是便于"),n("strong",[s._v("对机器人某一完整行为的流程进行管理")]),s._v("。")]),s._v(" "),n("h3",{attrs:{id:"通信模型-2"}},[n("strong",[s._v("通信模型")])]),s._v(" "),n("p",[s._v("举个例子，比如我们想让机器人转个圈，这肯定不是一下就可以完成的，机器人得一点一点旋转，直到360度才能结束，假设机器人并不在我们眼前，发出指令后，我们根本不知道机器人到底有没有开始转圈，转到哪里了？")]),s._v(" "),n("p",[n("a",{attrs:{href:"https://book.guyuehome.com/ROS2/2.%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5/image/2.7_%E5%8A%A8%E4%BD%9C/image-20220528005012082.png",target:"_blank",rel:"noopener noreferrer"}},[n("img",{attrs:{src:"https://deep-diary.oss-cn-hangzhou.aliyuncs.com/blog/image-20220528005012082.png",alt:"image-20220528005012082"}}),n("OutboundLink")],1)]),s._v(" "),n("p",[s._v("OK，现在我们需要的是一个反馈，比如每隔1s，告诉我们当前转到多少度了，10度、20度、30度，一段时间之后，到了360度，再发送一个信息，表示动作执行完成。")]),s._v(" "),n("p",[s._v("这样一个需要执行一段时间的行为，使用动作的通信机制就更为合适，就像装了一个进度条，我们可以随时把控进度，如果运动过程当中，我们还可以随时发送一个取消运动的命令。")]),s._v(" "),n("h3",{attrs:{id:"客户端-服务器模型-2"}},[n("strong",[s._v("客户端/服务器模型")])]),s._v(" "),n("p",[s._v("动作和服务类似，使用的也是客户端和服务器模型，客户端发送动作的目标，想让机器人干什么，服务器端执行动作过程， 控制机器人达到运动的目标，同时周期反馈动作执行过程中的状态。")]),s._v(" "),n("p",[n("a",{attrs:{href:"https://book.guyuehome.com/ROS2/2.%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5/image/2.7_%E5%8A%A8%E4%BD%9C/image8.gif",target:"_blank",rel:"noopener noreferrer"}},[n("img",{attrs:{src:"https://book.guyuehome.com/ROS2/2.%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5/image/2.7_%E5%8A%A8%E4%BD%9C/image8.gif",alt:"image8"}}),n("OutboundLink")],1)]),s._v(" "),n("p",[s._v("客户端发送一个运动的目标，想让机器人动起来，服务器端收到之后，就开始控制机器人运动，一边运动，一边反馈当前的状态，如果是一个导航动作，这个反馈可能是当前所处的坐标，如果是机械臂抓取，这个反馈可能又是机械臂的实时姿态。当运动执行结束后，服务器再反馈一个动作结束的信息。整个通信过程就此结束。")]),s._v(" "),n("h3",{attrs:{id:"一对多通信-2"}},[n("strong",[s._v("一对多通信")])]),s._v(" "),n("p",[s._v("和服务一样，动作通信中的客户端可以有多个，大家都可以发送运动命令，但是服务器端只能有一个，毕竟只有一个机器人，先执行完成一个动作，才能执行下一个动作。")]),s._v(" "),n("h3",{attrs:{id:"同步通信-2"}},[n("strong",[s._v("同步通信")])]),s._v(" "),n("p",[s._v("既然有反馈，那动作也是一种同步通信机制，之前我们也介绍过，动作过程中的数据通信接口，使用.action文件进行定义。")]),s._v(" "),n("h3",{attrs:{id:"由服务和话题合成"}},[n("strong",[s._v("由服务和话题合成")])]),s._v(" "),n("p",[s._v("大家再仔细看下上边的动图，是不是还会发现一个隐藏的秘密。")]),s._v(" "),n("p",[s._v("动作的三个通信模块，竟然有两个是服务，一个是话题，当客户端发送运动目标时，使用的是服务的请求调用，服务器端也会反馈一个应带，表示收到命令。动作的反馈过程，其实就是一个话题的周期发布，服务器端是发布者，客户端是订阅者。")]),s._v(" "),n("p",[s._v("没错，动作是一种应用层的通信机制，其底层就是基于话题和服务来实现的。")]),s._v(" "),n("h3",{attrs:{id:"案例一-小海龟的动作"}},[n("strong",[s._v("案例一：小海龟的动作")])]),s._v(" "),n("p",[s._v("我们再用小海龟的案例加深对动作概念的理解。")]),s._v(" "),n("p",[s._v("按照以下命令启动小海龟仿真器，接下来使用action命令控制小海龟的动作，可以让海龟运动到某一指定的姿态：")]),s._v(" "),n("div",{staticClass:"language-markup line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-markup"}},[n("code",[s._v('$ ros2 run turtlesim turtlesim_node\n$ ros2 run turtlesim turtle_teleop_key\n$ ros2 action info /turtle1/rotate_absolute\n$ ros2 action send_goal /turtle1/rotate_absolute turtlesim/action/RotateAbsolute "{theta: -1.57}"\n$ ros2 action send_goal /turtle1/rotate_absolute turtlesim/action/RotateAbsolute "{theta: -1.57}" --feedback\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[n("a",{attrs:{href:"https://book.guyuehome.com/ROS2/2.%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5/image/2.7_%E5%8A%A8%E4%BD%9C/image-20220528005909408.png",target:"_blank",rel:"noopener noreferrer"}},[n("img",{attrs:{src:"https://deep-diary.oss-cn-hangzhou.aliyuncs.com/blog/image-20220528005909408.png",alt:"image-20220528005909408"}}),n("OutboundLink")],1)]),s._v(" "),n("p",[n("a",{attrs:{href:"https://book.guyuehome.com/ROS2/2.%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5/image/2.7_%E5%8A%A8%E4%BD%9C/image-20220528005935269.png",target:"_blank",rel:"noopener noreferrer"}},[n("img",{attrs:{src:"https://deep-diary.oss-cn-hangzhou.aliyuncs.com/blog/image-20220528005935269.png",alt:"image-20220528005935269"}}),n("OutboundLink")],1)]),s._v(" "),n("h3",{attrs:{id:"案例二-机器人画圆"}},[n("strong",[s._v("案例二：机器人画圆")])]),s._v(" "),n("p",[s._v("如何通过代码来实现动作的编程呢？")]),s._v(" "),n("p",[s._v("动作虽然是基于话题和服务实现的，但在实际使用中，并不会直接使用话题和服务的编程方法，而是有一套针对动作特性封装好的编程接口，接下来我们就一起试一试。")]),s._v(" "),n("p",[n("a",{attrs:{href:"https://book.guyuehome.com/ROS2/2.%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5/image/2.7_%E5%8A%A8%E4%BD%9C/image-20220528010032315.png",target:"_blank",rel:"noopener noreferrer"}},[n("img",{attrs:{src:"https://deep-diary.oss-cn-hangzhou.aliyuncs.com/blog/image-20220528010032315.png",alt:"image-20220528010032315"}}),n("OutboundLink")],1)]),s._v(" "),n("p",[s._v("假设我们有一个机器人，我们希望通过动作的通信方法，让机器人转个圈，请编程实现动作通信中，客户端和服务器端的实现过程。")]),s._v(" "),n("h3",{attrs:{id:"运行效果"}},[n("strong",[s._v("运行效果")])]),s._v(" "),n("p",[s._v("启动两个终端，分别运行一下命令，启动动作示例的服务端和客户端：")]),s._v(" "),n("div",{staticClass:"language-markup line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-markup"}},[n("code",[s._v("$ ros2 run learning_action action_move_server \n$ ros2 run learning_action action_move_client\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[n("a",{attrs:{href:"https://book.guyuehome.com/ROS2/2.%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5/image/2.7_%E5%8A%A8%E4%BD%9C/image-20220528010905277.png",target:"_blank",rel:"noopener noreferrer"}},[n("img",{attrs:{src:"https://deep-diary.oss-cn-hangzhou.aliyuncs.com/blog/image-20220528010905277.png",alt:"image-20220528010905277"}}),n("OutboundLink")],1)]),s._v(" "),n("p",[n("a",{attrs:{href:"https://book.guyuehome.com/ROS2/2.%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5/image/2.7_%E5%8A%A8%E4%BD%9C/image-20220528010845943.png",target:"_blank",rel:"noopener noreferrer"}},[n("img",{attrs:{src:"https://deep-diary.oss-cn-hangzhou.aliyuncs.com/blog/image-20220528010845943.png",alt:"image-20220528010845943"}}),n("OutboundLink")],1)]),s._v(" "),n("p",[s._v("终端中，我们可以看到客户端发送动作目标之后，服务器端开始模拟机器人运动，每30度发送一次反馈信息，最终完成运动，并反馈结束运动的信息。")]),s._v(" "),n("p",[s._v("接下来我们就分析下这个例程实现背后的原理。")]),s._v(" "),n("h3",{attrs:{id:"接口定义-2"}},[n("strong",[s._v("接口定义")])]),s._v(" "),n("p",[s._v("例程使用的动作并不是ROS中的标准定义，我们通过MoveCircle.action进行自定义：")]),s._v(" "),n("p",[s._v("learning_interface/action/MoveCircle.action")]),s._v(" "),n("div",{staticClass:"language-markup line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-markup"}},[n("code",[s._v("bool enable     # 定义动作的目标，表示动作开始的指令\n---\nbool finish     # 定义动作的结果，表示是否成功执行\n---\nint32 state     # 定义动作的反馈，表示当前执行到的位置\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[s._v("包含三个部分：")]),s._v(" "),n("ul",[n("li",[s._v("第一块是"),n("strong",[s._v("动作的目标")]),s._v("，enable为true时，表示开始运动；")]),s._v(" "),n("li",[s._v("第二块是"),n("strong",[s._v("动作的执行结果")]),s._v("，finish为true，表示动作执行完成；")]),s._v(" "),n("li",[s._v("第三块是"),n("strong",[s._v("动作的周期反馈")]),s._v("，表示当前机器人旋转到的角度。")])]),s._v(" "),n("p",[s._v("完成定义后，还需要在功能包的CMakeLists.txt中配置编译选项，让编译器在编译过程中，根据接口定义，自动生成不同语言的代码：")]),s._v(" "),n("div",{staticClass:"language-markup line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-markup"}},[n("code",[s._v('...\n\nfind_package(rosidl_default_generators REQUIRED)\n\nrosidl_generate_interfaces(${PROJECT_NAME}\n  "action/MoveCircle.action"\n)\n\n...\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("h3",{attrs:{id:"通信模型-3"}},[n("strong",[s._v("通信模型")])]),s._v(" "),n("p",[s._v("通信模型就是这样，客户端发送给一个动作目标，服务器控制机器人开始运动，并周期反馈，结束后反馈结束信息。")]),s._v(" "),n("p",[n("a",{attrs:{href:"https://book.guyuehome.com/ROS2/2.%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5/image/2.7_%E5%8A%A8%E4%BD%9C/image-20220528010217043.png",target:"_blank",rel:"noopener noreferrer"}},[n("img",{attrs:{src:"https://deep-diary.oss-cn-hangzhou.aliyuncs.com/blog/image-20220528010217043.png",alt:"image-20220528010217043"}}),n("OutboundLink")],1)]),s._v(" "),n("p",[s._v("思路理清楚，接下来开始写代码。相比之前话题和服务的程序，动作通信的例程相对较长，我们一起来运行并分析一下。")]),s._v(" "),n("h3",{attrs:{id:"服务端代码解析-2"}},[n("strong",[s._v("服务端代码解析")])]),s._v(" "),n("p",[s._v("learning_action/action_move_server.py")]),s._v(" "),n("div",{staticClass:"language-markup line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-markup"}},[n("code",[s._v('#!/usr/bin/env python3\n# -*- coding: utf-8 -*-\n\n"""\n@作者: 古月居(www.guyuehome.com)\n@说明: ROS2动作示例-负责执行圆周运动动作的服务端\n"""\n\nimport time\n\nimport rclpy                                      # ROS2 Python接口库\nfrom rclpy.node   import Node                     # ROS2 节点类\nfrom rclpy.action import ActionServer             # ROS2 动作服务器类\nfrom learning_interface.action import MoveCircle  # 自定义的圆周运动接口\n\nclass MoveCircleActionServer(Node):\n    def __init__(self, name):\n        super().__init__(name)                   # ROS2节点父类初始化\n        self._action_server = ActionServer(      # 创建动作服务器（接口类型、动作名、回调函数）\n            self,\n            MoveCircle,\n            \'move_circle\',\n            self.execute_callback)\n\n    def execute_callback(self, goal_handle):            # 执行收到动作目标之后的处理函数\n        self.get_logger().info(\'Moving circle...\')\n        feedback_msg = MoveCircle.Feedback()            # 创建一个动作反馈信息的消息\n\n        for i in range(0, 360, 30):                     # 从0到360度，执行圆周运动，并周期反馈信息\n            feedback_msg.state = i                      # 创建反馈信息，表示当前执行到的角度\n            self.get_logger().info(\'Publishing feedback: %d\' % feedback_msg.state)\n            goal_handle.publish_feedback(feedback_msg)  # 发布反馈信息\n            time.sleep(0.5)\n\n        goal_handle.succeed()                           # 动作执行成功\n        result = MoveCircle.Result()                    # 创建结果消息\n        result.finish = True                            \n        return result                                   # 反馈最终动作执行的结果\n\ndef main(args=None):                                    # ROS2节点主入口main函数\n    rclpy.init(args=args)                               # ROS2 Python接口初始化\n    node = MoveCircleActionServer("action_move_server") # 创建ROS2节点对象并进行初始化\n    rclpy.spin(node)                                    # 循环等待ROS2退出\n    node.destroy_node()                                 # 销毁节点对象\n    rclpy.shutdown()                                    # 关闭ROS2 Python接口\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br")])]),n("p",[s._v("完成代码的编写后需要设置功能包的编译选项，让系统知道Python程序的入口，打开功能包的setup.py文件，加入如下入口点的配置：")]),s._v(" "),n("div",{staticClass:"language-markup line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-markup"}},[n("code",[s._v("    entry_points={\n        'console_scripts': [\n         'action_move_server    = learning_action.action_move_server:main',\n        ],\n    },\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("h3",{attrs:{id:"客户端代码解析-2"}},[n("strong",[s._v("客户端代码解析")])]),s._v(" "),n("p",[s._v("learning_action/action_move_client.py")]),s._v(" "),n("div",{staticClass:"language-markup line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-markup"}},[n("code",[s._v("#!/usr/bin/env python3\n# -*- coding: utf-8 -*-\n\n\"\"\"\n@作者: 古月居(www.guyuehome.com)\n@说明: ROS2动作示例-请求执行圆周运动动作的客户端\n\"\"\"\n\nimport rclpy                                      # ROS2 Python接口库\nfrom rclpy.node   import Node                     # ROS2 节点类\nfrom rclpy.action import ActionClient             # ROS2 动作客户端类\n\nfrom learning_interface.action import MoveCircle  # 自定义的圆周运动接口\n\nclass MoveCircleActionClient(Node):\n    def __init__(self, name):\n        super().__init__(name)                   # ROS2节点父类初始化\n        self._action_client = ActionClient(      # 创建动作客户端（接口类型、动作名）\n            self, MoveCircle, 'move_circle') \n\n    def send_goal(self, enable):                 # 创建一个发送动作目标的函数\n        goal_msg = MoveCircle.Goal()             # 创建一个动作目标的消息\n        goal_msg.enable = enable                 # 设置动作目标为使能，希望机器人开始运动\n\n        self._action_client.wait_for_server()    # 等待动作的服务器端启动\n        self._send_goal_future = self._action_client.send_goal_async(   # 异步方式发送动作的目标\n            goal_msg,                                                   # 动作目标\n            feedback_callback=self.feedback_callback)                   # 处理周期反馈消息的回调函数\n\n        self._send_goal_future.add_done_callback(self.goal_response_callback) # 设置一个服务器收到目标之后反馈时的回调函数\n\n    def goal_response_callback(self, future):           # 创建一个服务器收到目标之后反馈时的回调函数\n        goal_handle = future.result()                   # 接收动作的结果\n        if not goal_handle.accepted:                    # 如果动作被拒绝执行\n            self.get_logger().info('Goal rejected :(')\n            return\n\n        self.get_logger().info('Goal accepted :)')                            # 动作被顺利执行\n\n        self._get_result_future = goal_handle.get_result_async()              # 异步获取动作最终执行的结果反馈\n        self._get_result_future.add_done_callback(self.get_result_callback)   # 设置一个收到最终结果的回调函数 \n\n    def get_result_callback(self, future):                                    # 创建一个收到最终结果的回调函数\n        result = future.result().result                                       # 读取动作执行的结果\n        self.get_logger().info('Result: {%d}' % result.finish)                # 日志输出执行结果\n\n    def feedback_callback(self, feedback_msg):                                # 创建处理周期反馈消息的回调函数\n        feedback = feedback_msg.feedback                                      # 读取反馈的数据\n        self.get_logger().info('Received feedback: {%d}' % feedback.state) \n\ndef main(args=None):                                       # ROS2节点主入口main函数\n    rclpy.init(args=args)                                  # ROS2 Python接口初始化\n    node = MoveCircleActionClient(\"action_move_client\")    # 创建ROS2节点对象并进行初始化\n    node.send_goal(True)                                   # 发送动作目标\n    rclpy.spin(node)                                       # 循环等待ROS2退出\n    node.destroy_node()                                    # 销毁节点对象\n    rclpy.shutdown()                                       # 关闭ROS2 Python接口\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br")])]),n("p",[s._v("完成代码的编写后需要设置功能包的编译选项，让系统知道Python程序的入口，打开功能包的setup.py文件，加入如下入口点的配置：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("div",{staticClass:"language-markup line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-markup"}},[n("code",[s._v("    entry_points={\n        'console_scripts': [\n         'action_move_client    = learning_action.action_move_client:main',\n         'action_move_server    = learning_action.action_move_server:main',\n        ],\n    },\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("h3",{attrs:{id:"动作命令行操作"}},[n("strong",[s._v("动作命令行操作")])]),s._v(" "),n("p",[s._v("动作命令的常用操作如下：")]),s._v(" "),n("div",{staticClass:"language-markup line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-markup"}},[n("code",[s._v("$ ros2 action list                  # 查看服务列表\n$ ros2 action info "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("action_name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("    # 查看服务数据类型\n$ ros2 action send_goal "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("action_name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("action_type")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("action_data")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("   # 发送服务请求\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[n("a",{attrs:{href:"https://book.guyuehome.com/ROS2/2.%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5/image/2.7_%E5%8A%A8%E4%BD%9C/image-20220528005935269.png",target:"_blank",rel:"noopener noreferrer"}},[n("img",{attrs:{src:"https://deep-diary.oss-cn-hangzhou.aliyuncs.com/blog/image-20220528005935269.png",alt:"image-20220528005935269"}}),n("OutboundLink")],1)]),s._v(" "),n("h2",{attrs:{id:"parameter"}},[s._v("parameter")]),s._v(" "),n("p",[n("a",{attrs:{href:"https://www.guyuehome.com/38291",target:"_blank",rel:"noopener noreferrer"}},[s._v("ROS2,ROS2教程,ROS2入门,ROS通信机制,ROS动作通信 - 古月居 (guyuehome.com)"),n("OutboundLink")],1)]),s._v(" "),n("h2",{attrs:{id:"distributed-communication"}},[s._v("distributed communication")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("~.bashrc\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ROS_DOMAIN_ID")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("31")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" .bashrc  生效脚本\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("h2",{attrs:{id:"dds"}},[s._v("DDS")]),s._v(" "),n("h2",{attrs:{id:"launch"}},[s._v("launch")]),s._v(" "),n("p",[n("a",{attrs:{href:"https://www.guyuehome.com/38308",target:"_blank",rel:"noopener noreferrer"}},[s._v("《ROS2入门21讲图文教程 | 17、Launch：多节点启动与配置脚本》 - 古月居 (guyuehome.com)"),n("OutboundLink")],1)]),s._v(" "),n("h2",{attrs:{id:"tf-机器人坐标系管理神器"}},[s._v("TF: 机器人坐标系管理神器")]),s._v(" "),n("h2",{attrs:{id:"urdf-ros机器人建模方法"}},[s._v("URDF：ROS机器人建模方法")]),s._v(" "),n("h2",{attrs:{id:"gazebo-三维物理仿真平台"}},[s._v("Gazebo: 三维物理仿真平台")]),s._v(" "),n("h2",{attrs:{id:"rviz-三维可视化显示平台"}},[s._v("Rviz: 三维可视化显示平台")]),s._v(" "),n("h2",{attrs:{id:"rqt-模块化可视工具"}},[s._v("RQT: 模块化可视工具")]),s._v(" "),n("h1",{attrs:{id:"questions"}},[s._v("questions")]),s._v(" "),n("h2",{attrs:{id:"ros中订阅-subscribe-最新消息以及消息队列相关问题"}},[s._v("ROS中订阅（Subscribe）最新消息以及消息队列相关问题")]),s._v(" "),n("p",[s._v("​        机器人应用中难免会遇到运算起来很费时间的操作，比如图像的特征提取、点云的匹配等等。有时候，不可避免地，我们需要在ROS的Subscriber的Callback回调函数中进行这些费时的操作。Subscriber所订阅的消息的发布频率可能是很高的，而这些操作的运算速度肯定达不到消息发布的速度。所以，如果我们要是没有取舍的对于每个消息都调用一次回调函数，那么势必会导致计算越来越不实时，很有可能当下在处理的还是几十秒以前的数据。所以，我们希望每次回调函数都处理当前时刻最新的一个消息，这就是我们的目标。")]),s._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[s._v("    要达到这个目标有三点，第一点是要设置Publisher的queue_size等于1；第二点是要设置Subscriber的queue_size（消息队列大小）等于1；第三点非常重要，要设置Subscriber的buff_size（缓冲区大小）足够大，大于一个消息的大小。像这样：\n")])])]),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[s._v("pcdpub "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" rospy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Publisher"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"lidardata"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" PointCloud"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" queue_size"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nrospy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Subscriber"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"lidardata"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" PointCloud"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pcd_resolve_callback"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("queue_size"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("buff_size"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("52428800")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("h3",{attrs:{id:"subscriber和publisher的消息队列起什么作用-队列的大小有什么影响"}},[s._v("Subscriber和Publisher的消息队列起什么作用，队列的大小有什么影响？")]),s._v(" "),n("p",[s._v("​        简单描述一下，Publisher的消息队列是为了缓存发布节点发布的消息，一旦队列中消息的数量超过了queue_size，那么最先进入队列的（最老的）消息被舍弃。Subscriber的消息队列是为了缓存节点接收到的信息，一旦自己处理的速度过慢，接收到的消息数量超过了queue_size，那么最先进入队列的（最老的）消息会被舍弃。所以，我们想只处理最新的消息，实际上只需要把两个queue_size都设置成1，那么系统不会缓存数据，自然处理的就是最新的消息。")]),s._v(" "),n("h3",{attrs:{id:"subscriber有消息队列缓存消息了-为什么publisher还要有消息队列"}},[s._v("Subscriber有消息队列缓存消息了，为什么Publisher还要有消息队列？")]),s._v(" "),n("p",[s._v("​        在我看来，Publisher的消息队列是一定要有的，因为ROS中发布节点往外发送消息是基于Topic发送，而不是直接向Subscriber订阅者发送，所以必须要有一个消息队列来存放发布的消息，以供订阅者来获取。而且这个消息队列的好处是在网络差、带宽小、延时高的时候，保证数据不容易丢失。")]),s._v(" "),n("h3",{attrs:{id:"既然publisher有消息队列了-为什么subscriber还要有消息队列"}},[s._v("既然Publisher有消息队列了，为什么Subscriber还要有消息队列？")]),s._v(" "),n("p",[s._v("​        这个问题比较难一点。我的理解是，由于ROS毕竟是分布式系统，Publisher和Subscriber不一定在同一台主机上，因此消息需要通过网络来交换。但是网络的性能时好时坏，如果Subscriber没有消息队列，那么每次运行Callback函数前都要先通过网络取回消息，然后才能处理。当网络很差时，就会让系统堵塞。而有消息队列的话，Subscriber就可以一边处理队列中的消息，一边通过网络缓存新的消息，而不用每次处理消息前都要临时去读一个回来。这样就增加了系统的可靠性。")]),s._v(" "),n("h3",{attrs:{id:"为什么要设置缓冲区的大小"}},[s._v("为什么要设置缓冲区的大小？")]),s._v(" "),n("p",[s._v("​        这个缓冲区的大小是指消息队列使用的缓冲区物理内存空间大小。如果这个空间小于一个消息所需要的空间，比如消息是一副图片或者一帧点云，数据量超过了缓冲区的大小。这个时候为了保证通信不发生错误，就会触发网络通信的保护机制，TCP的Buffer会为你缓存消息。这种机制就会导致每一帧消息都被完整的缓存下来，没有消息被丢弃，感觉上就像queue_size被设置成了无穷大。详细说明请参考：\nRos subscriber not up to date\nrospy subscriber queue_size acting strange when buff_size is too small")]),s._v(" "),n("h3",{attrs:{id:"消息队列的运行机制"}},[s._v("消息队列的运行机制")]),s._v(" "),n("p",[s._v("这里只能说是我的理解了，因为没有看过源代码。\n首先，发布节点把消息发布，消息进入Publisher的消息队列，同时通知订阅了该话题消息的Subscriber来取消息。\n其次，Subscriber来Publisher的消息队列里取消息，但取走的也是最老的消息，因为毕竟这是先入先出的队列。这也是为什么Publisher的消息队列的大小也要设置为1。\n最后，被取走的消息存放入了Subscriber的消息队列中，等待被Callback执行。如果Callback执行很慢，消息越堆越多，最老的消息会逐渐被顶替。\n当然，这里究竟是Subscriber来取消息，还是Publisher直接把消息推给Subscriber，我只是猜测，反正这里交换的消息肯定不是最新的消息，而是队列里最老的消息。")]),s._v(" "),n("h2",{attrs:{id:"launch文件的写法"}},[s._v("launch文件的写法")]),s._v(" "),n("div",{staticClass:"language-html line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-html"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("\x3c!-- 启动mbot --\x3e")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("node")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("robot_bringup"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("pkg")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("robot_bringup"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("type")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("robot_bringup"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("output")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("screen"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("/>")])]),s._v("\n \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("\x3c!-- 加载机器人模型参数 --\x3e")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("param")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("robot_description"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("command")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("$(find xacro)/xacro --inorder "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("'")]),s._v("$(find robot_description)/xacro/robot_with_laser.xacro"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("/>")])]),s._v("\n \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("\x3c!-- 运行joint_state_publisher节点，发布机器人的关节状态 --\x3e")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("node")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("joint_state_publisher"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("pkg")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("joint_state_publisher"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("type")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("joint_state_publisher"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("/>")])]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("\x3c!-- 运行robot_state_publisher节点，发布tf --\x3e")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("node")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("state_publisher"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("pkg")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("robot_state_publisher"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("type")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("robot_state_publisher"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("param")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("publish_frequency"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("type")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("double"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("value")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("50.0"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("/>")])]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("node")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("\x3c!-- 运行激光雷达驱动 --\x3e")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("include")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("file")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("$(find robot_bringup)/launch/rplidar.launch"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("/>")])]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br")])]),n("h2",{attrs:{id:"ros1通信模型"}},[s._v("ros1通信模型")]),s._v(" "),n("ul",[n("li",[s._v("talker注册")]),s._v(" "),n("li",[s._v("listener注册")]),s._v(" "),n("li",[s._v("ROS Master进行信息匹配")]),s._v(" "),n("li",[s._v("listener 发送链接请求")]),s._v(" "),n("li",[s._v("talker确认请求")]),s._v(" "),n("li",[s._v("建立连接")]),s._v(" "),n("li",[s._v("talker给listener发数据")])]),s._v(" "),n("p",[s._v("6、ROS基础")]),s._v(" "),n("h2",{attrs:{id:"ros的总体设计目标"}},[s._v("ROS的总体设计目标")]),s._v(" "),n("p",[n("img",{attrs:{src:"https://deep-diary.oss-cn-hangzhou.aliyuncs.com/blog/20210812214936688.png",alt:"img"}})]),s._v(" "),n("h2",{attrs:{id:"ros的应用框架是怎样的"}},[s._v("ROS的应用框架是怎样的？")]),s._v(" "),n("p",[s._v("​        "),n("img",{attrs:{src:"https://deep-diary.oss-cn-hangzhou.aliyuncs.com/blog/20210812215038888.png",alt:"img"}})]),s._v(" "),n("p",[s._v("总结：ROS就是一个为了提高机器人开发的软件复用率，开发的一款具有独特的通信机制、丰富的开发工具、海量的应用功能、良好的生态系统集的工具。")]),s._v(" "),n("p",[s._v("​")]),s._v(" "),n("h2",{attrs:{id:"如何新建一个工作空间"}},[s._v("如何新建一个工作空间？")]),s._v(" "),n("p",[s._v("​        最基础的功能包都不会写，怎么意思说学过ROS：")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" ~/catkin_test_ws/src                                        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#进入存放功能包的地方")]),s._v("\ncatkin_create_pkg test_package std_msgs roscpp rospy           "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#创建名字为test_package的功能包，添加std_msgs roscpp rospy依赖")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" ~/catkin_test_ws                                            \ncatkin_make                                                    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#编译")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" devel/setup.bash              \t\t\t\t\t\t   "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#新建功能包刷新环境变量，才能找到功能包")]),s._v("\nrospack profile                                                "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#如果还是找不到功能包，使用该命令刷新功能包路径")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("p",[s._v("​        需要注意一点，同一个工作空间下不能存在同名功能包，不同的工作空间下可以存在同名功能包。但是要注意一个问题，ROS运行时会优先选择最前端工作空间的同名功能包。为了避免出现想不到的问题，所有工作空间尽量不使用同名功能包。")]),s._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[s._v("    功能包的名称尽量按照a_b_c的格式书写，否则，编译过程将会出现警告。\n")])])]),n("h2",{attrs:{id:"如何新建一个功能包"}},[s._v("如何新建一个功能包？")]),s._v(" "),n("p",[s._v("​        这也是需要每个人都要会的，连个最基础的功能包都不会写，怎么好意思说学过ROS？")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" ~/catkin_test_ws/src                                        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#进入存放功能包的地方")]),s._v("\ncatkin_create_pkg test_package std_msgs roscpp rospy           "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#创建名字为test_package的功能包，添加std_msgs roscpp rospy依赖")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" ~/catkin_test_ws                                            \ncatkin_make                                                    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#编译")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" devel/setup.bash              \t\t\t\t\t\t   "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#新建功能包刷新环境变量，才能找到功能包")]),s._v("\nrospack profile                                                "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#如果还是找不到功能包，使用该命令刷新功能包路径        这里需要注意一点，同一个工作空间下不能存在同名功能包，不同的工作空间下可以存在同名功能包。但是要注意一个问题，ROS运行时会优先选择最前端工作空间的同名功能包。为了避免出现意想不到的问题，所以工作空间尽量不使用同名功能包。")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[s._v("    功能包的名称尽量按照a_b_c的格式书写，否则，编译过程将会出现警告。\n")])])]),n("h2",{attrs:{id:"如何新建一个ros节点"}},[s._v("如何新建一个ROS节点？")]),s._v(" "),n("p",[s._v("接着上面的测试功能包，我们在功能包的src文件下新建test.cpp文件：")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" ~/catkin_test_ws/src/test_package/src/\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" test.cpp\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[s._v("然后就是ROS节点的模板程序，都是在模板程序之上做的修改。")]),s._v(" "),n("div",{staticClass:"language-c++ line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('#include "ros/ros.h"                    //引入ROS头文件\n \nint main(int argc,char **argv)\n{\n\tros::init(argc,argv,"test");        //初始化ROS节点\n\t\n\tros::NodeHandle nh;                 //创建ROS句柄\n \n\tros::Rate loop_rate(10);            //定义循环频率 10HZ\n \n\twhile(ros::ok())\n\t{\n\t\tstd::cout<< "hello ros" <<std::endl;\n\t\tloop_rate.sleep();             //按照循环速率延时\n\t}\n\treturn 0;\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br")])]),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[s._v("到这里，然后编译就可以了？这个功能包的编译还需要修改对应的CMakeLIsts.txt文件，一般为三步。\n\n设置需要编译的代码和生成的可执行文件；\n\n设置链接库；\n\n设置依赖；\n\n所以我们修改功能包下的CMakeLIsts.txt文件，一般功能包会自动生成CMakeLists.txt文件内容，我们进行修改即可。\n")])])]),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("add_executable"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${PROJECT_NAME}")]),s._v("_node src/test.cpp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                             "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#这里注意自动生成的源文件名字一般不对，一定要修改成对的名字")]),s._v("\ntarget_link_libraries"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${PROJECT_NAME}")]),s._v("_node "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${catkin_LIBRARIES}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nadd_dependencies"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${PROJECT_NAME}")]),s._v("_node "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${${PROJECT_NAME}")]),s._v("_EXPORTED_TARGETS"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${catkin_EXPORTED_TARGETS}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[s._v("这里因为我们没有自定义的消息或者服务类型，所以其他的地方不做更改，如果使用了自定义的消息或者服务类型，注意修改其他的地方。")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" ~/catkin_test_ws                                            \ncatkin_make                                                    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#编译")]),s._v("\n此时~/catkin_test_ws/devel/lib/test_package目录下生成了test_package_node的可执行文件\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[s._v("​        执行功能包，在使用rosrun执行功能包之前，使用roscore启动rosmaster。启动rosmaster是启动一切ros节点的前提。")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("roscore            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#启动rosmaster")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("打开一个新终端启动，test_package功能包下的test_package_node节点。")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("rosrun test_package test_package_node\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("终端循环打印hello ros，一个新的ros节点就创建完成了。")]),s._v(" "),n("h2",{attrs:{id:"如何在一个ros节点文件中调用其他的源文件"}},[s._v("如何在一个ros节点文件中调用其他的源文件？")]),s._v(" "),n("p",[s._v("​    这个问题很常见，但是他不应该是个问题，但是发现一些小伙伴还是不太会操作。我们在开发的过程中，随着程序的不断扩大，模块化编程肯定必不可少。有时，我们要调用别人写好的特定功能的源文件，这个时候我们应该怎么做吗？")]),s._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[s._v("    首先，将你需要的源文件复制到你需要编写的功能包的src文件夹下，规范地讲，.hpp文件应该放到include文件下，如果文件比较少，也没有必要，和.cpp文件放在一起也可以。\n\n    ros节点源文件只需要添加你复制的头文件下就行了，函数自己调用就行了。\n\n    CMakeLists.txt文件需要做相应的修改，添加你添加的文件名字，放在ros节点文件后面，如下所示：\n")])])]),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("add_executable"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${PROJECT_NAME}")]),s._v("_node src/test.cpp src/test2.cpp src/test3.cpp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("   \n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#这里注意自动生成的源文件名字一般不对，一定要修改成对的名字")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[s._v("然后，编译就行了。")]),s._v(" "),n("h2",{attrs:{id:"如何设置两台机器的分布式通信"}},[s._v("如何设置两台机器的分布式通信？")]),s._v(" "),n("p",[s._v("​        ROS是一种分布式软件框架，节点之间通过松耦合的方式进行组合。")]),s._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[s._v("    如何设置两台机器的分布式通信呢？\n\n    首先，确保两台机器在同一局域网下，查看各自的ip地址。\n")])])]),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ifconfig")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("然后，各自安装ssh，确保ssh服务，开机自启动。")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" openssh-server                  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#安装ssh服务端")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" start                               "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#开启ssh服务")]),s._v("\nssh服务开机不会自动启动，需要设置开机自启动\n在开机自启动脚本/etc/rc.local加入下面这条命令，注意加入位置是在exit "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("这一句之前，加上service "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" start\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("​        然后，在两台机器的/etc/hosts文件中，添加对方的ip地址，通过ping命令，互相测试是否连通。比如在hosts添加，对方机器IP对方机器名。")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.5   对方机器名\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v(" 对方机器名或者对方机器ip        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ping测试")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[s._v("然后，在从机端的~/.bashrc文件末尾设置ROS_MASTER_URI，确保从机可以找到主机。")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ROS_MASTER_URI")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http://主机名称:11311最后，在从机端使用ssh用户名@IP地址，输入密码，连接远程终端。 \n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h2",{attrs:{id:"ros开发常用的工具"}},[s._v("ROS开发常用的工具")]),s._v(" "),n("p",[s._v("​        launch文件，可以同时启动多个ros节点，可自动启动rosmaster。关于launch的细节，自己学习就好。")]),s._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[s._v("    TF坐标变换，用来描述机器人系统中繁杂的坐标系。\n\n    QT工具箱，用来可视化各个ros节点之间的订阅或者请求关系或者可视化各种话题的数据。常用命令，rqt_graph、rqt_plot，而且还可以动态修改部分参数。\n\n    rqt_reconfigure（不常用）。\n\n    rviz可视化平台，机器人可视化平台，几乎是最常用的工具。使用rviz命令启动。\n")])])]),n("p",[n("img",{attrs:{src:"https://deep-diary.oss-cn-hangzhou.aliyuncs.com/blog/20210812225612440.png",alt:"img"}})]),s._v(" "),n("p",[s._v("Gazebo物理仿真环境，可对机器人进行三维物理仿真。需要仿真的同学常用。")]),s._v(" "),n("h2",{attrs:{id:"ros的常用命令"}},[s._v("ROS的常用命令")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#最常用")]),s._v("\nroscore                    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#启动rosmaster")]),s._v("\nrosrun  pkg_name node_name "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#启动ros节点")]),s._v("\nroslaunch pkg_name launch_files_name "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#启动launch文件")]),s._v("\ncatkin_make                "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#编译工作空间")]),s._v("\nrospack profile            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#刷新功能包路径")]),s._v("\n \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#环境变量")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$ROS_PACKAGE_PATH")]),s._v("     "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#打印ros环境变量")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" ROS          "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#确认环境变量已经设置正确")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" devel/setup.bash    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#刷新环境变量")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"source ~/catkin_test_ws/devel/setup.bash"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" ~/.bashrc    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#刷新环境变量，永久有效")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" ~/.bashrc                                                "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#生效上一句")]),s._v("\n \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#功能包")]),s._v("\ncatkin_create_pkg test_package std_msgs roscpp rospy            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#创建名字为test_package的功能包，添加std_msgs roscpp rospy依赖")]),s._v("\nrospack list               "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看软件包列表")]),s._v("\nrospack "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("find")]),s._v(" package-name  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#定位软件包")]),s._v("\nroscd package-name         "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#切换到指定功能包目录")]),s._v("\n \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#话题")]),s._v("\nrostopic list              "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#输出当前运行的topic列表")]),s._v("\nrostopic info topic-name   "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看话题信息")]),s._v("\nrostopic "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" topic-name   "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#输出话题数据")]),s._v("\nrostopic hz topic-name     "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#每秒发布的消息数量")]),s._v("\nrostopic bw topic-name     "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#每秒发布信息所占的字节量")]),s._v("\n \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#工具")]),s._v("\nrviz                       "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#启动rviz")]),s._v("\nrqt_graph                  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#可视化节点关系")]),s._v("\nrqt_plot                   "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#可视化话题数据")]),s._v("\nrosrun rqt_tf_tree rqt_tf_tree "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看tf树")]),s._v("\n \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#数据记录与播放")]),s._v("\nrosbag record -a           "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#录制所有topic到bag文件")]),s._v("\nrosbag play bag_files_name "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#播放bag文件")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br")])]),n("p",[s._v("版权声明：本文为CSDN博主「家门Jm」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。\n原文链接：https://blog.csdn.net/qq_38167930/article/details/119168048")])])}),[],!1,null,null,null);a.default=e.exports}}]);