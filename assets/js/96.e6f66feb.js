(window.webpackJsonp=window.webpackJsonp||[]).push([[96],{719:function(t,s,e){"use strict";e.r(s);var a=e(5),n=Object(a.a)({},(function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[t._v("说明")]),t._v(" "),e("p",[t._v("​\t本文主要介绍Deepface的基本使用，实现人脸识别，包括表情，种族，年龄，性别等识别")]),t._v(" "),e("p",[e("a",{attrs:{href:"www.deep-diary.com"}},[t._v("点击免费观看教学视频")])])]),t._v(" "),e("h1",{attrs:{id:"deepface"}},[t._v("Deepface")]),t._v(" "),e("h2",{attrs:{id:"安装环境"}},[t._v("安装环境")]),t._v(" "),e("p",[e("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/99880204?from_voters_page=true",target:"_blank",rel:"noopener noreferrer"}},[t._v("Windows 安装 CUDA/cuDNN - 知乎 (zhihu.com)"),e("OutboundLink")],1)]),t._v(" "),e("h3",{attrs:{id:"安装cuda"}},[t._v("安装cuda")]),t._v(" "),e("p",[e("strong",[t._v("下载 CUDA")])]),t._v(" "),e("p",[t._v("去 NVIDIA 下载 CUDA，下载地址为："),e("a",{attrs:{href:"https://link.zhihu.com/?target=https%3A//developer.nvidia.com/cuda-downloads",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://developer.nvidia.com/cuda-downloads"),e("OutboundLink")],1),t._v("。本次使用的是 Windows10 64位，因此此处选择 Windows10 64位版本，为了安装方便选择 local 版本。默认的下载是最新版本的 CUDA")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://deep-diary.oss-cn-hangzhou.aliyuncs.com/blog/image-20230526075710709.png",alt:"image-20230526075710709"}})]),t._v(" "),e("p",[t._v("若要下载其他版本的 CUDA，可以点击下面的 "),e("a",{attrs:{href:"https://link.zhihu.com/?target=https%3A//developer.nvidia.com/cuda-toolkit-archive",target:"_blank",rel:"noopener noreferrer"}},[t._v("Legacy Releases"),e("OutboundLink")],1),t._v("，下载自己需要的 CUDA：")]),t._v(" "),e("p",[t._v("11.8")]),t._v(" "),e("h3",{attrs:{id:"安装cudnn"}},[t._v("安装cuDNN")]),t._v(" "),e("p",[t._v("下载 cuDNN，下载之前需要先注册一下 Nvidia 的账号，下载地址为：[cudnn]("),e("a",{attrs:{href:"https://developer.nvidia.com/rdp/cudnn-download",target:"_blank",rel:"noopener noreferrer"}},[t._v("cuDNN Download | NVIDIA Developer"),e("OutboundLink")],1),t._v(") , 根据上面的对应关系，此处下载8.9.1版本：")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://deep-diary.oss-cn-hangzhou.aliyuncs.com/blog/image-20230526220612064.png",alt:"image-20230526220612064"}})]),t._v(" "),e("p",[t._v("下载完成之后将其解压，解压之后的目录如下：")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://deep-diary.oss-cn-hangzhou.aliyuncs.com/blog/v2-e731184dd7b81e8d202156d00dd93de0_1440w.webp",alt:"img"}})]),t._v(" "),e("p",[t._v("需要将以上三个文件复制到CUDA的安装目录中，通过上面的安装，我们将CUDA安装到了 "),e("code",[t._v("C:\\Program Files\\NVIDIA GPU Computing Toolkit\\CUDA\\v10.2")]),t._v("目录中：")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://deep-diary.oss-cn-hangzhou.aliyuncs.com/blog/v2-c19b1beb2a98d8359e65b2c704d76351_1440w.webp",alt:"img"}})]),t._v(" "),e("p",[t._v("那么我们需要将：")]),t._v(" "),e("ul",[e("li",[t._v("cuDNN中"),e("code",[t._v("bin")]),t._v("目录下的文件移动到 CUDA 的 "),e("code",[t._v("bin")]),t._v(" 目录中")])]),t._v(" "),e("p",[e("img",{attrs:{src:"https://deep-diary.oss-cn-hangzhou.aliyuncs.com/blog/v2-a28e9a813ef01a8374743f7de7a83d2a_1440w.webp",alt:"img"}})]),t._v(" "),e("ul",[e("li",[t._v("cuDNN目录中的 "),e("code",[t._v("include")]),t._v(" 中的文件移动到 CUDA 的 "),e("code",[t._v("include")]),t._v(" 目录中")]),t._v(" "),e("li",[t._v("cuDNN目录中的 "),e("code",[t._v("lib")]),t._v(" 中的文件移动到 CUDA 的 "),e("code",[t._v("lib")]),t._v(" 目录中")])]),t._v(" "),e("p",[t._v("这样就完成了cuDNN的安装。")]),t._v(" "),e("h4",{attrs:{id:"验证安装"}},[t._v("验证安装")]),t._v(" "),e("p",[t._v("通过NVIDIA提供的 "),e("code",[t._v("deviceQuery.exe")]),t._v(" 和 "),e("code",[t._v("bandwidthTest.exe")]),t._v(" 来查看GPU的状态，两者均在安装目录的 "),e("code",[t._v("extras\\demo_suite")]),t._v("文件夹中")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://deep-diary.oss-cn-hangzhou.aliyuncs.com/blog/v2-9e325623d4303bef4242e03f5191109f_1440w.webp",alt:"img"}})]),t._v(" "),e("p",[t._v("打开命令窗口，可以用"),e("code",[t._v("cmd")]),t._v(", 或者"),e("code",[t._v("git bash")]),t._v(" , 首先运行 "),e("code",[t._v("deviceQuery.exe")]),t._v(" ，可以看到如下结果：")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://deep-diary.oss-cn-hangzhou.aliyuncs.com/blog/image-20230526221921088.png",alt:"image-20230526221921088"}})]),t._v(" "),e("p",[t._v("运行 "),e("code",[t._v("bandwidthTest.exe")]),t._v(" 看到如下结果：")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://deep-diary.oss-cn-hangzhou.aliyuncs.com/blog/image-20230526222151417.png",alt:"image-20230526222151417"}})]),t._v(" "),e("h3",{attrs:{id:"安装torch"}},[t._v("安装torch")]),t._v(" "),e("p",[e("a",{attrs:{href:"https://pytorch.org/",target:"_blank",rel:"noopener noreferrer"}},[t._v("PyTorch"),e("OutboundLink")],1)]),t._v(" "),e("p",[e("img",{attrs:{src:"https://deep-diary.oss-cn-hangzhou.aliyuncs.com/blog/image-20230526222601527.png",alt:"image-20230526222601527"}})]),t._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("pip3 "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu118\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br")])]),e("p",[t._v("==需要注意的是：cudnn, torch 的版本，都需要保持跟cuda版本一致，这里都是11.8==")]),t._v(" "),e("h3",{attrs:{id:"验证gpu效果"}},[t._v("验证GPU效果")]),t._v(" "),e("div",{staticClass:"language-python line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-python"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" torch\n\ndevice "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"cuda"')]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" torch"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cuda"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("is_available"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"cpu"')]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Using {} device"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("format")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("device"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br")])]),e("p",[t._v("结果输出 "),e("code",[t._v("Using cpu device")])]),t._v(" "),e("div",{staticClass:"language-python line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-python"}},[e("code",[t._v("torch                     "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("2.0")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v(".1")]),t._v("\ntorchaudio                "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("2.0")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v(".2")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("cu118\ntorchvision               "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.15")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v(".2")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br")])]),e("p",[t._v("由于安装了"),e("code",[t._v("sentence_transformers")]),t._v(", torch 等版本被自动安装了，结果GPU效果失效")]),t._v(" "),e("p",[t._v("因此，考虑把原来的torch 卸载掉重装")]),t._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("pip uninstall torch torchvision torchaudio\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br")])]),e("p",[t._v("再次执行")]),t._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("pip3 "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu118\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br")])]),e("p",[t._v("输出")]),t._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("D:"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("BlueDoc"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("DiaryWin"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("venv"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("Scripts"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("python.exe D:"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("BlueDoc"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("DiaryWin"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("code"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("image"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("clip.py \nUsing cuda device\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br")])]),e("p",[t._v("大功告成")]),t._v(" "),e("h3",{attrs:{id:"安装deepface"}},[t._v("安装Deepface")]),t._v(" "),e("p",[e("a",{attrs:{href:"https://github.com/salesforce/LAVIS",target:"_blank",rel:"noopener noreferrer"}},[t._v("GitHub - salesforce/LAVIS: LAVIS - A One-stop Library for Language-Vision Intelligence"),e("OutboundLink")],1)]),t._v(" "),e("div",{staticClass:"language-python line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-python"}},[e("code",[t._v("pip install deepface\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br")])]),e("h2",{attrs:{id:"简单使用"}},[t._v("简单使用")]),t._v(" "),e("h2",{attrs:{id:"更新记录"}},[t._v("更新记录")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("Date")]),t._v(" "),e("th",[t._v("Updated Info")]),t._v(" "),e("th",[t._v("Address")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("2023-06-09")]),t._v(" "),e("td",[t._v("init")]),t._v(" "),e("td",[t._v("@ 杭州湾luckin")])]),t._v(" "),e("tr",[e("td"),t._v(" "),e("td"),t._v(" "),e("td")]),t._v(" "),e("tr",[e("td"),t._v(" "),e("td"),t._v(" "),e("td")]),t._v(" "),e("tr",[e("td"),t._v(" "),e("td"),t._v(" "),e("td")]),t._v(" "),e("tr",[e("td"),t._v(" "),e("td"),t._v(" "),e("td")])])])])}),[],!1,null,null,null);s.default=n.exports}}]);