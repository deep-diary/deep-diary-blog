(window.webpackJsonp=window.webpackJsonp||[]).push([[42],{666:function(s,a,e){"use strict";e.r(a);var t=e(5),n=Object(t.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[s._v("说明")]),s._v(" "),e("p",[s._v("用户访问网址的时候，往往需要快速响应，比如200ms。但是，实际过程中，涉及到上传图片，人脸识别，同步数据到mcs等一些耗时的操作，就是造成io 堵塞，导致用户等待过长的不良体验，因此，需要使用异步消息队列，处理这个问题")]),s._v(" "),e("p",[e("a",{attrs:{href:"www.deep-diary.com"}},[s._v("点击免费观看教学视频")])])]),s._v(" "),e("h1",{attrs:{id:"django-异步任务处理"}},[s._v("Django 异步任务处理")]),s._v(" "),e("blockquote",[e("p",[e("a",{attrs:{href:"https://www.cnblogs.com/pyedu/p/12461819.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("牛哄哄的celery - Mr·Yuan - 博客园 (cnblogs.com)"),e("OutboundLink")],1)]),s._v(" "),e("p",[e("a",{attrs:{href:"https://blog.csdn.net/kk123a/article/details/74549117",target:"_blank",rel:"noopener noreferrer"}},[s._v("celery配置使用_kk123a的博客-CSDN博客_celery配置"),e("OutboundLink")],1)])]),s._v(" "),e("h2",{attrs:{id:"celery-异步任务"}},[s._v("Celery 异步任务")]),s._v(" "),e("p",[s._v("版本")]),s._v(" "),e("div",{staticClass:"language-python line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-python"}},[e("code",[s._v("redis                         "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.3")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v(".4")]),s._v("\ncelery                        "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.2")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v(".7")]),s._v("\n\ncelery"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("with")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("redis             "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.0")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 弃用")]),s._v("\ndjango"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("redis                  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.2")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),s._v("\n\neventlet\t\t\t\t\t"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.33")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),s._v("\n\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动定时器")]),s._v("\ncelery "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("A mycelery"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("main beat\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动异步任务")]),s._v("\ncelery "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("A mycelery"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("main worker "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("loglevel"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("info "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("P eventlet\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br")])]),e("h3",{attrs:{id:"启动redis服务"}},[s._v("启动redis服务")]),s._v(" "),e("h4",{attrs:{id:"win10-下安装redis"}},[s._v("win10 下安装redis")]),s._v(" "),e("blockquote",[e("p",[e("a",{attrs:{href:"https://blog.csdn.net/c_lanxiaofang/article/details/108373920",target:"_blank",rel:"noopener noreferrer"}},[s._v("Windows10下 Redis在Django中的使用_懒笑翻的博客-CSDN博客"),e("OutboundLink")],1)])]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("安装命令：redis-server.exe --service-install redis.windows.conf --loglevel verbose\n \n启动服务命令：redis-server.exe  --service-start\n \n关闭服务命令：redis-server.exe  --service-stop\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("h4",{attrs:{id:"客户端联系redis服务"}},[s._v("客户端联系redis服务")]),s._v(" "),e("p",[s._v("need enter the redis intall folder to active this cmd")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("D:"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Program Files"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Redis"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("redis-cli.exe -h "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1 -p "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h4",{attrs:{id:"redis-使用"}},[s._v("redis 使用")]),s._v(" "),e("blockquote",[e("p",[e("a",{attrs:{href:"https://blog.csdn.net/jiandanokok/article/details/109426427",target:"_blank",rel:"noopener noreferrer"}},[s._v("【Django】Redis的使用【原创】_jiandanokok的博客-CSDN博客"),e("OutboundLink")],1)])]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("删除所有Key，可以使用Redis的flushdb和flushall命令\n\n//删除当前数据库中的所有Key\nflushdb\n//删除所有数据库中的key\nflushall\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("h3",{attrs:{id:"安装中间人broker-我们使用redis作为中间人"}},[s._v("安装中间人"),e("code",[s._v("broker")]),s._v("，我们使用"),e("code",[s._v("redis")]),s._v("作为中间人")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("pip "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" redis  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# redis 版本不能太高")]),s._v("\npip "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" celery\npip "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" celery-with-redis\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("h3",{attrs:{id:"在setting中配置celery"}},[s._v("在"),e("code",[s._v("setting")]),s._v("中配置celery")]),s._v(" "),e("div",{staticClass:"language-python line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-python"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置celery")]),s._v("\nBROKER_URL "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'redis://localhost:6379/0'")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置用户存储结果")]),s._v("\nCELER_RESULT_BACKEND "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'redis://localhost:6379/0'")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 连接超时")]),s._v("\nBROKER_TRANSPORT_OPTIONS "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'visibility_timeout'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3600")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("p",[s._v("......")]),s._v(" "),e("h3",{attrs:{id:"在项目中配置celery"}},[s._v("在项目中配置"),e("code",[s._v("celery")])]),s._v(" "),e("p",[s._v("新增一个"),e("code",[s._v("celery.py")]),s._v("，配置celery作为单独的线程")]),s._v(" "),e("h4",{attrs:{id:"在项目的同名文件夹下新建一个celery同名文件夹"}},[s._v("在项目的同名文件夹下新建一个"),e("code",[s._v("celery")]),s._v("同名文件夹")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://deep-diary.oss-cn-hangzhou.aliyuncs.com/blog/image-20220904142117018.png",alt:"image-20220904142117018"}})]),s._v(" "),e("h4",{attrs:{id:"在-init-py中导入celery"}},[s._v("在__init__.py中导入"),e("code",[s._v("celery")])]),s._v(" "),e("p",[e("img",{attrs:{src:"https://deep-diary.oss-cn-hangzhou.aliyuncs.com/blog/image-20220904142615869.png",alt:"image-20220904142615869"}})]),s._v(" "),e("h3",{attrs:{id:"在应用中定义任务"}},[s._v("在应用中定义任务")]),s._v(" "),e("p",[s._v("在需要使用异步的"),e("code",[s._v("app")]),s._v("中定义一个叫"),e("code",[s._v("task.py")])]),s._v(" "),e("div",{staticClass:"language-python line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-python"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 任务都写到应用中的task.py中")]),s._v("\n\n@ shared_task\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("my_task")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("q"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" b"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("pass")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("h3",{attrs:{id:"调用异步任务"}},[s._v("调用异步任务")]),s._v(" "),e("div",{staticClass:"language-python line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-python"}},[e("code",[s._v("my_task"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("delay"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("a"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("b"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("h3",{attrs:{id:"测试启动异步"}},[s._v("测试启动异步")]),s._v(" "),e("p",[s._v("启动celery 之前，需要启动redis")]),s._v(" "),e("div",{staticClass:"language-python line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-python"}},[e("code",[s._v("celery "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("A deep_diary worker "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("loglevel"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("info "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("P eventlet\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("成功启动后，这边就会打印相关信息")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v(" -------------- celery@Blue v3.1.26.post2 "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Cipater"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n---- **** -----\n--- * ***  * -- Windows-10-10.0.19041-SP0\n-- * - **** ---\n- ** ---------- "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("config"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n- ** ---------- ."),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" app:         deep_diary:0x2586c07e340\n- ** ---------- ."),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" transport:   redis://localhost:6379/2\n- ** ---------- ."),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" results:     redis://localhost:6379/1\n- *** --- * --- ."),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" concurrency: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("prefork"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n-- ******* ----\n--- ***** ----- "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("queues"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n -------------- ."),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" celery           "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("exchange")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("celery"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("direct"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("key")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("celery\n\n\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("tasks"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" imagekit.cachefiles.backends._generate_file\n  "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" library.task.send_email\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br")])]),e("h3",{attrs:{id:"错误"}},[s._v("错误")]),s._v(" "),e("h4",{attrs:{id:"async-与系统关键字冲突"}},[s._v("async 与系统关键字冲突")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v(" from kombu.async.timer "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("import")]),s._v(" Entry, Timer as Schedule, to_timestamp, logger\n SyntaxError: invalid syntax\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("blockquote",[e("p",[e("a",{attrs:{href:"https://blog.csdn.net/qq_51236600/article/details/116681098",target:"_blank",rel:"noopener noreferrer"}},[s._v("报错”from kombu.async.timer import Entry, Timer as Schedule, to_timestamp, logger”_默&墨的博客-CSDN博客"),e("OutboundLink")],1)])]),s._v(" "),e("p",[s._v("把用到"),e("code",[s._v("async")]),s._v("的包，都换成"),e("code",[s._v("asynchronous")]),s._v("，或者更新版本")]),s._v(" "),e("div",{staticClass:"language-python line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-python"}},[e("code",[s._v("redis                         "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.3")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v(".4")]),s._v("\ncelery                        "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.2")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v(".7")]),s._v("\ncelery"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("with")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("redis             "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.0")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 弃用")]),s._v("\ndjango"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("redis                  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.2")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),s._v("\neventlet\t\t\t\t\t"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.33")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),s._v("\ncelery "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("A deep_diary beat\ncelery "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("A deep_diary worker "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("loglevel"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("info "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("P eventlet\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("h4",{attrs:{id:"kombu-exceptions-encodeerror"}},[s._v("kombu.exceptions.EncodeError")]),s._v(" "),e("p",[s._v("kombu.exceptions.EncodeError: Object of type Img is not JSON serializable")]),s._v(" "),e("p",[s._v("措施")]),s._v(" "),e("div",{staticClass:"language-python line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-python"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# using serializer name")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 以下默认为`json`，需要改为pickle即可")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 另外值得注意的是，在新版本中，官方推荐用小写字母方式进行配置")]),s._v("\naccept_content "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'json'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'pickle'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\ntask_serializer "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'pickle'")]),s._v("\nresult_serializer "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'pickle'")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("h4",{attrs:{id:"raised-unexpected-valueerror-code-32000-message-already-known"}},[s._v("raised unexpected: ValueError({'code': -32000, 'message': 'already known'})")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("\n  File "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"D:\\BlueDoc\\DeepDiary\\Backend'),e("span",{pre:!0,attrs:{class:"token entity",title:"\\f"}},[s._v("\\f")]),s._v('ace\\jtask.py"')]),s._v(", line "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("268")]),s._v(", "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" upload_face_to_mcs\n    data "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" upload_file_pay"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("wallet_info, fc_obj.src.path"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  File "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"D:\\BlueDoc\\DeepDiary\\Backend\\utils\\mcs_storage.py"')]),s._v(", line "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("48")]),s._v(", "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" upload_file_pay\n    w3_api "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" approve_usdc"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("wallet_info"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Usdc approve needs to be performed one step before payment.")]),s._v("\n  File "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"D:\\BlueDoc\\DeepDiary\\Backend\\utils\\mcs_storage.py"')]),s._v(", line "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("35")]),s._v(", "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" approve_usdc\n    w3_api.approve_usdc"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("wallet_info"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'wallet_address'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\n  File "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"D:\\BlueDoc\\DeepDiary\\Backend'),e("span",{pre:!0,attrs:{class:"token entity",title:"\\e"}},[s._v("\\e")]),s._v("nv\\lib\\site-packages\\mcs"),e("span",{pre:!0,attrs:{class:"token entity",title:"\\c"}},[s._v("\\c")]),s._v('ontract\\mcs_contract.py"')]),s._v(", line "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("28")]),s._v(", "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" approve_usdc\n    tx_hash "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" self.w3.eth.sendRawTransaction"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("signed_tx.rawTransaction"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  File "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"D:\\BlueDoc\\DeepDiary\\Backend'),e("span",{pre:!0,attrs:{class:"token entity",title:"\\e"}},[s._v("\\e")]),s._v("nv\\lib\\site-packages\\web3"),e("span",{pre:!0,attrs:{class:"token entity",title:"\\e"}},[s._v("\\e")]),s._v('th.py"')]),s._v(", line "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("831")]),s._v(", "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" send_raw_transaction\n    "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("return")]),s._v(" self._send_raw_transaction"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("transaction"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  File "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"D:\\BlueDoc\\DeepDiary\\Backend'),e("span",{pre:!0,attrs:{class:"token entity",title:"\\e"}},[s._v("\\e")]),s._v('nv\\lib\\site-packages\\web3\\module.py"')]),s._v(", line "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("57")]),s._v(", "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("caller")]),s._v("\n    result "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" w3.manager.request_blocking"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("method_str,\n  File "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"D:\\BlueDoc\\DeepDiary\\Backend'),e("span",{pre:!0,attrs:{class:"token entity",title:"\\e"}},[s._v("\\e")]),s._v('nv\\lib\\site-packages\\web3\\manager.py"')]),s._v(", line "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("198")]),s._v(", "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" request_blocking\n    "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("return")]),s._v(" self.formatted_response"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("response,\n  File "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"D:\\BlueDoc\\DeepDiary\\Backend'),e("span",{pre:!0,attrs:{class:"token entity",title:"\\e"}},[s._v("\\e")]),s._v('nv\\lib\\site-packages\\web3\\manager.py"')]),s._v(", line "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("171")]),s._v(", "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" formatted_response\n    raise ValueError"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("response"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"error"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nValueError: "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'code'")]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" -32000, "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'message'")]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'already known'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br")])]),e("h3",{attrs:{id:"django-调用redis"}},[s._v("django 调用redis")]),s._v(" "),e("blockquote",[e("p",[e("a",{attrs:{href:"https://blog.csdn.net/jiandanokok/article/details/109426427",target:"_blank",rel:"noopener noreferrer"}},[s._v("【Django】Redis的使用【原创】_jiandanokok的博客-CSDN博客"),e("OutboundLink")],1)])]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("\npip "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" django-redis  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装django-redis模块")]),s._v("\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("h2",{attrs:{id:"定时任务"}},[s._v("定时任务")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://deep-diary.oss-cn-hangzhou.aliyuncs.com/blog/image-20220904143634017.png",alt:"image-20220904143634017"}})])])}),[],!1,null,null,null);a.default=n.exports}}]);