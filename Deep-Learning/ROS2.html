<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ROS2 | Deep Diary</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="apple-touch-icon" sizes="180x180" href="/static/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/static/favicon/static/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/static/favicon/static/favicon-16x16.png">
    <link rel="manifest" href="/manifest.json">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css">
    <link rel="stylesheet" href="/static/css/style.css">
    <script charset="utf-8" src="/static/js/custom.js"></script>
    <meta name="description" content="基于深度学习，专注于旅游，记忆追溯相关的开发">
    <meta name="theme-color" content="#ffffff">
    <meta name="google-site-verification">
    <meta name="keywords" content="深记,deep-diary,自建博客,葛维冬，深度学习，记忆追溯">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <meta name="robots" content="all">
    <meta name="author" content="deep-diary">
    
    <link rel="preload" href="/assets/css/0.styles.bfd62ff8.css" as="style"><link rel="preload" href="/assets/js/app.b92d5d04.js" as="script"><link rel="preload" href="/assets/js/4.5e854a94.js" as="script"><link rel="preload" href="/assets/js/1.650e7656.js" as="script"><link rel="preload" href="/assets/js/16.ca06e55e.js" as="script"><link rel="preload" href="/assets/js/10.51e38269.js" as="script"><link rel="prefetch" href="/assets/js/100.153d8fba.js"><link rel="prefetch" href="/assets/js/101.988a11b7.js"><link rel="prefetch" href="/assets/js/102.149f2f35.js"><link rel="prefetch" href="/assets/js/103.06545d39.js"><link rel="prefetch" href="/assets/js/104.ec341d13.js"><link rel="prefetch" href="/assets/js/105.07874118.js"><link rel="prefetch" href="/assets/js/106.60917eb0.js"><link rel="prefetch" href="/assets/js/107.dc1ecdad.js"><link rel="prefetch" href="/assets/js/108.ac91e946.js"><link rel="prefetch" href="/assets/js/109.4377024f.js"><link rel="prefetch" href="/assets/js/11.eca28194.js"><link rel="prefetch" href="/assets/js/110.0b4e9261.js"><link rel="prefetch" href="/assets/js/111.b0e36156.js"><link rel="prefetch" href="/assets/js/112.6710a467.js"><link rel="prefetch" href="/assets/js/113.470af89c.js"><link rel="prefetch" href="/assets/js/114.98ce2239.js"><link rel="prefetch" href="/assets/js/115.a0cfd8c2.js"><link rel="prefetch" href="/assets/js/116.362cb8af.js"><link rel="prefetch" href="/assets/js/117.f94d79d1.js"><link rel="prefetch" href="/assets/js/118.f3361835.js"><link rel="prefetch" href="/assets/js/119.837be686.js"><link rel="prefetch" href="/assets/js/12.58d88b3a.js"><link rel="prefetch" href="/assets/js/120.d83ccafa.js"><link rel="prefetch" href="/assets/js/121.191c05bc.js"><link rel="prefetch" href="/assets/js/122.e53f188b.js"><link rel="prefetch" href="/assets/js/123.7c7c934c.js"><link rel="prefetch" href="/assets/js/124.cfd422f6.js"><link rel="prefetch" href="/assets/js/125.ee023ce3.js"><link rel="prefetch" href="/assets/js/126.7ff9de29.js"><link rel="prefetch" href="/assets/js/127.c828b2ad.js"><link rel="prefetch" href="/assets/js/128.6c9108df.js"><link rel="prefetch" href="/assets/js/129.82f3d7e7.js"><link rel="prefetch" href="/assets/js/13.fd9abc9e.js"><link rel="prefetch" href="/assets/js/130.8bdb6f79.js"><link rel="prefetch" href="/assets/js/131.a4825d42.js"><link rel="prefetch" href="/assets/js/132.dcef7f8b.js"><link rel="prefetch" href="/assets/js/133.5ab27554.js"><link rel="prefetch" href="/assets/js/134.14ffb5db.js"><link rel="prefetch" href="/assets/js/135.473ae75d.js"><link rel="prefetch" href="/assets/js/136.7683160a.js"><link rel="prefetch" href="/assets/js/137.200d667b.js"><link rel="prefetch" href="/assets/js/138.34d1b331.js"><link rel="prefetch" href="/assets/js/139.a41409b8.js"><link rel="prefetch" href="/assets/js/14.a4f3582d.js"><link rel="prefetch" href="/assets/js/140.978b9c80.js"><link rel="prefetch" href="/assets/js/141.4727f8ec.js"><link rel="prefetch" href="/assets/js/142.07282e4d.js"><link rel="prefetch" href="/assets/js/143.4fde995a.js"><link rel="prefetch" href="/assets/js/144.7f8b13c2.js"><link rel="prefetch" href="/assets/js/145.e33414fa.js"><link rel="prefetch" href="/assets/js/146.3e56c826.js"><link rel="prefetch" href="/assets/js/147.26dcb9e1.js"><link rel="prefetch" href="/assets/js/148.8b4e0105.js"><link rel="prefetch" href="/assets/js/149.6bae2527.js"><link rel="prefetch" href="/assets/js/15.71defc2f.js"><link rel="prefetch" href="/assets/js/150.c4747e89.js"><link rel="prefetch" href="/assets/js/151.894b2682.js"><link rel="prefetch" href="/assets/js/152.96b6041a.js"><link rel="prefetch" href="/assets/js/153.10b840e3.js"><link rel="prefetch" href="/assets/js/154.b815412b.js"><link rel="prefetch" href="/assets/js/155.38535922.js"><link rel="prefetch" href="/assets/js/156.3f492b88.js"><link rel="prefetch" href="/assets/js/157.139c8f24.js"><link rel="prefetch" href="/assets/js/158.8b784462.js"><link rel="prefetch" href="/assets/js/17.ab7555cb.js"><link rel="prefetch" href="/assets/js/18.a8c7c83b.js"><link rel="prefetch" href="/assets/js/19.a91b6cd1.js"><link rel="prefetch" href="/assets/js/20.cd25491f.js"><link rel="prefetch" href="/assets/js/21.4edd42a9.js"><link rel="prefetch" href="/assets/js/22.3c33dd7a.js"><link rel="prefetch" href="/assets/js/23.c269d61a.js"><link rel="prefetch" href="/assets/js/24.f6f1b3d8.js"><link rel="prefetch" href="/assets/js/25.5857364b.js"><link rel="prefetch" href="/assets/js/26.c26a971b.js"><link rel="prefetch" href="/assets/js/27.cbc6d6ed.js"><link rel="prefetch" href="/assets/js/28.24448558.js"><link rel="prefetch" href="/assets/js/29.2d68138d.js"><link rel="prefetch" href="/assets/js/30.dadde165.js"><link rel="prefetch" href="/assets/js/31.368a2c10.js"><link rel="prefetch" href="/assets/js/32.872704ca.js"><link rel="prefetch" href="/assets/js/33.46480dbf.js"><link rel="prefetch" href="/assets/js/34.67ab1f72.js"><link rel="prefetch" href="/assets/js/35.13c53d85.js"><link rel="prefetch" href="/assets/js/36.8afd9903.js"><link rel="prefetch" href="/assets/js/37.f88f68d7.js"><link rel="prefetch" href="/assets/js/38.4d24ee94.js"><link rel="prefetch" href="/assets/js/39.5e2df920.js"><link rel="prefetch" href="/assets/js/40.83f10bff.js"><link rel="prefetch" href="/assets/js/41.67c6914c.js"><link rel="prefetch" href="/assets/js/42.e4367ca3.js"><link rel="prefetch" href="/assets/js/43.51eaeed6.js"><link rel="prefetch" href="/assets/js/44.50742ab4.js"><link rel="prefetch" href="/assets/js/45.522f16aa.js"><link rel="prefetch" href="/assets/js/46.fbc888ff.js"><link rel="prefetch" href="/assets/js/47.126e61a0.js"><link rel="prefetch" href="/assets/js/48.e390efe3.js"><link rel="prefetch" href="/assets/js/49.4b5f09f1.js"><link rel="prefetch" href="/assets/js/5.03b654a4.js"><link rel="prefetch" href="/assets/js/50.7bc927a2.js"><link rel="prefetch" href="/assets/js/51.ff5dee65.js"><link rel="prefetch" href="/assets/js/52.bedf26bc.js"><link rel="prefetch" href="/assets/js/53.d057a5b7.js"><link rel="prefetch" href="/assets/js/54.8d632ea8.js"><link rel="prefetch" href="/assets/js/55.49a32146.js"><link rel="prefetch" href="/assets/js/56.5bf71229.js"><link rel="prefetch" href="/assets/js/57.d0034a16.js"><link rel="prefetch" href="/assets/js/58.426559ec.js"><link rel="prefetch" href="/assets/js/59.a8bef30c.js"><link rel="prefetch" href="/assets/js/6.ac399d41.js"><link rel="prefetch" href="/assets/js/60.f76813ae.js"><link rel="prefetch" href="/assets/js/61.c6c6616c.js"><link rel="prefetch" href="/assets/js/62.8cb2bcdd.js"><link rel="prefetch" href="/assets/js/63.ac8364db.js"><link rel="prefetch" href="/assets/js/64.7b97c3d0.js"><link rel="prefetch" href="/assets/js/65.cd196df3.js"><link rel="prefetch" href="/assets/js/66.562c043a.js"><link rel="prefetch" href="/assets/js/67.c2a899c2.js"><link rel="prefetch" href="/assets/js/68.6aec71b0.js"><link rel="prefetch" href="/assets/js/69.34d8c3c9.js"><link rel="prefetch" href="/assets/js/7.706f533b.js"><link rel="prefetch" href="/assets/js/70.e87e9c91.js"><link rel="prefetch" href="/assets/js/71.e82f4279.js"><link rel="prefetch" href="/assets/js/72.bb0d41c1.js"><link rel="prefetch" href="/assets/js/73.093ecbb4.js"><link rel="prefetch" href="/assets/js/74.51a12ae8.js"><link rel="prefetch" href="/assets/js/75.ab39bd82.js"><link rel="prefetch" href="/assets/js/76.57e33f4e.js"><link rel="prefetch" href="/assets/js/77.d6a57c3e.js"><link rel="prefetch" href="/assets/js/78.8447e05a.js"><link rel="prefetch" href="/assets/js/79.7a58c26f.js"><link rel="prefetch" href="/assets/js/8.5e0abf00.js"><link rel="prefetch" href="/assets/js/80.467c53ba.js"><link rel="prefetch" href="/assets/js/81.cb7abee1.js"><link rel="prefetch" href="/assets/js/82.cb2d9268.js"><link rel="prefetch" href="/assets/js/83.8e543a02.js"><link rel="prefetch" href="/assets/js/84.a8d6a005.js"><link rel="prefetch" href="/assets/js/85.1b89b5a6.js"><link rel="prefetch" href="/assets/js/86.59860c0c.js"><link rel="prefetch" href="/assets/js/87.52f241f1.js"><link rel="prefetch" href="/assets/js/88.3f6bca1c.js"><link rel="prefetch" href="/assets/js/89.40ceac1c.js"><link rel="prefetch" href="/assets/js/9.2d9184d6.js"><link rel="prefetch" href="/assets/js/90.92b16cba.js"><link rel="prefetch" href="/assets/js/91.b8b0cec7.js"><link rel="prefetch" href="/assets/js/92.1079fab5.js"><link rel="prefetch" href="/assets/js/93.48425c6d.js"><link rel="prefetch" href="/assets/js/94.c05e300f.js"><link rel="prefetch" href="/assets/js/95.190d4fab.js"><link rel="prefetch" href="/assets/js/96.e6f66feb.js"><link rel="prefetch" href="/assets/js/97.b9ae4b16.js"><link rel="prefetch" href="/assets/js/98.8224ba4c.js"><link rel="prefetch" href="/assets/js/99.a66d3696.js"><link rel="prefetch" href="/assets/js/vendors~flowchart.e51760b9.js">
    <link rel="stylesheet" href="/assets/css/0.styles.bfd62ff8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div><div class="theme-container" data-v-4698c43e><div data-v-4698c43e><div id="loader-wrapper" class="loading-wrapper" data-v-1c4f0192 data-v-4698c43e data-v-4698c43e><div class="loader-main" data-v-1c4f0192><div data-v-1c4f0192></div><div data-v-1c4f0192></div><div data-v-1c4f0192></div><div data-v-1c4f0192></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-6cbeab0a data-v-4698c43e data-v-4698c43e><h3 class="title" style="display:none;" data-v-6cbeab0a data-v-6cbeab0a>Deep Diary</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-6cbeab0a data-v-6cbeab0a><input type="password" value="" data-v-6cbeab0a> <span data-v-6cbeab0a>Konck! Knock!</span> <button data-v-6cbeab0a>OK</button></label> <div class="footer" style="display:none;" data-v-6cbeab0a data-v-6cbeab0a><span data-v-6cbeab0a><i class="iconfont reco-theme" data-v-6cbeab0a></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-6cbeab0a>vuePress-theme-reco</a></span> <span data-v-6cbeab0a><i class="iconfont reco-copyright" data-v-6cbeab0a></i> <a data-v-6cbeab0a><span data-v-6cbeab0a>Blue</span>
            
          <span data-v-6cbeab0a>2022 - </span>
          2023
        </a></span></div></div> <div class="hide" data-v-4698c43e><header class="navbar" data-v-4698c43e><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Deep Diary</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      分类
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/Algorithm/" class="nav-link"><i class="iconfont undefined"></i>
  Algorithm
</a></li><li class="dropdown-item"><!----> <a href="/categories/deep learning/" class="nav-link"><i class="iconfont undefined"></i>
  deep learning
</a></li><li class="dropdown-item"><!----> <a href="/categories/Software/" class="nav-link"><i class="iconfont undefined"></i>
  Software
</a></li><li class="dropdown-item"><!----> <a href="/categories/Embedded/" class="nav-link"><i class="iconfont undefined"></i>
  Embedded
</a></li><li class="dropdown-item"><!----> <a href="/categories/Introduction/" class="nav-link"><i class="iconfont undefined"></i>
  Introduction
</a></li><li class="dropdown-item"><!----> <a href="/categories/ROS/" class="nav-link"><i class="iconfont undefined"></i>
  ROS
</a></li><li class="dropdown-item"><!----> <a href="/categories/Develop/" class="nav-link"><i class="iconfont undefined"></i>
  Develop
</a></li><li class="dropdown-item"><!----> <a href="/categories/Gallery/" class="nav-link"><i class="iconfont undefined"></i>
  Gallery
</a></li><li class="dropdown-item"><!----> <a href="/categories/guide/" class="nav-link"><i class="iconfont undefined"></i>
  guide
</a></li><li class="dropdown-item"><!----> <a href="/categories/conference/" class="nav-link"><i class="iconfont undefined"></i>
  conference
</a></li><li class="dropdown-item"><!----> <a href="/categories/参考资料/" class="nav-link"><i class="iconfont undefined"></i>
  参考资料
</a></li><li class="dropdown-item"><!----> <a href="/categories/ros2/" class="nav-link"><i class="iconfont undefined"></i>
  ros2
</a></li><li class="dropdown-item"><!----> <a href="/categories/blog/" class="nav-link"><i class="iconfont undefined"></i>
  blog
</a></li><li class="dropdown-item"><!----> <a href="/categories/vuepress/" class="nav-link"><i class="iconfont undefined"></i>
  vuepress
</a></li><li class="dropdown-item"><!----> <a href="/categories/DiaryWeb/" class="nav-link"><i class="iconfont undefined"></i>
  DiaryWeb
</a></li><li class="dropdown-item"><!----> <a href="/categories/gallery/" class="nav-link"><i class="iconfont undefined"></i>
  gallery
</a></li><li class="dropdown-item"><!----> <a href="/categories/Django/" class="nav-link"><i class="iconfont undefined"></i>
  Django
</a></li><li class="dropdown-item"><!----> <a href="/categories/diary_server/" class="nav-link"><i class="iconfont undefined"></i>
  diary_server
</a></li><li class="dropdown-item"><!----> <a href="/categories/diary_win/" class="nav-link"><i class="iconfont undefined"></i>
  diary_win
</a></li><li class="dropdown-item"><!----> <a href="/categories/DiaryServer/" class="nav-link"><i class="iconfont undefined"></i>
  DiaryServer
</a></li><li class="dropdown-item"><!----> <a href="/categories/WEB/" class="nav-link"><i class="iconfont undefined"></i>
  WEB
</a></li><li class="dropdown-item"><!----> <a href="/categories/Synology/" class="nav-link"><i class="iconfont undefined"></i>
  Synology
</a></li><li class="dropdown-item"><!----> <a href="/categories/voice/" class="nav-link"><i class="iconfont undefined"></i>
  voice
</a></li><li class="dropdown-item"><!----> <a href="/categories/diary_web/" class="nav-link"><i class="iconfont undefined"></i>
  diary_web
</a></li><li class="dropdown-item"><!----> <a href="/categories/Diary Web/" class="nav-link"><i class="iconfont undefined"></i>
  Diary Web
</a></li><li class="dropdown-item"><!----> <a href="/categories/Diary_win/" class="nav-link"><i class="iconfont undefined"></i>
  Diary_win
</a></li><li class="dropdown-item"><!----> <a href="/categories/UI/" class="nav-link"><i class="iconfont undefined"></i>
  UI
</a></li><li class="dropdown-item"><!----> <a href="/categories/PM/" class="nav-link"><i class="iconfont undefined"></i>
  PM
</a></li><li class="dropdown-item"><!----> <a href="/categories/project/" class="nav-link"><i class="iconfont undefined"></i>
  project
</a></li><li class="dropdown-item"><!----> <a href="/categories/django/" class="nav-link"><i class="iconfont undefined"></i>
  django
</a></li><li class="dropdown-item"><!----> <a href="/categories/database/" class="nav-link"><i class="iconfont undefined"></i>
  database
</a></li><li class="dropdown-item"><!----> <a href="/categories/Linux/" class="nav-link"><i class="iconfont undefined"></i>
  Linux
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-faq"></i>
      Guide
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/guide/" class="nav-link"><i class="iconfont undefined"></i>
  Guide
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont undefined"></i>
      Project
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Project/management/" class="nav-link"><i class="iconfont undefined"></i>
  Management
</a></li><li class="dropdown-item"><!----> <a href="/project/blog/" class="nav-link"><i class="iconfont undefined"></i>
  Blog
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont undefined"></i>
      Embedded
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Embedded/" class="nav-link"><i class="iconfont undefined"></i>
  Embedded
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont undefined"></i>
      Deep Learning
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Deep-Learning/" class="nav-link router-link-active"><i class="iconfont undefined"></i>
  Deep Learning
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont undefined"></i>
      Web
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Web/Backend/Django/" class="nav-link"><i class="iconfont undefined"></i>
  Django
</a></li><li class="dropdown-item"><!----> <a href="/web/Database/mysql/" class="nav-link"><i class="iconfont undefined"></i>
  Mysql
</a></li><li class="dropdown-item"><!----> <a href="/web/backend/nginx/" class="nav-link"><i class="iconfont undefined"></i>
  Nginx
</a></li><li class="dropdown-item"><!----> <a href="/web/frondend/vue/" class="nav-link"><i class="iconfont undefined"></i>
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/web/Database/" class="nav-link"><i class="iconfont undefined"></i>
  Database
</a></li><li class="dropdown-item"><!----> <a href="/web/Linux/" class="nav-link"><i class="iconfont undefined"></i>
  Linux
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont undefined"></i>
      Software
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Software/" class="nav-link"><i class="iconfont undefined"></i>
  Software
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-date"></i>
      Algorithm
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Algorithm/" class="nav-link"><i class="iconfont undefined"></i>
  Algorithm
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-4698c43e></div> <aside class="sidebar" data-v-4698c43e><div class="personal-info-wrapper" data-v-6c8ffc9c><img src="/static/avatar.png" alt="author-avatar" class="personal-img" data-v-6c8ffc9c> <h3 class="name" data-v-6c8ffc9c>
    Blue
  </h3> <div class="num" data-v-6c8ffc9c><div data-v-6c8ffc9c><h3 data-v-6c8ffc9c>119</h3> <h6 data-v-6c8ffc9c>文章</h6></div> <div data-v-6c8ffc9c><h3 data-v-6c8ffc9c>129</h3> <h6 data-v-6c8ffc9c>标签</h6></div></div> <hr data-v-6c8ffc9c></div> <nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      分类
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/Algorithm/" class="nav-link"><i class="iconfont undefined"></i>
  Algorithm
</a></li><li class="dropdown-item"><!----> <a href="/categories/deep learning/" class="nav-link"><i class="iconfont undefined"></i>
  deep learning
</a></li><li class="dropdown-item"><!----> <a href="/categories/Software/" class="nav-link"><i class="iconfont undefined"></i>
  Software
</a></li><li class="dropdown-item"><!----> <a href="/categories/Embedded/" class="nav-link"><i class="iconfont undefined"></i>
  Embedded
</a></li><li class="dropdown-item"><!----> <a href="/categories/Introduction/" class="nav-link"><i class="iconfont undefined"></i>
  Introduction
</a></li><li class="dropdown-item"><!----> <a href="/categories/ROS/" class="nav-link"><i class="iconfont undefined"></i>
  ROS
</a></li><li class="dropdown-item"><!----> <a href="/categories/Develop/" class="nav-link"><i class="iconfont undefined"></i>
  Develop
</a></li><li class="dropdown-item"><!----> <a href="/categories/Gallery/" class="nav-link"><i class="iconfont undefined"></i>
  Gallery
</a></li><li class="dropdown-item"><!----> <a href="/categories/guide/" class="nav-link"><i class="iconfont undefined"></i>
  guide
</a></li><li class="dropdown-item"><!----> <a href="/categories/conference/" class="nav-link"><i class="iconfont undefined"></i>
  conference
</a></li><li class="dropdown-item"><!----> <a href="/categories/参考资料/" class="nav-link"><i class="iconfont undefined"></i>
  参考资料
</a></li><li class="dropdown-item"><!----> <a href="/categories/ros2/" class="nav-link"><i class="iconfont undefined"></i>
  ros2
</a></li><li class="dropdown-item"><!----> <a href="/categories/blog/" class="nav-link"><i class="iconfont undefined"></i>
  blog
</a></li><li class="dropdown-item"><!----> <a href="/categories/vuepress/" class="nav-link"><i class="iconfont undefined"></i>
  vuepress
</a></li><li class="dropdown-item"><!----> <a href="/categories/DiaryWeb/" class="nav-link"><i class="iconfont undefined"></i>
  DiaryWeb
</a></li><li class="dropdown-item"><!----> <a href="/categories/gallery/" class="nav-link"><i class="iconfont undefined"></i>
  gallery
</a></li><li class="dropdown-item"><!----> <a href="/categories/Django/" class="nav-link"><i class="iconfont undefined"></i>
  Django
</a></li><li class="dropdown-item"><!----> <a href="/categories/diary_server/" class="nav-link"><i class="iconfont undefined"></i>
  diary_server
</a></li><li class="dropdown-item"><!----> <a href="/categories/diary_win/" class="nav-link"><i class="iconfont undefined"></i>
  diary_win
</a></li><li class="dropdown-item"><!----> <a href="/categories/DiaryServer/" class="nav-link"><i class="iconfont undefined"></i>
  DiaryServer
</a></li><li class="dropdown-item"><!----> <a href="/categories/WEB/" class="nav-link"><i class="iconfont undefined"></i>
  WEB
</a></li><li class="dropdown-item"><!----> <a href="/categories/Synology/" class="nav-link"><i class="iconfont undefined"></i>
  Synology
</a></li><li class="dropdown-item"><!----> <a href="/categories/voice/" class="nav-link"><i class="iconfont undefined"></i>
  voice
</a></li><li class="dropdown-item"><!----> <a href="/categories/diary_web/" class="nav-link"><i class="iconfont undefined"></i>
  diary_web
</a></li><li class="dropdown-item"><!----> <a href="/categories/Diary Web/" class="nav-link"><i class="iconfont undefined"></i>
  Diary Web
</a></li><li class="dropdown-item"><!----> <a href="/categories/Diary_win/" class="nav-link"><i class="iconfont undefined"></i>
  Diary_win
</a></li><li class="dropdown-item"><!----> <a href="/categories/UI/" class="nav-link"><i class="iconfont undefined"></i>
  UI
</a></li><li class="dropdown-item"><!----> <a href="/categories/PM/" class="nav-link"><i class="iconfont undefined"></i>
  PM
</a></li><li class="dropdown-item"><!----> <a href="/categories/project/" class="nav-link"><i class="iconfont undefined"></i>
  project
</a></li><li class="dropdown-item"><!----> <a href="/categories/django/" class="nav-link"><i class="iconfont undefined"></i>
  django
</a></li><li class="dropdown-item"><!----> <a href="/categories/database/" class="nav-link"><i class="iconfont undefined"></i>
  database
</a></li><li class="dropdown-item"><!----> <a href="/categories/Linux/" class="nav-link"><i class="iconfont undefined"></i>
  Linux
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-faq"></i>
      Guide
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/guide/" class="nav-link"><i class="iconfont undefined"></i>
  Guide
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont undefined"></i>
      Project
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Project/management/" class="nav-link"><i class="iconfont undefined"></i>
  Management
</a></li><li class="dropdown-item"><!----> <a href="/project/blog/" class="nav-link"><i class="iconfont undefined"></i>
  Blog
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont undefined"></i>
      Embedded
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Embedded/" class="nav-link"><i class="iconfont undefined"></i>
  Embedded
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont undefined"></i>
      Deep Learning
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Deep-Learning/" class="nav-link router-link-active"><i class="iconfont undefined"></i>
  Deep Learning
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont undefined"></i>
      Web
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Web/Backend/Django/" class="nav-link"><i class="iconfont undefined"></i>
  Django
</a></li><li class="dropdown-item"><!----> <a href="/web/Database/mysql/" class="nav-link"><i class="iconfont undefined"></i>
  Mysql
</a></li><li class="dropdown-item"><!----> <a href="/web/backend/nginx/" class="nav-link"><i class="iconfont undefined"></i>
  Nginx
</a></li><li class="dropdown-item"><!----> <a href="/web/frondend/vue/" class="nav-link"><i class="iconfont undefined"></i>
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/web/Database/" class="nav-link"><i class="iconfont undefined"></i>
  Database
</a></li><li class="dropdown-item"><!----> <a href="/web/Linux/" class="nav-link"><i class="iconfont undefined"></i>
  Linux
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont undefined"></i>
      Software
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Software/" class="nav-link"><i class="iconfont undefined"></i>
  Software
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-date"></i>
      Algorithm
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Algorithm/" class="nav-link"><i class="iconfont undefined"></i>
  Algorithm
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Deep Learning</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Deep-Learning/" aria-current="page" class="sidebar-link">Introduction of Deep Learning</a></li><li><a href="/Deep-Learning/ROS 智盒.html" class="sidebar-link">ROS 智盒</a></li><li><a href="/Deep-Learning/ROS2.html" aria-current="page" class="active sidebar-link">ROS2</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Deep-Learning/ROS2.html#ros2-and-ros" class="sidebar-link">ros2 and ros</a></li><li class="sidebar-sub-header"><a href="/Deep-Learning/ROS2.html#ros2-installation" class="sidebar-link">ros2 installation</a></li><li class="sidebar-sub-header"><a href="/Deep-Learning/ROS2.html#ros2-command" class="sidebar-link">ros2 command</a></li><li class="sidebar-sub-header"><a href="/Deep-Learning/ROS2.html#ros2-environment" class="sidebar-link">ros2 environment</a></li><li class="sidebar-sub-header"><a href="/Deep-Learning/ROS2.html#workspace-and-package" class="sidebar-link">workspace and package</a></li><li class="sidebar-sub-header"><a href="/Deep-Learning/ROS2.html#node" class="sidebar-link">node</a></li><li class="sidebar-sub-header"><a href="/Deep-Learning/ROS2.html#topic" class="sidebar-link">topic</a></li><li class="sidebar-sub-header"><a href="/Deep-Learning/ROS2.html#service" class="sidebar-link">service</a></li><li class="sidebar-sub-header"><a href="/Deep-Learning/ROS2.html#communication-interface" class="sidebar-link">communication interface</a></li><li class="sidebar-sub-header"><a href="/Deep-Learning/ROS2.html#action" class="sidebar-link">action</a></li><li class="sidebar-sub-header"><a href="/Deep-Learning/ROS2.html#parameter" class="sidebar-link">parameter</a></li><li class="sidebar-sub-header"><a href="/Deep-Learning/ROS2.html#distributed-communication" class="sidebar-link">distributed communication</a></li><li class="sidebar-sub-header"><a href="/Deep-Learning/ROS2.html#dds" class="sidebar-link">DDS</a></li><li class="sidebar-sub-header"><a href="/Deep-Learning/ROS2.html#launch" class="sidebar-link">launch</a></li><li class="sidebar-sub-header"><a href="/Deep-Learning/ROS2.html#tf-机器人坐标系管理神器" class="sidebar-link">TF: 机器人坐标系管理神器</a></li><li class="sidebar-sub-header"><a href="/Deep-Learning/ROS2.html#urdf-ros机器人建模方法" class="sidebar-link">URDF：ROS机器人建模方法</a></li><li class="sidebar-sub-header"><a href="/Deep-Learning/ROS2.html#gazebo-三维物理仿真平台" class="sidebar-link">Gazebo: 三维物理仿真平台</a></li><li class="sidebar-sub-header"><a href="/Deep-Learning/ROS2.html#rviz-三维可视化显示平台" class="sidebar-link">Rviz: 三维可视化显示平台</a></li><li class="sidebar-sub-header"><a href="/Deep-Learning/ROS2.html#rqt-模块化可视工具" class="sidebar-link">RQT: 模块化可视工具</a></li><li class="sidebar-sub-header"><a href="/Deep-Learning/ROS2.html#ros中订阅-subscribe-最新消息以及消息队列相关问题" class="sidebar-link">ROS中订阅（Subscribe）最新消息以及消息队列相关问题</a></li><li class="sidebar-sub-header"><a href="/Deep-Learning/ROS2.html#launch文件的写法" class="sidebar-link">launch文件的写法</a></li><li class="sidebar-sub-header"><a href="/Deep-Learning/ROS2.html#ros1通信模型" class="sidebar-link">ros1通信模型</a></li><li class="sidebar-sub-header"><a href="/Deep-Learning/ROS2.html#ros的总体设计目标" class="sidebar-link">ROS的总体设计目标</a></li><li class="sidebar-sub-header"><a href="/Deep-Learning/ROS2.html#ros的应用框架是怎样的" class="sidebar-link">ROS的应用框架是怎样的？</a></li><li class="sidebar-sub-header"><a href="/Deep-Learning/ROS2.html#如何新建一个工作空间" class="sidebar-link">如何新建一个工作空间？</a></li><li class="sidebar-sub-header"><a href="/Deep-Learning/ROS2.html#如何新建一个功能包" class="sidebar-link">如何新建一个功能包？</a></li><li class="sidebar-sub-header"><a href="/Deep-Learning/ROS2.html#如何新建一个ros节点" class="sidebar-link">如何新建一个ROS节点？</a></li><li class="sidebar-sub-header"><a href="/Deep-Learning/ROS2.html#如何在一个ros节点文件中调用其他的源文件" class="sidebar-link">如何在一个ros节点文件中调用其他的源文件？</a></li><li class="sidebar-sub-header"><a href="/Deep-Learning/ROS2.html#如何设置两台机器的分布式通信" class="sidebar-link">如何设置两台机器的分布式通信？</a></li><li class="sidebar-sub-header"><a href="/Deep-Learning/ROS2.html#ros开发常用的工具" class="sidebar-link">ROS开发常用的工具</a></li><li class="sidebar-sub-header"><a href="/Deep-Learning/ROS2.html#ros的常用命令" class="sidebar-link">ROS的常用命令</a></li></ul></li></ul></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-6cbeab0a data-v-4698c43e><h3 class="title" style="display:none;" data-v-6cbeab0a data-v-6cbeab0a>ROS2</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-6cbeab0a data-v-6cbeab0a><input type="password" value="" data-v-6cbeab0a> <span data-v-6cbeab0a>Konck! Knock!</span> <button data-v-6cbeab0a>OK</button></label> <div class="footer" style="display:none;" data-v-6cbeab0a data-v-6cbeab0a><span data-v-6cbeab0a><i class="iconfont reco-theme" data-v-6cbeab0a></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-6cbeab0a>vuePress-theme-reco</a></span> <span data-v-6cbeab0a><i class="iconfont reco-copyright" data-v-6cbeab0a></i> <a data-v-6cbeab0a><span data-v-6cbeab0a>Blue</span>
            
          <span data-v-6cbeab0a>2022 - </span>
          2023
        </a></span></div></div> <div data-v-4698c43e><main class="page"><!----> <div class="page-title" style="display:none;"><h1>ROS2</h1> <hr> <div data-v-484a899e><i class="iconfont reco-account" data-v-484a899e><span data-v-484a899e>Blue</span></i> <i class="iconfont reco-date" data-v-484a899e><span data-v-484a899e>2023-04-08</span></i> <!----> <i class="iconfont reco-tag tags" data-v-484a899e><span class="tag-item" data-v-484a899e>
      ros2
    </span><span class="tag-item" data-v-484a899e>
      robot
    </span></i></div></div> <div class="theme-reco-content content__default" style="display:none;"><div class="custom-block tip"><p class="custom-block-title">说明</p> <p>​	ROS2主要针对机器人设计的一套系统，可以把机器人看作由多个节点组成，比如传感有多个节点，执行有多个节点，后续如果做机器人开发ROS2是最好的选择。</p> <p><a href="www.deep-diary.com">点击免费观看教学视频</a></p></div> <h1 id="ros2">ROS2</h1> <h2 id="ros2-and-ros">ros2 and ros</h2> <p><img src="https://deep-diary.oss-cn-hangzhou.aliyuncs.com/blog/image-20230226102741700.png" alt="image-20230226102741700"></p> <p>编程方式不同</p> <p>ros1基于函数，ros2基于类</p> <h2 id="ros2-installation">ros2 installation</h2> <p>vmware</p> <p><a href="https://www.vmware.com/products/workstation-pro/workstation-pro-evaluation.html" target="_blank" rel="noopener noreferrer">Download VMware Workstation Pro<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>许可证密钥</p> <p>JU090-6039P-08409-8J0QH-2YR7F</p> <p>Ubuntu 22.04 LTS</p> <p><a href="https://ubuntu.com/download/desktop/thank-you?version=22.04.2&amp;architecture=amd64" target="_blank" rel="noopener noreferrer">Thank you for downloading Ubuntu Desktop | Ubuntu<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>安装虚拟机的时候，发现C盘不够了，就准备删掉一些东西</p> <p><img src="https://deep-diary.oss-cn-hangzhou.aliyuncs.com/blog/image-20230226110905967.png" alt="image-20230226110905967"></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>如果要删除hiberfil.sys文件，不再使用休眠功能，只需在cmd 里面打如下命令

Powercfg -h off

Hibernate.sys文件就消失了。下次如果还是想要使用休眠功能，可以打如下命令开启

Powercfg -h on
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><a href="https://www.guyuehome.com/38278" target="_blank" rel="noopener noreferrer">《ROS2入门21讲图文教程 | 3、ROS2安装方法》 - 古月居 (guyuehome.com)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="ros2-command">ros2 command</h2> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>    <span class="token number">1</span>  ros2 run demo_nodes_py listener
    <span class="token number">2</span>  ros2 <span class="token function">node</span>
    <span class="token number">3</span>  ros2 <span class="token function">node</span> list
    <span class="token number">4</span>  ros2 <span class="token function">node</span> info
    <span class="token number">5</span>  ros2 <span class="token function">node</span> info /turtlesim 
    <span class="token number">6</span>  ros2 topic list
    <span class="token number">7</span>  ros2 topic <span class="token builtin class-name">echo</span> /turtle1/pose 
    <span class="token number">9</span>  ros2 topic pub --rate <span class="token number">1</span> /turtle1/cmd_vel geometry_msgs/msg/Twist <span class="token string">&quot;{linear: {x: 2.0,y: 0.0,z: 0.0},angular: {x: 0.0,y: 0.0,z: 1.8}}&quot;</span>
   <span class="token number">17</span>  ros2 bag record /turtle1/cmd_vel  <span class="token comment">#  record the history</span>
   <span class="token number">22</span>  <span class="token function">ls</span>
   <span class="token number">23</span>  ros2 bag play rosbag2_2023_02_27-07_39_37/   <span class="token comment">#  play the history</span>
   <span class="token number">24</span>  <span class="token function">history</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h2 id="ros2-environment">ros2 environment</h2> <h3 id="git">git</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> <span class="token function">git</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="vscode">vscode</h3> <p><strong>download:</strong></p> <p>https://code.visualstudio.com/docs/?dv=linux64_deb</p> <p><strong>install software</strong></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>blue@blue-pc:~/Downloads$ <span class="token function">sudo</span> dpkg -i code_1.75.1-1675893397_amd64.deb
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>install plug-in</strong></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>python
C/c++
Cmake
icorns
ros
msg
URDF
IntelliCode
markdown
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="download-the-demo-code">download the demo code</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">git</span> clone https://gitee.com/guyuehome/ros2_21_tutorials.git
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="workspace-and-package">workspace and package</h2> <ul><li><p><strong>src，代码空间</strong>，未来编写的代码、脚本，都需要人为的放置到这里；</p></li> <li><p><strong>build，编译空间</strong>，保存编译过程中产生的中间文件；</p></li> <li><p><strong>install，安装空间</strong>，放置编译得到的可执行文件和脚本；</p></li> <li><p><strong>log，日志空间</strong>，编译和运行过程中，保存各种警告、错误、信息等日志。</p></li></ul> <p>总体来讲，这四个空间的文件夹，我们绝大部分操作都是在src中进行的，编译成功后，就会执行install里边的结果，build和log两个文件夹用的很少。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>   <span class="token number">22</span>  <span class="token function">git</span> clone https://gitee.com/guyuehome/ros2_21_tutorials.git
   <span class="token number">32</span>  <span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> python3-pip
   <span class="token number">33</span>  <span class="token function">sudo</span> pip <span class="token function">install</span> rosdepc
   <span class="token number">34</span>  <span class="token function">sudo</span> rosdepc init <span class="token operator">&amp;</span> rosdepc update  <span class="token comment"># 貌似必须要进入src目录</span>
   <span class="token number">78</span>  rosdepc <span class="token function">install</span> -i --from-path src --rosdistro humble -y

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="install-the-builder-python3-colcon-ros">install the builder:  python3-colcon-ros</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> python3-colcon-ros
colcon build  <span class="token comment"># 对工作空间进行编译</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>编译成功后，就可以在工作空间中看到自动生产的build、log、install文件夹了。</p> <h3 id="setting-environment-variables">Setting environment variables</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ <span class="token builtin class-name">source</span> install/local_setup.sh <span class="token comment"># 仅在当前终端生效</span>
$ <span class="token builtin class-name">echo</span> <span class="token string">&quot; source ~/dev_ws/install/local_setup.sh&quot;</span> <span class="token operator">&gt;&gt;</span> ~/.bashrc <span class="token comment"># 所有终端均生效</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="create-package">create package</h3> <p>如何在ROS2中创建一个功能包呢？我们可以使用这个指令：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ ros2 pkg create --build-type <span class="token operator">&lt;</span>build-type<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>package_name<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>ros2命令中：</p> <ul><li><strong>pkg</strong>：表示功能包相关的功能；</li> <li><strong>create</strong>：表示创建功能包；</li> <li><strong>build-type</strong>：表示新创建的功能包是C++还是Python的，如果使用C++或者C，那这里就跟ament_cmake，如果使用Python，就跟ament_python；</li> <li><strong>package_name</strong>：新建功能包的名字。</li></ul> <p>比如在终端中分别创建C++和Python版本的功能包：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ <span class="token builtin class-name">cd</span> ~/dev_ws/src
$ ros2 pkg create --build-type ament_cmake learning_pkg_c               <span class="token comment"># C++</span>
$ ros2 pkg create --build-type ament_python learning_pkg_python <span class="token comment"># Python</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="build-the-package">build the package</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ colcon build   <span class="token comment"># 编译工作空间所有功能包, 需要在根目录上运行</span>
$ <span class="token builtin class-name">source</span> install/local_setup.bash
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="python功能包"><strong>Python功能包</strong></h3> <p>C++功能包需要将源码编译成可执行文件，但是Python语言是解析型的，不需要编译，所以会有一些不同，但也会有这两个文件：<strong>package.xml</strong>和<strong>setup.py</strong>。</p> <p>package.xml文件的主要内容和C++版本功能包一样，包含功能包的版权描述，和各种依赖的声明。</p> <h2 id="node">node</h2> <p><img src="https://deep-diary.oss-cn-hangzhou.aliyuncs.com/blog/image-20220526231417594.png" alt="image-20220526231417594"></p> <h3 id="run">run</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ ros2 run learning_node node_helloworld
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#!/usr/bin/env python3</span>
<span class="token comment"># -*- coding: utf-8 -*-</span>

<span class="token triple-quoted-string string">&quot;&quot;&quot;
@作者: 古月居(www.guyuehome.com)
@说明: ROS2节点示例-发布“Hello World”日志信息, 使用面向对象的实现方式
&quot;&quot;&quot;</span>

<span class="token keyword">import</span> rclpy                                     <span class="token comment"># ROS2 Python接口库</span>
<span class="token keyword">from</span> rclpy<span class="token punctuation">.</span>node <span class="token keyword">import</span> Node                      <span class="token comment"># ROS2 节点类</span>
<span class="token keyword">import</span> time

<span class="token triple-quoted-string string">&quot;&quot;&quot;
创建一个HelloWorld节点, 初始化时输出“hello world”日志
&quot;&quot;&quot;</span>
<span class="token keyword">class</span> <span class="token class-name">HelloWorldNode</span><span class="token punctuation">(</span>Node<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>name<span class="token punctuation">)</span>                     <span class="token comment"># ROS2节点父类初始化</span>
        <span class="token keyword">while</span> rclpy<span class="token punctuation">.</span>ok<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                          <span class="token comment"># ROS2系统是否正常运行</span>
            self<span class="token punctuation">.</span>get_logger<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">&quot;Hello World&quot;</span><span class="token punctuation">)</span>  <span class="token comment"># ROS2日志输出</span>
            time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span>                        <span class="token comment"># 休眠控制循环时间</span>

<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span>args<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                               <span class="token comment"># ROS2节点主入口main函数</span>
    rclpy<span class="token punctuation">.</span>init<span class="token punctuation">(</span>args<span class="token operator">=</span>args<span class="token punctuation">)</span>                          <span class="token comment"># ROS2 Python接口初始化</span>
    node <span class="token operator">=</span> HelloWorldNode<span class="token punctuation">(</span><span class="token string">&quot;node_helloworld_class&quot;</span><span class="token punctuation">)</span> <span class="token comment"># 创建ROS2节点对象并进行初始化</span>
    rclpy<span class="token punctuation">.</span>spin<span class="token punctuation">(</span>node<span class="token punctuation">)</span>                               <span class="token comment"># 循环等待ROS2退出</span>
    node<span class="token punctuation">.</span>destroy_node<span class="token punctuation">(</span><span class="token punctuation">)</span>                            <span class="token comment"># 销毁节点对象</span>
    rclpy<span class="token punctuation">.</span>shutdown<span class="token punctuation">(</span><span class="token punctuation">)</span>                               <span class="token comment"># 关闭ROS2 Python接口</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>完成代码的编写后需要设置功能包的编译选项，让系统知道Python程序的入口，打开功能包的setup.py文件，加入如下入口点的配置：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>    entry_points<span class="token operator">=</span><span class="token punctuation">{</span>
        <span class="token string">'console_scripts'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
         <span class="token string">'node_helloworld       = learning_node.node_helloworld:main'</span><span class="token punctuation">,</span>
         <span class="token string">'node_helloworld_class = learning_node.node_helloworld_class:main'</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="节点命令的常用操作如下">节点命令的常用操作如下：</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ ros2 <span class="token function">node</span> list               <span class="token comment"># 查看节点列表</span>
$ ros2 <span class="token function">node</span> info <span class="token operator">&lt;</span>node_name<span class="token operator">&gt;</span>   <span class="token comment"># 查看节点信息</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="topic">topic</h2> <p>节点实现了机器人各种各样的功能，但这些功能并不是独立的，之间会有千丝万缕的联系，其中最重要的一种联系方式就是话题，它是<strong>节点间传递数据的桥梁</strong>。</p> <h3 id="发布-订阅模型"><strong>发布/订阅模型</strong></h3> <p>从话题本身的实现角度来看，使用了基于DDS的<strong>发布/订阅模型</strong>，什么叫发布和订阅呢？</p> <p><img src="https://deep-diary.oss-cn-hangzhou.aliyuncs.com/blog/image8.gif" alt="image8"></p> <p>话题数据传输的特性是从一个节点到另外一个节点，发送数据的对象称之为<strong>发布者</strong>，接收数据的对象称之为<strong>订阅者</strong>，每一个话题都需要有一个名字，传输的数据也需要有固定的数据类型。</p> <h3 id="多对多通信"><strong>多对多通信</strong></h3> <p><img src="https://book.guyuehome.com/ROS2/2.%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5/image/2.4_%E8%AF%9D%E9%A2%98/image9.gif" alt="image9"></p> <h3 id="异步通信"><strong>异步通信</strong></h3> <p>话题通信还有一个特性，那就是异步，这个词可能有同学是第一次听说？所谓异步，只要是指发布者发出数据后，并不知道订阅者什么时候可以收到，类似古月居公众号发布一篇文章，你什么时候阅读的，古月居根本不知道，报社发出一份报纸，你什么时候收到，报社也是不知道的。这就叫做异步。</p> <p>异步的特性也让话题更适合用于一些周期发布的数据，比如传感器的数据，运动控制的指令等等，如果某些逻辑性较强的指令，比如修改某一个参数，用话题传输就不太合适了。</p> <h3 id="消息接口"><strong>消息接口</strong></h3> <p>最后，既然是数据传输，发布者和订阅者就得统一数据的描述格式，不能一个说英文，一个理解成了中文。在ROS中，话题通信数据的描述格式称之为消息，对应编程语言中数据结构的概念。比如这里的一个图像数据，就会包含图像的长宽像素值、每个像素的RGB等等，在ROS中都有标准定义。</p> <p><strong>消息是ROS中的一种接口定义方式</strong>，与编程语言无关，我们也可以通过**.msg**后缀的文件自行定义，有了这样的接口，各种节点就像积木块一样，通过各种各样的接口进行拼接，组成复杂的机器人系统。</p> <h3 id="发布者代码解析"><strong>发布者代码解析</strong></h3> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#!/usr/bin/env python3</span>
<span class="token comment"># -*- coding: utf-8 -*-</span>

<span class="token triple-quoted-string string">&quot;&quot;&quot;
@作者: 古月居(www.guyuehome.com)
@说明: ROS2话题示例-发布“Hello World”话题
&quot;&quot;&quot;</span>

<span class="token keyword">import</span> rclpy                                     <span class="token comment"># ROS2 Python接口库</span>
<span class="token keyword">from</span> rclpy<span class="token punctuation">.</span>node <span class="token keyword">import</span> Node                      <span class="token comment"># ROS2 节点类</span>
<span class="token keyword">from</span> std_msgs<span class="token punctuation">.</span>msg <span class="token keyword">import</span> String                  <span class="token comment"># 字符串消息类型</span>

<span class="token triple-quoted-string string">&quot;&quot;&quot;
创建一个发布者节点
&quot;&quot;&quot;</span>
<span class="token keyword">class</span> <span class="token class-name">PublisherNode</span><span class="token punctuation">(</span>Node<span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>name<span class="token punctuation">)</span>                                    <span class="token comment"># ROS2节点父类初始化</span>
        self<span class="token punctuation">.</span>pub <span class="token operator">=</span> self<span class="token punctuation">.</span>create_publisher<span class="token punctuation">(</span>String<span class="token punctuation">,</span> <span class="token string">&quot;chatter&quot;</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>   <span class="token comment"># 创建发布者对象（消息类型、话题名、队列长度）</span>
        self<span class="token punctuation">.</span>timer <span class="token operator">=</span> self<span class="token punctuation">.</span>create_timer<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>timer_callback<span class="token punctuation">)</span>  <span class="token comment"># 创建一个定时器（单位为秒的周期，定时执行的回调函数）</span>

    <span class="token keyword">def</span> <span class="token function">timer_callback</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>                                     <span class="token comment"># 创建定时器周期执行的回调函数</span>
        msg <span class="token operator">=</span> String<span class="token punctuation">(</span><span class="token punctuation">)</span>                                            <span class="token comment"># 创建一个String类型的消息对象</span>
        msg<span class="token punctuation">.</span>data <span class="token operator">=</span> <span class="token string">'Hello World'</span>                                  <span class="token comment"># 填充消息对象中的消息数据</span>
        self<span class="token punctuation">.</span>pub<span class="token punctuation">.</span>publish<span class="token punctuation">(</span>msg<span class="token punctuation">)</span>                                     <span class="token comment"># 发布话题消息</span>
        self<span class="token punctuation">.</span>get_logger<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">'Publishing: &quot;%s&quot;'</span> <span class="token operator">%</span> msg<span class="token punctuation">.</span>data<span class="token punctuation">)</span>     <span class="token comment"># 输出日志信息，提示已经完成话题发布</span>

<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span>args<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                                 <span class="token comment"># ROS2节点主入口main函数</span>
    rclpy<span class="token punctuation">.</span>init<span class="token punctuation">(</span>args<span class="token operator">=</span>args<span class="token punctuation">)</span>                            <span class="token comment"># ROS2 Python接口初始化</span>
    node <span class="token operator">=</span> PublisherNode<span class="token punctuation">(</span><span class="token string">&quot;topic_helloworld_pub&quot;</span><span class="token punctuation">)</span>     <span class="token comment"># 创建ROS2节点对象并进行初始化</span>
    rclpy<span class="token punctuation">.</span>spin<span class="token punctuation">(</span>node<span class="token punctuation">)</span>                                 <span class="token comment"># 循环等待ROS2退出</span>
    node<span class="token punctuation">.</span>destroy_node<span class="token punctuation">(</span><span class="token punctuation">)</span>                              <span class="token comment"># 销毁节点对象</span>
    rclpy<span class="token punctuation">.</span>shutdown<span class="token punctuation">(</span><span class="token punctuation">)</span>                                 <span class="token comment"># 关闭ROS2 Python接口</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><p>完成代码的编写后需要设置功能包的编译选项，让系统知道Python程序的入口，打开功能包的setup.py文件，加入如下入口点的配置：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>    entry_points<span class="token operator">=</span><span class="token punctuation">{</span>
        <span class="token string">'console_scripts'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
         <span class="token string">'topic_helloworld_pub  = learning_topic.topic_helloworld_pub:main'</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="流程总结">流程总结</h4> <p>对以上程序进行分析，如果我们想要实现一个发布者，流程如下：</p> <ul><li>编程接口初始化</li> <li>创建节点并初始化</li> <li>创建发布者对象</li> <li>创建并填充话题消息</li> <li>发布话题消息</li> <li>销毁节点并关闭接口</li></ul> <h3 id="订阅者代码解析"><strong>订阅者代码解析</strong></h3> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#!/usr/bin/env python3</span>
<span class="token comment"># -*- coding: utf-8 -*-</span>

<span class="token triple-quoted-string string">&quot;&quot;&quot;
@作者: 古月居(www.guyuehome.com)
@说明: ROS2话题示例-订阅“Hello World”话题消息
&quot;&quot;&quot;</span>

<span class="token keyword">import</span> rclpy                      <span class="token comment"># ROS2 Python接口库</span>
<span class="token keyword">from</span> rclpy<span class="token punctuation">.</span>node   <span class="token keyword">import</span> Node     <span class="token comment"># ROS2 节点类</span>
<span class="token keyword">from</span> std_msgs<span class="token punctuation">.</span>msg <span class="token keyword">import</span> String   <span class="token comment"># ROS2标准定义的String消息</span>

<span class="token triple-quoted-string string">&quot;&quot;&quot;
创建一个订阅者节点
&quot;&quot;&quot;</span>
<span class="token keyword">class</span> <span class="token class-name">SubscriberNode</span><span class="token punctuation">(</span>Node<span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>name<span class="token punctuation">)</span>                             <span class="token comment"># ROS2节点父类初始化</span>
        self<span class="token punctuation">.</span>sub <span class="token operator">=</span> self<span class="token punctuation">.</span>create_subscription<span class="token punctuation">(</span>\
            String<span class="token punctuation">,</span> <span class="token string">&quot;chatter&quot;</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>listener_callback<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token comment"># 创建订阅者对象（消息类型、话题名、订阅者回调函数、队列长度）</span>

    <span class="token keyword">def</span> <span class="token function">listener_callback</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">:</span>                      <span class="token comment"># 创建回调函数，执行收到话题消息后对数据的处理</span>
        self<span class="token punctuation">.</span>get_logger<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">'I heard: &quot;%s&quot;'</span> <span class="token operator">%</span> msg<span class="token punctuation">.</span>data<span class="token punctuation">)</span> <span class="token comment"># 输出日志信息，提示订阅收到的话题消息</span>

<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span>args<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                               <span class="token comment"># ROS2节点主入口main函数</span>
    rclpy<span class="token punctuation">.</span>init<span class="token punctuation">(</span>args<span class="token operator">=</span>args<span class="token punctuation">)</span>                          <span class="token comment"># ROS2 Python接口初始化</span>
    node <span class="token operator">=</span> SubscriberNode<span class="token punctuation">(</span><span class="token string">&quot;topic_helloworld_sub&quot;</span><span class="token punctuation">)</span>  <span class="token comment"># 创建ROS2节点对象并进行初始化</span>
    rclpy<span class="token punctuation">.</span>spin<span class="token punctuation">(</span>node<span class="token punctuation">)</span>                               <span class="token comment"># 循环等待ROS2退出</span>
    node<span class="token punctuation">.</span>destroy_node<span class="token punctuation">(</span><span class="token punctuation">)</span>                            <span class="token comment"># 销毁节点对象</span>
    rclpy<span class="token punctuation">.</span>shutdown<span class="token punctuation">(</span><span class="token punctuation">)</span>                               <span class="token comment"># 关闭ROS2 Python接口</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p>完成代码的编写后需要设置功能包的编译选项，让系统知道Python程序的入口，打开功能包的setup.py文件，加入如下入口点的配置：</p> <div class="language-markup line-numbers-mode"><pre class="language-markup"><code>    entry_points={
        'console_scripts': [
         'topic_helloworld_pub  = learning_topic.topic_helloworld_pub:main',
         'topic_helloworld_sub  = learning_topic.topic_helloworld_sub:main',
        ],
    },
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="流程总结-2">流程总结</h4> <p>对以上程序进行分析，如果我们想要实现一个订阅者，流程如下：</p> <ul><li>编程接口初始化</li> <li>创建节点并初始化</li> <li>创建订阅者对象</li> <li>回调函数处理话题数据</li> <li>销毁节点并关闭接口</li></ul> <h3 id="usb相机驱动">USB相机驱动</h3> <p>常用的usb相机驱动一般都是通用的，ROS中也集成了usb相机的标准驱动，我们只需要通过这样一行指令，就可以安装好，无论你用什么样的相机，只要符合usb接口协议，就可以直接使用ROS中的相机驱动节点，发布标准的图像话题了。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>
$ <span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> ros-humble-usb-cam
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>这样，我们的代码又得到了进一步精简，刚才自己写的图像发布节点换成了这样一句指令，视觉识别节点不需要做任何变化。</p> <div class="language-markup line-numbers-mode"><pre class="language-markup"><code>$ ros2 run usb_cam usb_cam_node_exe
$ ros2 run learning_topic topic_webcam_sub
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><a href="https://book.guyuehome.com/ROS2/2.%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5/image/2.4_%E8%AF%9D%E9%A2%98/image-20220527231048652.png" target="_blank" rel="noopener noreferrer"><img src="https://deep-diary.oss-cn-hangzhou.aliyuncs.com/blog/image-20220527231048652.png" alt="image-20220527231048652"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <hr> <h3 id="话题命令行操作"><strong>话题命令行操作</strong></h3> <p>话题命令的常用操作如下：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>
$ ros2 topic list                <span class="token comment"># 查看话题列表</span>
$ ros2 topic info <span class="token operator">&lt;</span>topic_name<span class="token operator">&gt;</span>   <span class="token comment"># 查看话题信息</span>
$ ros2 topic hz <span class="token operator">&lt;</span>topic_name<span class="token operator">&gt;</span>     <span class="token comment"># 查看话题发布频率</span>
$ ros2 topic bw <span class="token operator">&lt;</span>topic_name<span class="token operator">&gt;</span>     <span class="token comment"># 查看话题传输带宽</span>
$ ros2 topic <span class="token builtin class-name">echo</span> <span class="token operator">&lt;</span>topic_name<span class="token operator">&gt;</span>   <span class="token comment"># 查看话题数据</span>
$ ros2 topic pub <span class="token operator">&lt;</span>topic_name<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>msg_type<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>msg_data<span class="token operator">&gt;</span>   <span class="token comment"># 发布话题消息</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="service">service</h2> <p>话题通信可以实现多个ROS节点之间数据的单向传输，使用这种异步通信机制，发布者无法准确知道订阅者是否收到消息，本讲我们将一起学习ROS另外一种常用的通信方法——<strong>服务</strong>，可以实现类似<strong>你问我答的同步通信</strong>效果。</p> <h3 id="通信模型"><strong>通信模型</strong></h3> <p>在之前的课程中，我们通过一个节点驱动相机，发布图像话题，另外一个节点订阅图像话题，并实现对其中红色物体的识别，此时我们可以按照图像识别的频率，周期得到物体的位置。</p> <p><img src="https://deep-diary.oss-cn-hangzhou.aliyuncs.com/blog/image-20220527232959464.png" alt="image-20220527232959464"></p> <p>这样的通信模型和话题单向传输有所不同，变成了发送一个请求，反馈一个应答的形式，好像是你问我答一样，这种通信机制在ROS中成为<strong>服务，Service</strong>。</p> <h3 id="客户端-服务器模型"><strong>客户端/服务器模型</strong></h3> <p>从服务的实现机制上来看，这种你问我答的形式叫做<strong>客户端/服务器模型</strong>，简称为CS模型，客户端在需要某些数据的时候，针对某个具体的服务，发送请求信息，服务器端收到请求之后，就会进行处理并反馈应答信息。</p> <p><a href="https://book.guyuehome.com/ROS2/2.%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5/image/2.5_%E6%9C%8D%E5%8A%A1/image8.gif" target="_blank" rel="noopener noreferrer"><img src="https://deep-diary.oss-cn-hangzhou.aliyuncs.com/blog/image8.gif" alt="image8"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>这种通信机制在生活中也很常见，比如我们经常浏览的各种网页，此时你的电脑浏览器就是客户端，通过域名或者各种操作，向网站服务器发送请求，服务器收到之后返回需要展现的页面数据。</p> <h3 id="同步通信"><strong>同步通信</strong></h3> <p>这个过程一般要求越快越好，假设服务器半天没有反应，你的浏览器一直转圈圈，那有可能是服务器宕机了，或者是网络不好，所以相比话题通信，在服务通信中，客户端可以通过接收到的应答信息，判断服务器端的状态，我们也称之为同步通信。</p> <h3 id="一对多通信"><strong>一对多通信</strong></h3> <p><a href="https://book.guyuehome.com/ROS2/2.%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5/image/2.5_%E6%9C%8D%E5%8A%A1/image9.gif" target="_blank" rel="noopener noreferrer"><img src="https://deep-diary.oss-cn-hangzhou.aliyuncs.com/blog/image9.gif" alt="image9"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>比如古月居这个网站，服务器是唯一存在的，并没有多个完全一样的古月居网站，但是可以访问古月居网站的客户端是不唯一的，大家每一个人都可以看到同样的界面。所以服务通信模型中，服务器端唯一，但客户端可以不唯一。</p> <h3 id="服务接口"><strong>服务接口</strong></h3> <p>和话题通信类似，服务通信的核心还是要传递数据，数据变成了两个部分，一个<strong>请求的数据</strong>，比如请求苹果位置的命令，还有一个<strong>反馈的数据</strong>，比如反馈苹果坐标位置的数据，这些数据和话题消息一样，在ROS中也是要标准定义的，话题使用.msg文件定义，服务使用的是.srv文件定义，后续我们会给大家介绍定义的方法。</p> <h3 id="客户端代码解析"><strong>客户端代码解析</strong></h3> <p>我们来看下客户端的实现方法。</p> <h4 id="程序实现"><strong>程序实现</strong></h4> <p>learning_service/service_adder_client.py</p> <div class="language-markup line-numbers-mode"><pre class="language-markup"><code>#!/usr/bin/env python3
# -*- coding: utf-8 -*-

&quot;&quot;&quot;
@作者: 古月居(www.guyuehome.com)
@说明: ROS2服务示例-发送两个加数，请求加法器计算
&quot;&quot;&quot;

import sys

import rclpy                                  # ROS2 Python接口库
from rclpy.node   import Node                 # ROS2 节点类
from learning_interface.srv import AddTwoInts # 自定义的服务接口

class adderClient(Node):
    def __init__(self, name):
        super().__init__(name)                                       # ROS2节点父类初始化
        self.client = self.create_client(AddTwoInts, 'add_two_ints') # 创建服务客户端对象（服务接口类型，服务名）
        while not self.client.wait_for_service(timeout_sec=1.0):     # 循环等待服务器端成功启动
            self.get_logger().info('service not available, waiting again...') 
        self.request = AddTwoInts.Request()                          # 创建服务请求的数据对象

    def send_request(self):                                          # 创建一个发送服务请求的函数
        self.request.a = int(sys.argv[1])
        self.request.b = int(sys.argv[2])
        self.future = self.client.call_async(self.request)           # 异步方式发送服务请求

def main(args=None):
    rclpy.init(args=args)                        # ROS2 Python接口初始化
    node = adderClient(&quot;service_adder_client&quot;)   # 创建ROS2节点对象并进行初始化
    node.send_request()                          # 发送服务请求

    while rclpy.ok():                            # ROS2系统正常运行
        rclpy.spin_once(node)                    # 循环执行一次节点

        if node.future.done():                   # 数据是否处理完成
            try:
                response = node.future.result()  # 接收服务器端的反馈数据
            except Exception as e:
                node.get_logger().info(
                    'Service call failed %r' % (e,))
            else:
                node.get_logger().info(          # 将收到的反馈信息打印输出
                    'Result of add_two_ints: for %d + %d = %d' % 
                    (node.request.a, node.request.b, response.sum))
            break

    node.destroy_node()                          # 销毁节点对象
    rclpy.shutdown()                             # 关闭ROS2 Python接口
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br></div></div><p>完成代码的编写后需要设置功能包的编译选项，让系统知道Python程序的入口，打开功能包的setup.py文件，加入如下入口点的配置：</p> <div class="language-markup line-numbers-mode"><pre class="language-markup"><code>    entry_points={
        'console_scripts': [
         'service_adder_client  = learning_service.service_adder_client:main',
        ],
    },
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="流程总结-3"><strong>流程总结</strong></h4> <p>对以上程序进行分析，如果我们想要实现一个客户端，流程如下：</p> <ul><li>编程接口初始化</li> <li>创建节点并初始化</li> <li>创建客户端对象</li> <li>创建并发送请求数据</li> <li>等待服务器端应答数据</li> <li>销毁节点并关闭接口</li></ul> <h3 id="服务端代码解析"><strong>服务端代码解析</strong></h3> <p>至于服务器端的实现，有点类似话题通信中的订阅者，并不知道请求数据什么时间出现，也用到了回调函数机制。</p> <h4 id="程序实现-2"><strong>程序实现</strong></h4> <p>learning_service/service_adder_server.py</p> <div class="language-markup line-numbers-mode"><pre class="language-markup"><code>#!/usr/bin/env python3
# -*- coding: utf-8 -*-

&quot;&quot;&quot;
@作者: 古月居(www.guyuehome.com)
@说明: ROS2服务示例-提供加法器的服务器处理功能
&quot;&quot;&quot;

import rclpy                                     # ROS2 Python接口库
from rclpy.node   import Node                    # ROS2 节点类
from learning_interface.srv import AddTwoInts    # 自定义的服务接口

class adderServer(Node):
    def __init__(self, name):
        super().__init__(name)                                                           # ROS2节点父类初始化
        self.srv = self.create_service(AddTwoInts, 'add_two_ints', self.adder_callback)  # 创建服务器对象（接口类型、服务名、服务器回调函数）

    def adder_callback(self, request, response):   # 创建回调函数，执行收到请求后对数据的处理
        response.sum = request.a + request.b       # 完成加法求和计算，将结果放到反馈的数据中
        self.get_logger().info('Incoming request\na: %d b: %d' % (request.a, request.b))   # 输出日志信息，提示已经完成加法求和计算
        return response                          # 反馈应答信息

def main(args=None):                             # ROS2节点主入口main函数
    rclpy.init(args=args)                        # ROS2 Python接口初始化
    node = adderServer(&quot;service_adder_server&quot;)   # 创建ROS2节点对象并进行初始化
    rclpy.spin(node)                             # 循环等待ROS2退出
    node.destroy_node()                          # 销毁节点对象
    rclpy.shutdown()                             # 关闭ROS2 Python接口
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>完成代码的编写后需要设置功能包的编译选项，让系统知道Python程序的入口，打开功能包的setup.py文件，加入如下入口点的配置：</p> <div class="language-markup line-numbers-mode"><pre class="language-markup"><code>    entry_points={
        'console_scripts': [
         'service_adder_client  = learning_service.service_adder_client:main',
         'service_adder_server  = learning_service.service_adder_server:main',
        ],
    },
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="流程总结-4"><strong>流程总结</strong></h4> <p>对以上程序进行分析，如果我们想要实现一个服务端，流程如下：</p> <ul><li>编程接口初始化</li> <li>创建节点并初始化</li> <li>创建服务器端对象</li> <li>通过回调函数处进行服务</li> <li>向客户端反馈应答结果</li> <li>销毁节点并关闭接口</li></ul> <h3 id="服务命令行操作"><strong>服务命令行操作</strong></h3> <p>服务命令的常用操作如下：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ ros2 <span class="token function">service</span> list                  <span class="token comment"># 查看服务列表</span>
$ ros2 <span class="token function">service</span> <span class="token builtin class-name">type</span> <span class="token operator">&lt;</span>service_name<span class="token operator">&gt;</span>   <span class="token comment"># 查看服务数据类型</span>
$ ros2 <span class="token function">service</span> call <span class="token operator">&lt;</span>service_name<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>service_type<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>service_data<span class="token operator">&gt;</span>   <span class="token comment"># 发送服务请求</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="communication-interface">communication interface</h2> <p>接口可以让程序之间的依赖降低，便于我们使用别人的代码，也方便别人使用我们的代码，这就是ROS的核心目标，减少重复造轮子。</p> <p><img src="https://deep-diary.oss-cn-hangzhou.aliyuncs.com/blog/image-20230228071805546.png" alt="image-20230228071805546"></p> <p>ROS有三种常用的通信机制，分别是<strong>话题、服务、动作</strong>，通过每一种通信种定义的接口，各种节点才能有机的联系到一起。</p> <h3 id="语言无关"><strong>语言无关</strong></h3> <p>为了保证每一个节点可以使用不同语言编程，ROS将这些接口的设计做成了和<strong>语言无关</strong>的，比如这里看到的int32表示32位的整型数，int64表示64位的整型数，bool表示布尔值，还可以定义数组、结构体，这些定义在编译过程中，会自动生成对应到C++、Python等语言里的数据结构。</p> <p><a href="https://book.guyuehome.com/ROS2/2.%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5/image/2.6_%E9%80%9A%E4%BF%A1%E6%8E%A5%E5%8F%A3/image-20220528001633925.png" target="_blank" rel="noopener noreferrer"><img src="https://deep-diary.oss-cn-hangzhou.aliyuncs.com/blog/image-20220528001633925.png" alt="image-20220528001633925"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <ul><li>话题通信接口的定义使用的是.msg文件，由于是单向传输，只需要描述传输的每一帧数据是什么就行，比如在这个定义里，会传输两个32位的整型数，x、y，我们可以用来传输二维坐标的数值。</li> <li>服务通信接口的定义使用的是.srv文件，包含请求和应答两部分定义，通过中间的“---”区分，比如之前我们学习的加法求和功能，请求数据是两个64位整型数a和b，应答是求和的结果sum。</li> <li>动作是另外一种通信机制，用来描述机器人的一个运动过程，使用.action文件定义，比如我们让小海龟转90度，一边转一边周期反馈当前的状态，此时接口的定义分成了三个部分，分别是动作的目标，比如是开始运动，运动的结果，最终旋转的90度是否完成，还有一个周期反馈，比如每隔1s反馈一下当前转到第10度、20度还是30度了，让我们知道运动的进度。</li></ul> <h3 id="标准接口"><strong>标准接口</strong></h3> <p>大家可能好奇ROS系统到底给我们定义了哪些接口呢？我们可以在ROS安装路径中的share文件夹中找到，涵盖众多标准定义，大家可以打开几个看看。</p> <p><a href="https://book.guyuehome.com/ROS2/2.%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5/image/2.6_%E9%80%9A%E4%BF%A1%E6%8E%A5%E5%8F%A3/image-20220528001914859.png" target="_blank" rel="noopener noreferrer"><img src="https://deep-diary.oss-cn-hangzhou.aliyuncs.com/blog/image-20220528001914859.png" alt="image-20220528001914859"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://book.guyuehome.com/ROS2/2.%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5/image/2.6_%E9%80%9A%E4%BF%A1%E6%8E%A5%E5%8F%A3/image-20220528001943541.png" target="_blank" rel="noopener noreferrer"><img src="https://deep-diary.oss-cn-hangzhou.aliyuncs.com/blog/image-20220528001943541.png" alt="image-20220528001943541"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="案例一-服务接口的定义与使用"><strong>案例一：服务接口的定义与使用</strong></h3> <p>了解了通信接口的概念，接下来我们再从代码实现的角度，研究下如何定义以及使用一个接口。</p> <p>在之前服务概念讲解的课程中，我们编写了这样一个例程，我们再来回顾下。</p> <p><a href="https://book.guyuehome.com/ROS2/2.%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5/image/2.6_%E9%80%9A%E4%BF%A1%E6%8E%A5%E5%8F%A3/image-20220528002304850.png" target="_blank" rel="noopener noreferrer"><img src="https://deep-diary.oss-cn-hangzhou.aliyuncs.com/blog/image-20220528002304850.png" alt="image-20220528002304850"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>有三个节点，第一个驱动相机发布图像话题，第二个是机器视觉识别节点，封装了一个服务的服务端对象，提供目标识别位置的查询服务，第三个节点在需要目标位置的时候，就可以发送请求，收到位置进行使用了。</p> <p><a href="https://book.guyuehome.com/ROS2/2.%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5/image/2.6_%E9%80%9A%E4%BF%A1%E6%8E%A5%E5%8F%A3/image-20220527235132847.png" target="_blank" rel="noopener noreferrer"><img src="https://deep-diary.oss-cn-hangzhou.aliyuncs.com/blog/image-20220527235132847.png" alt="image-20220527235132847"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="接口定义"><strong>接口定义</strong></h3> <p>在这个例程中，我们使用GetObjectPosition.srv定义了服务通信的接口：</p> <p>learning_interface/srv/GetObjectPosition.srv</p> <div class="language-markup line-numbers-mode"><pre class="language-markup"><code>bool get      # 获取目标位置的指令
---
int32 x       # 目标的X坐标
int32 y       # 目标的Y坐标
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>定义中有两个部分，上边是获取目标位置的指令，get为true的话，就表示我们需要一次位置，服务端就会反馈这个x、y坐标了。</p> <p>完成定义后，还需要在功能包的CMakeLists.txt中配置编译选项，让编译器在编译过程中，根据接口定义，自动生成不同语言的代码：</p> <div class="language-markup line-numbers-mode"><pre class="language-markup"><code>...

find_package(rosidl_default_generators REQUIRED)

rosidl_generate_interfaces(${PROJECT_NAME}
  &quot;srv/GetObjectPosition.srv&quot;
)

...
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>功能包的package.xml文件中也需要添加代码生成的功能依赖：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>
 ...

 &lt;build_depend&gt;rosidl_default_generators&lt;/build_depend&gt;
 &lt;exec_depend&gt;rosidl_default_runtime&lt;/exec_depend&gt;
 &lt;member_of_group&gt;rosidl_interface_packages&lt;/member_of_group&gt;

 ...
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="程序调用">程序调用</h3> <p>我们在代码中再来重点看下接口的使用方法。</p> <h4 id="客户端接口调用"><strong>客户端接口调用</strong></h4> <p>learning_service/service_object_client.py</p> <div class="language-markup line-numbers-mode"><pre class="language-markup"><code>#!/usr/bin/env python3
# -*- coding: utf-8 -*-

&quot;&quot;&quot;
@作者: 古月居(www.guyuehome.com)
@说明: ROS2服务示例-请求目标识别，等待目标位置应答
&quot;&quot;&quot;

import rclpy                                            # ROS2 Python接口库
from rclpy.node   import Node                           # ROS2 节点类
from learning_interface.srv import GetObjectPosition    # 自定义的服务接口

class objectClient(Node):
    def __init__(self, name):
        super().__init__(name)                          # ROS2节点父类初始化
        self.client = self.create_client(GetObjectPosition, 'get_target_position')
        while not self.client.wait_for_service(timeout_sec=1.0):
            self.get_logger().info('service not available, waiting again...')
        self.request = GetObjectPosition.Request()

    def send_request(self):
        self.request.get = True
        self.future = self.client.call_async(self.request)

def main(args=None):
    rclpy.init(args=args)                             # ROS2 Python接口初始化
    node = objectClient(&quot;service_object_client&quot;)      # 创建ROS2节点对象并进行初始化
    node.send_request()

    while rclpy.ok():
        rclpy.spin_once(node)

        if node.future.done():
            try:
                response = node.future.result()
            except Exception as e:
                node.get_logger().info(
                    'Service call failed %r' % (e,))
            else:
                node.get_logger().info(
                    'Result of object position:\n x: %d y: %d' %
                    (response.x, response.y))
            break
    node.destroy_node()                              # 销毁节点对象
    rclpy.shutdown()                                 # 关闭ROS2 Python接口
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br></div></div><h4 id="服务端接口调用"><strong>服务端接口调用</strong></h4> <p>learning_service/service_object_server.py</p> <div class="language-markup line-numbers-mode"><pre class="language-markup"><code>#!/usr/bin/env python3
# -*- coding: utf-8 -*-

&quot;&quot;&quot;
@作者: 古月居(www.guyuehome.com)
@说明: ROS2服务示例-提供目标识别服务
&quot;&quot;&quot;

import rclpy                                           # ROS2 Python接口库
from rclpy.node import Node                            # ROS2 节点类
from sensor_msgs.msg import Image                      # 图像消息类型
import numpy as np                                     # Python数值计算库
from cv_bridge import CvBridge                         # ROS与OpenCV图像转换类
import cv2                                             # Opencv图像处理库
from learning_interface.srv import GetObjectPosition   # 自定义的服务接口

lower_red = np.array([0, 90, 128])     # 红色的HSV阈值下限
upper_red = np.array([180, 255, 255])  # 红色的HSV阈值上限

class ImageSubscriber(Node):
    def __init__(self, name):
        super().__init__(name)                              # ROS2节点父类初始化
        self.sub = self.create_subscription(
            Image, 'image_raw', self.listener_callback, 10) # 创建订阅者对象（消息类型、话题名、订阅者回调函数、队列长度）
        self.cv_bridge = CvBridge()                         # 创建一个图像转换对象，用于OpenCV图像与ROS的图像消息的互相转换

        self.srv = self.create_service(GetObjectPosition,   # 创建服务器对象（接口类型、服务名、服务器回调函数）
                                       'get_target_position',
                                       self.object_position_callback)    
        self.objectX = 0
        self.objectY = 0                              

    def object_detect(self, image):
        hsv_img = cv2.cvtColor(image, cv2.COLOR_BGR2HSV)      # 图像从BGR颜色模型转换为HSV模型
        mask_red = cv2.inRange(hsv_img, lower_red, upper_red) # 图像二值化
        contours, hierarchy = cv2.findContours(
            mask_red, cv2.RETR_LIST, cv2.CHAIN_APPROX_NONE)   # 图像中轮廓检测

        for cnt in contours:                                  # 去除一些轮廓面积太小的噪声
            if cnt.shape[0] &lt; 150:
                continue

            (x, y, w, h) = cv2.boundingRect(cnt)              # 得到苹果所在轮廓的左上角xy像素坐标及轮廓范围的宽和高
            cv2.drawContours(image, [cnt], -1, (0, 255, 0), 2)# 将苹果的轮廓勾勒出来
            cv2.circle(image, (int(x+w/2), int(y+h/2)), 5,
                       (0, 255, 0), -1)                       # 将苹果的图像中心点画出来

            self.objectX = int(x+w/2)
            self.objectY = int(y+h/2)

        cv2.imshow(&quot;object&quot;, image)                            # 使用OpenCV显示处理后的图像效果
        cv2.waitKey(50)

    def listener_callback(self, data):
        self.get_logger().info('Receiving video frame')        # 输出日志信息，提示已进入回调函数
        image = self.cv_bridge.imgmsg_to_cv2(data, 'bgr8')     # 将ROS的图像消息转化成OpenCV图像
        self.object_detect(image)                              # 苹果检测

    def object_position_callback(self, request, response):     # 创建回调函数，执行收到请求后对数据的处理
        if request.get == True:
            response.x = self.objectX                          # 目标物体的XY坐标
            response.y = self.objectY
            self.get_logger().info('Object position\nx: %d y: %d' %
                                   (response.x, response.y))   # 输出日志信息，提示已经反馈
        else:
            response.x = 0
            response.y = 0
            self.get_logger().info('Invalid command')          # 输出日志信息，提示已经反馈
        return response


def main(args=None):                                 # ROS2节点主入口main函数
    rclpy.init(args=args)                            # ROS2 Python接口初始化
    node = ImageSubscriber(&quot;service_object_server&quot;)  # 创建ROS2节点对象并进行初始化
    rclpy.spin(node)                                 # 循环等待ROS2退出
    node.destroy_node()                              # 销毁节点对象
    rclpy.shutdown()                                 # 关闭ROS2 Python接口
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br></div></div><h3 id="接口命令行操作">接口命令行操作</h3> <p>接口命令的常用操作如下：</p> <div class="language-markup line-numbers-mode"><pre class="language-markup"><code>$ ros2 interface list                    # 查看系统接口列表
$ ros2 interface show <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>interface_name</span><span class="token punctuation">&gt;</span></span>   # 查看某个接口的详细定义
$ ros2 interface package <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>package_name</span><span class="token punctuation">&gt;</span></span>  # 查看某个功能包中的接口定义
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><a href="https://book.guyuehome.com/ROS2/2.%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5/image/2.6_%E9%80%9A%E4%BF%A1%E6%8E%A5%E5%8F%A3/image-20220528004610983.png" target="_blank" rel="noopener noreferrer"><img src="https://deep-diary.oss-cn-hangzhou.aliyuncs.com/blog/image-20220528004610983.png" alt="image-20220528004610983"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://book.guyuehome.com/ROS2/2.%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5/image/2.6_%E9%80%9A%E4%BF%A1%E6%8E%A5%E5%8F%A3/image-20220528004525471.png" target="_blank" rel="noopener noreferrer"><img src="https://deep-diary.oss-cn-hangzhou.aliyuncs.com/blog/image-20220528004525471.png" alt="image-20220528004525471"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://book.guyuehome.com/ROS2/2.%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5/image/2.6_%E9%80%9A%E4%BF%A1%E6%8E%A5%E5%8F%A3/image-20220528004538865.png" target="_blank" rel="noopener noreferrer"><img src="https://deep-diary.oss-cn-hangzhou.aliyuncs.com/blog/image-20220528004538865.png" alt="image-20220528004538865"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="action">action</h2> <p>机器人是一个复杂的智能系统，并不仅仅是键盘遥控运动、识别某个目标这么简单，我们需要实现的是送餐、送货、分拣等满足具体场景需求的机器人。</p> <p>在这些应用功能的实现中，另外一种ROS通信机制也会被常常用到——那就是<strong>动作</strong>。从这个名字上就可以很好理解这个概念的含义，这种通信机制的目的就是便于<strong>对机器人某一完整行为的流程进行管理</strong>。</p> <h3 id="通信模型-2"><strong>通信模型</strong></h3> <p>举个例子，比如我们想让机器人转个圈，这肯定不是一下就可以完成的，机器人得一点一点旋转，直到360度才能结束，假设机器人并不在我们眼前，发出指令后，我们根本不知道机器人到底有没有开始转圈，转到哪里了？</p> <p><a href="https://book.guyuehome.com/ROS2/2.%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5/image/2.7_%E5%8A%A8%E4%BD%9C/image-20220528005012082.png" target="_blank" rel="noopener noreferrer"><img src="https://deep-diary.oss-cn-hangzhou.aliyuncs.com/blog/image-20220528005012082.png" alt="image-20220528005012082"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>OK，现在我们需要的是一个反馈，比如每隔1s，告诉我们当前转到多少度了，10度、20度、30度，一段时间之后，到了360度，再发送一个信息，表示动作执行完成。</p> <p>这样一个需要执行一段时间的行为，使用动作的通信机制就更为合适，就像装了一个进度条，我们可以随时把控进度，如果运动过程当中，我们还可以随时发送一个取消运动的命令。</p> <h3 id="客户端-服务器模型-2"><strong>客户端/服务器模型</strong></h3> <p>动作和服务类似，使用的也是客户端和服务器模型，客户端发送动作的目标，想让机器人干什么，服务器端执行动作过程， 控制机器人达到运动的目标，同时周期反馈动作执行过程中的状态。</p> <p><a href="https://book.guyuehome.com/ROS2/2.%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5/image/2.7_%E5%8A%A8%E4%BD%9C/image8.gif" target="_blank" rel="noopener noreferrer"><img src="https://book.guyuehome.com/ROS2/2.%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5/image/2.7_%E5%8A%A8%E4%BD%9C/image8.gif" alt="image8"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>客户端发送一个运动的目标，想让机器人动起来，服务器端收到之后，就开始控制机器人运动，一边运动，一边反馈当前的状态，如果是一个导航动作，这个反馈可能是当前所处的坐标，如果是机械臂抓取，这个反馈可能又是机械臂的实时姿态。当运动执行结束后，服务器再反馈一个动作结束的信息。整个通信过程就此结束。</p> <h3 id="一对多通信-2"><strong>一对多通信</strong></h3> <p>和服务一样，动作通信中的客户端可以有多个，大家都可以发送运动命令，但是服务器端只能有一个，毕竟只有一个机器人，先执行完成一个动作，才能执行下一个动作。</p> <h3 id="同步通信-2"><strong>同步通信</strong></h3> <p>既然有反馈，那动作也是一种同步通信机制，之前我们也介绍过，动作过程中的数据通信接口，使用.action文件进行定义。</p> <h3 id="由服务和话题合成"><strong>由服务和话题合成</strong></h3> <p>大家再仔细看下上边的动图，是不是还会发现一个隐藏的秘密。</p> <p>动作的三个通信模块，竟然有两个是服务，一个是话题，当客户端发送运动目标时，使用的是服务的请求调用，服务器端也会反馈一个应带，表示收到命令。动作的反馈过程，其实就是一个话题的周期发布，服务器端是发布者，客户端是订阅者。</p> <p>没错，动作是一种应用层的通信机制，其底层就是基于话题和服务来实现的。</p> <h3 id="案例一-小海龟的动作"><strong>案例一：小海龟的动作</strong></h3> <p>我们再用小海龟的案例加深对动作概念的理解。</p> <p>按照以下命令启动小海龟仿真器，接下来使用action命令控制小海龟的动作，可以让海龟运动到某一指定的姿态：</p> <div class="language-markup line-numbers-mode"><pre class="language-markup"><code>$ ros2 run turtlesim turtlesim_node
$ ros2 run turtlesim turtle_teleop_key
$ ros2 action info /turtle1/rotate_absolute
$ ros2 action send_goal /turtle1/rotate_absolute turtlesim/action/RotateAbsolute &quot;{theta: -1.57}&quot;
$ ros2 action send_goal /turtle1/rotate_absolute turtlesim/action/RotateAbsolute &quot;{theta: -1.57}&quot; --feedback
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><a href="https://book.guyuehome.com/ROS2/2.%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5/image/2.7_%E5%8A%A8%E4%BD%9C/image-20220528005909408.png" target="_blank" rel="noopener noreferrer"><img src="https://deep-diary.oss-cn-hangzhou.aliyuncs.com/blog/image-20220528005909408.png" alt="image-20220528005909408"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://book.guyuehome.com/ROS2/2.%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5/image/2.7_%E5%8A%A8%E4%BD%9C/image-20220528005935269.png" target="_blank" rel="noopener noreferrer"><img src="https://deep-diary.oss-cn-hangzhou.aliyuncs.com/blog/image-20220528005935269.png" alt="image-20220528005935269"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="案例二-机器人画圆"><strong>案例二：机器人画圆</strong></h3> <p>如何通过代码来实现动作的编程呢？</p> <p>动作虽然是基于话题和服务实现的，但在实际使用中，并不会直接使用话题和服务的编程方法，而是有一套针对动作特性封装好的编程接口，接下来我们就一起试一试。</p> <p><a href="https://book.guyuehome.com/ROS2/2.%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5/image/2.7_%E5%8A%A8%E4%BD%9C/image-20220528010032315.png" target="_blank" rel="noopener noreferrer"><img src="https://deep-diary.oss-cn-hangzhou.aliyuncs.com/blog/image-20220528010032315.png" alt="image-20220528010032315"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>假设我们有一个机器人，我们希望通过动作的通信方法，让机器人转个圈，请编程实现动作通信中，客户端和服务器端的实现过程。</p> <h3 id="运行效果"><strong>运行效果</strong></h3> <p>启动两个终端，分别运行一下命令，启动动作示例的服务端和客户端：</p> <div class="language-markup line-numbers-mode"><pre class="language-markup"><code>$ ros2 run learning_action action_move_server 
$ ros2 run learning_action action_move_client
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><a href="https://book.guyuehome.com/ROS2/2.%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5/image/2.7_%E5%8A%A8%E4%BD%9C/image-20220528010905277.png" target="_blank" rel="noopener noreferrer"><img src="https://deep-diary.oss-cn-hangzhou.aliyuncs.com/blog/image-20220528010905277.png" alt="image-20220528010905277"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://book.guyuehome.com/ROS2/2.%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5/image/2.7_%E5%8A%A8%E4%BD%9C/image-20220528010845943.png" target="_blank" rel="noopener noreferrer"><img src="https://deep-diary.oss-cn-hangzhou.aliyuncs.com/blog/image-20220528010845943.png" alt="image-20220528010845943"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>终端中，我们可以看到客户端发送动作目标之后，服务器端开始模拟机器人运动，每30度发送一次反馈信息，最终完成运动，并反馈结束运动的信息。</p> <p>接下来我们就分析下这个例程实现背后的原理。</p> <h3 id="接口定义-2"><strong>接口定义</strong></h3> <p>例程使用的动作并不是ROS中的标准定义，我们通过MoveCircle.action进行自定义：</p> <p>learning_interface/action/MoveCircle.action</p> <div class="language-markup line-numbers-mode"><pre class="language-markup"><code>bool enable     # 定义动作的目标，表示动作开始的指令
---
bool finish     # 定义动作的结果，表示是否成功执行
---
int32 state     # 定义动作的反馈，表示当前执行到的位置
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>包含三个部分：</p> <ul><li>第一块是<strong>动作的目标</strong>，enable为true时，表示开始运动；</li> <li>第二块是<strong>动作的执行结果</strong>，finish为true，表示动作执行完成；</li> <li>第三块是<strong>动作的周期反馈</strong>，表示当前机器人旋转到的角度。</li></ul> <p>完成定义后，还需要在功能包的CMakeLists.txt中配置编译选项，让编译器在编译过程中，根据接口定义，自动生成不同语言的代码：</p> <div class="language-markup line-numbers-mode"><pre class="language-markup"><code>...

find_package(rosidl_default_generators REQUIRED)

rosidl_generate_interfaces(${PROJECT_NAME}
  &quot;action/MoveCircle.action&quot;
)

...
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="通信模型-3"><strong>通信模型</strong></h3> <p>通信模型就是这样，客户端发送给一个动作目标，服务器控制机器人开始运动，并周期反馈，结束后反馈结束信息。</p> <p><a href="https://book.guyuehome.com/ROS2/2.%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5/image/2.7_%E5%8A%A8%E4%BD%9C/image-20220528010217043.png" target="_blank" rel="noopener noreferrer"><img src="https://deep-diary.oss-cn-hangzhou.aliyuncs.com/blog/image-20220528010217043.png" alt="image-20220528010217043"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>思路理清楚，接下来开始写代码。相比之前话题和服务的程序，动作通信的例程相对较长，我们一起来运行并分析一下。</p> <h3 id="服务端代码解析-2"><strong>服务端代码解析</strong></h3> <p>learning_action/action_move_server.py</p> <div class="language-markup line-numbers-mode"><pre class="language-markup"><code>#!/usr/bin/env python3
# -*- coding: utf-8 -*-

&quot;&quot;&quot;
@作者: 古月居(www.guyuehome.com)
@说明: ROS2动作示例-负责执行圆周运动动作的服务端
&quot;&quot;&quot;

import time

import rclpy                                      # ROS2 Python接口库
from rclpy.node   import Node                     # ROS2 节点类
from rclpy.action import ActionServer             # ROS2 动作服务器类
from learning_interface.action import MoveCircle  # 自定义的圆周运动接口

class MoveCircleActionServer(Node):
    def __init__(self, name):
        super().__init__(name)                   # ROS2节点父类初始化
        self._action_server = ActionServer(      # 创建动作服务器（接口类型、动作名、回调函数）
            self,
            MoveCircle,
            'move_circle',
            self.execute_callback)

    def execute_callback(self, goal_handle):            # 执行收到动作目标之后的处理函数
        self.get_logger().info('Moving circle...')
        feedback_msg = MoveCircle.Feedback()            # 创建一个动作反馈信息的消息

        for i in range(0, 360, 30):                     # 从0到360度，执行圆周运动，并周期反馈信息
            feedback_msg.state = i                      # 创建反馈信息，表示当前执行到的角度
            self.get_logger().info('Publishing feedback: %d' % feedback_msg.state)
            goal_handle.publish_feedback(feedback_msg)  # 发布反馈信息
            time.sleep(0.5)

        goal_handle.succeed()                           # 动作执行成功
        result = MoveCircle.Result()                    # 创建结果消息
        result.finish = True                            
        return result                                   # 反馈最终动作执行的结果

def main(args=None):                                    # ROS2节点主入口main函数
    rclpy.init(args=args)                               # ROS2 Python接口初始化
    node = MoveCircleActionServer(&quot;action_move_server&quot;) # 创建ROS2节点对象并进行初始化
    rclpy.spin(node)                                    # 循环等待ROS2退出
    node.destroy_node()                                 # 销毁节点对象
    rclpy.shutdown()                                    # 关闭ROS2 Python接口
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br></div></div><p>完成代码的编写后需要设置功能包的编译选项，让系统知道Python程序的入口，打开功能包的setup.py文件，加入如下入口点的配置：</p> <div class="language-markup line-numbers-mode"><pre class="language-markup"><code>    entry_points={
        'console_scripts': [
         'action_move_server    = learning_action.action_move_server:main',
        ],
    },
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="客户端代码解析-2"><strong>客户端代码解析</strong></h3> <p>learning_action/action_move_client.py</p> <div class="language-markup line-numbers-mode"><pre class="language-markup"><code>#!/usr/bin/env python3
# -*- coding: utf-8 -*-

&quot;&quot;&quot;
@作者: 古月居(www.guyuehome.com)
@说明: ROS2动作示例-请求执行圆周运动动作的客户端
&quot;&quot;&quot;

import rclpy                                      # ROS2 Python接口库
from rclpy.node   import Node                     # ROS2 节点类
from rclpy.action import ActionClient             # ROS2 动作客户端类

from learning_interface.action import MoveCircle  # 自定义的圆周运动接口

class MoveCircleActionClient(Node):
    def __init__(self, name):
        super().__init__(name)                   # ROS2节点父类初始化
        self._action_client = ActionClient(      # 创建动作客户端（接口类型、动作名）
            self, MoveCircle, 'move_circle') 

    def send_goal(self, enable):                 # 创建一个发送动作目标的函数
        goal_msg = MoveCircle.Goal()             # 创建一个动作目标的消息
        goal_msg.enable = enable                 # 设置动作目标为使能，希望机器人开始运动

        self._action_client.wait_for_server()    # 等待动作的服务器端启动
        self._send_goal_future = self._action_client.send_goal_async(   # 异步方式发送动作的目标
            goal_msg,                                                   # 动作目标
            feedback_callback=self.feedback_callback)                   # 处理周期反馈消息的回调函数

        self._send_goal_future.add_done_callback(self.goal_response_callback) # 设置一个服务器收到目标之后反馈时的回调函数

    def goal_response_callback(self, future):           # 创建一个服务器收到目标之后反馈时的回调函数
        goal_handle = future.result()                   # 接收动作的结果
        if not goal_handle.accepted:                    # 如果动作被拒绝执行
            self.get_logger().info('Goal rejected :(')
            return

        self.get_logger().info('Goal accepted :)')                            # 动作被顺利执行

        self._get_result_future = goal_handle.get_result_async()              # 异步获取动作最终执行的结果反馈
        self._get_result_future.add_done_callback(self.get_result_callback)   # 设置一个收到最终结果的回调函数 

    def get_result_callback(self, future):                                    # 创建一个收到最终结果的回调函数
        result = future.result().result                                       # 读取动作执行的结果
        self.get_logger().info('Result: {%d}' % result.finish)                # 日志输出执行结果

    def feedback_callback(self, feedback_msg):                                # 创建处理周期反馈消息的回调函数
        feedback = feedback_msg.feedback                                      # 读取反馈的数据
        self.get_logger().info('Received feedback: {%d}' % feedback.state) 

def main(args=None):                                       # ROS2节点主入口main函数
    rclpy.init(args=args)                                  # ROS2 Python接口初始化
    node = MoveCircleActionClient(&quot;action_move_client&quot;)    # 创建ROS2节点对象并进行初始化
    node.send_goal(True)                                   # 发送动作目标
    rclpy.spin(node)                                       # 循环等待ROS2退出
    node.destroy_node()                                    # 销毁节点对象
    rclpy.shutdown()                                       # 关闭ROS2 Python接口
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br></div></div><p>完成代码的编写后需要设置功能包的编译选项，让系统知道Python程序的入口，打开功能包的setup.py文件，加入如下入口点的配置：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-markup line-numbers-mode"><pre class="language-markup"><code>    entry_points={
        'console_scripts': [
         'action_move_client    = learning_action.action_move_client:main',
         'action_move_server    = learning_action.action_move_server:main',
        ],
    },
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="动作命令行操作"><strong>动作命令行操作</strong></h3> <p>动作命令的常用操作如下：</p> <div class="language-markup line-numbers-mode"><pre class="language-markup"><code>$ ros2 action list                  # 查看服务列表
$ ros2 action info <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>action_name</span><span class="token punctuation">&gt;</span></span>    # 查看服务数据类型
$ ros2 action send_goal <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>action_name</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>action_type</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>action_data</span><span class="token punctuation">&gt;</span></span>   # 发送服务请求
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><a href="https://book.guyuehome.com/ROS2/2.%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5/image/2.7_%E5%8A%A8%E4%BD%9C/image-20220528005935269.png" target="_blank" rel="noopener noreferrer"><img src="https://deep-diary.oss-cn-hangzhou.aliyuncs.com/blog/image-20220528005935269.png" alt="image-20220528005935269"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="parameter">parameter</h2> <p><a href="https://www.guyuehome.com/38291" target="_blank" rel="noopener noreferrer">ROS2,ROS2教程,ROS2入门,ROS通信机制,ROS动作通信 - 古月居 (guyuehome.com)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="distributed-communication">distributed communication</h2> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>~.bashrc
<span class="token builtin class-name">export</span> <span class="token assign-left variable">ROS_DOMAIN_ID</span><span class="token operator">=</span><span class="token number">31</span>
<span class="token builtin class-name">source</span> .bashrc  生效脚本
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="dds">DDS</h2> <h2 id="launch">launch</h2> <p><a href="https://www.guyuehome.com/38308" target="_blank" rel="noopener noreferrer">《ROS2入门21讲图文教程 | 17、Launch：多节点启动与配置脚本》 - 古月居 (guyuehome.com)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="tf-机器人坐标系管理神器">TF: 机器人坐标系管理神器</h2> <h2 id="urdf-ros机器人建模方法">URDF：ROS机器人建模方法</h2> <h2 id="gazebo-三维物理仿真平台">Gazebo: 三维物理仿真平台</h2> <h2 id="rviz-三维可视化显示平台">Rviz: 三维可视化显示平台</h2> <h2 id="rqt-模块化可视工具">RQT: 模块化可视工具</h2> <h1 id="questions">questions</h1> <h2 id="ros中订阅-subscribe-最新消息以及消息队列相关问题">ROS中订阅（Subscribe）最新消息以及消息队列相关问题</h2> <p>​        机器人应用中难免会遇到运算起来很费时间的操作，比如图像的特征提取、点云的匹配等等。有时候，不可避免地，我们需要在ROS的Subscriber的Callback回调函数中进行这些费时的操作。Subscriber所订阅的消息的发布频率可能是很高的，而这些操作的运算速度肯定达不到消息发布的速度。所以，如果我们要是没有取舍的对于每个消息都调用一次回调函数，那么势必会导致计算越来越不实时，很有可能当下在处理的还是几十秒以前的数据。所以，我们希望每次回调函数都处理当前时刻最新的一个消息，这就是我们的目标。</p> <div class="language- extra-class"><pre><code>    要达到这个目标有三点，第一点是要设置Publisher的queue_size等于1；第二点是要设置Subscriber的queue_size（消息队列大小）等于1；第三点非常重要，要设置Subscriber的buff_size（缓冲区大小）足够大，大于一个消息的大小。像这样：
</code></pre></div><div class="language-python line-numbers-mode"><pre class="language-python"><code>pcdpub <span class="token operator">=</span> rospy<span class="token punctuation">.</span>Publisher<span class="token punctuation">(</span><span class="token string">&quot;lidardata&quot;</span><span class="token punctuation">,</span> PointCloud<span class="token punctuation">,</span> queue_size<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
rospy<span class="token punctuation">.</span>Subscriber<span class="token punctuation">(</span><span class="token string">&quot;lidardata&quot;</span><span class="token punctuation">,</span> PointCloud<span class="token punctuation">,</span> self<span class="token punctuation">.</span>pcd_resolve_callback<span class="token punctuation">,</span>queue_size<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>buff_size<span class="token operator">=</span><span class="token number">52428800</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="subscriber和publisher的消息队列起什么作用-队列的大小有什么影响">Subscriber和Publisher的消息队列起什么作用，队列的大小有什么影响？</h3> <p>​        简单描述一下，Publisher的消息队列是为了缓存发布节点发布的消息，一旦队列中消息的数量超过了queue_size，那么最先进入队列的（最老的）消息被舍弃。Subscriber的消息队列是为了缓存节点接收到的信息，一旦自己处理的速度过慢，接收到的消息数量超过了queue_size，那么最先进入队列的（最老的）消息会被舍弃。所以，我们想只处理最新的消息，实际上只需要把两个queue_size都设置成1，那么系统不会缓存数据，自然处理的就是最新的消息。</p> <h3 id="subscriber有消息队列缓存消息了-为什么publisher还要有消息队列">Subscriber有消息队列缓存消息了，为什么Publisher还要有消息队列？</h3> <p>​        在我看来，Publisher的消息队列是一定要有的，因为ROS中发布节点往外发送消息是基于Topic发送，而不是直接向Subscriber订阅者发送，所以必须要有一个消息队列来存放发布的消息，以供订阅者来获取。而且这个消息队列的好处是在网络差、带宽小、延时高的时候，保证数据不容易丢失。</p> <h3 id="既然publisher有消息队列了-为什么subscriber还要有消息队列">既然Publisher有消息队列了，为什么Subscriber还要有消息队列？</h3> <p>​        这个问题比较难一点。我的理解是，由于ROS毕竟是分布式系统，Publisher和Subscriber不一定在同一台主机上，因此消息需要通过网络来交换。但是网络的性能时好时坏，如果Subscriber没有消息队列，那么每次运行Callback函数前都要先通过网络取回消息，然后才能处理。当网络很差时，就会让系统堵塞。而有消息队列的话，Subscriber就可以一边处理队列中的消息，一边通过网络缓存新的消息，而不用每次处理消息前都要临时去读一个回来。这样就增加了系统的可靠性。</p> <h3 id="为什么要设置缓冲区的大小">为什么要设置缓冲区的大小？</h3> <p>​        这个缓冲区的大小是指消息队列使用的缓冲区物理内存空间大小。如果这个空间小于一个消息所需要的空间，比如消息是一副图片或者一帧点云，数据量超过了缓冲区的大小。这个时候为了保证通信不发生错误，就会触发网络通信的保护机制，TCP的Buffer会为你缓存消息。这种机制就会导致每一帧消息都被完整的缓存下来，没有消息被丢弃，感觉上就像queue_size被设置成了无穷大。详细说明请参考：
Ros subscriber not up to date
rospy subscriber queue_size acting strange when buff_size is too small</p> <h3 id="消息队列的运行机制">消息队列的运行机制</h3> <p>这里只能说是我的理解了，因为没有看过源代码。
首先，发布节点把消息发布，消息进入Publisher的消息队列，同时通知订阅了该话题消息的Subscriber来取消息。
其次，Subscriber来Publisher的消息队列里取消息，但取走的也是最老的消息，因为毕竟这是先入先出的队列。这也是为什么Publisher的消息队列的大小也要设置为1。
最后，被取走的消息存放入了Subscriber的消息队列中，等待被Callback执行。如果Callback执行很慢，消息越堆越多，最老的消息会逐渐被顶替。
当然，这里究竟是Subscriber来取消息，还是Publisher直接把消息推给Subscriber，我只是猜测，反正这里交换的消息肯定不是最新的消息，而是队列里最老的消息。</p> <h2 id="launch文件的写法">launch文件的写法</h2> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token comment">&lt;!-- 启动mbot --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>node</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>robot_bringup<span class="token punctuation">&quot;</span></span> <span class="token attr-name">pkg</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>robot_bringup<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>robot_bringup<span class="token punctuation">&quot;</span></span> <span class="token attr-name">output</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>screen<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
 
<span class="token comment">&lt;!-- 加载机器人模型参数 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>robot_description<span class="token punctuation">&quot;</span></span> <span class="token attr-name">command</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>$(find xacro)/xacro --inorder <span class="token punctuation">'</span>$(find robot_description)/xacro/robot_with_laser.xacro<span class="token punctuation">'</span><span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
 
<span class="token comment">&lt;!-- 运行joint_state_publisher节点，发布机器人的关节状态 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>node</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>joint_state_publisher<span class="token punctuation">&quot;</span></span> <span class="token attr-name">pkg</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>joint_state_publisher<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>joint_state_publisher<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token comment">&lt;!-- 运行robot_state_publisher节点，发布tf --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>node</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>state_publisher<span class="token punctuation">&quot;</span></span> <span class="token attr-name">pkg</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>robot_state_publisher<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>robot_state_publisher<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>publish_frequency<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>double<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>50.0<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>node</span><span class="token punctuation">&gt;</span></span>
 
<span class="token comment">&lt;!-- 运行激光雷达驱动 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span> <span class="token attr-name">file</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>$(find robot_bringup)/launch/rplidar.launch<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h2 id="ros1通信模型">ros1通信模型</h2> <ul><li>talker注册</li> <li>listener注册</li> <li>ROS Master进行信息匹配</li> <li>listener 发送链接请求</li> <li>talker确认请求</li> <li>建立连接</li> <li>talker给listener发数据</li></ul> <p>6、ROS基础</p> <h2 id="ros的总体设计目标">ROS的总体设计目标</h2> <p><img src="https://deep-diary.oss-cn-hangzhou.aliyuncs.com/blog/20210812214936688.png" alt="img"></p> <h2 id="ros的应用框架是怎样的">ROS的应用框架是怎样的？</h2> <p>​        <img src="https://deep-diary.oss-cn-hangzhou.aliyuncs.com/blog/20210812215038888.png" alt="img"></p> <p>总结：ROS就是一个为了提高机器人开发的软件复用率，开发的一款具有独特的通信机制、丰富的开发工具、海量的应用功能、良好的生态系统集的工具。</p> <p>​</p> <h2 id="如何新建一个工作空间">如何新建一个工作空间？</h2> <p>​        最基础的功能包都不会写，怎么意思说学过ROS：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> ~/catkin_test_ws/src                                        <span class="token comment">#进入存放功能包的地方</span>
catkin_create_pkg test_package std_msgs roscpp rospy           <span class="token comment">#创建名字为test_package的功能包，添加std_msgs roscpp rospy依赖</span>
<span class="token builtin class-name">cd</span> ~/catkin_test_ws                                            
catkin_make                                                    <span class="token comment">#编译</span>
<span class="token builtin class-name">source</span> devel/setup.bash              						   <span class="token comment">#新建功能包刷新环境变量，才能找到功能包</span>
rospack profile                                                <span class="token comment">#如果还是找不到功能包，使用该命令刷新功能包路径</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>​        需要注意一点，同一个工作空间下不能存在同名功能包，不同的工作空间下可以存在同名功能包。但是要注意一个问题，ROS运行时会优先选择最前端工作空间的同名功能包。为了避免出现想不到的问题，所有工作空间尽量不使用同名功能包。</p> <div class="language- extra-class"><pre><code>    功能包的名称尽量按照a_b_c的格式书写，否则，编译过程将会出现警告。
</code></pre></div><h2 id="如何新建一个功能包">如何新建一个功能包？</h2> <p>​        这也是需要每个人都要会的，连个最基础的功能包都不会写，怎么好意思说学过ROS？</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> ~/catkin_test_ws/src                                        <span class="token comment">#进入存放功能包的地方</span>
catkin_create_pkg test_package std_msgs roscpp rospy           <span class="token comment">#创建名字为test_package的功能包，添加std_msgs roscpp rospy依赖</span>
<span class="token builtin class-name">cd</span> ~/catkin_test_ws                                            
catkin_make                                                    <span class="token comment">#编译</span>
<span class="token builtin class-name">source</span> devel/setup.bash              						   <span class="token comment">#新建功能包刷新环境变量，才能找到功能包</span>
rospack profile                                                <span class="token comment">#如果还是找不到功能包，使用该命令刷新功能包路径        这里需要注意一点，同一个工作空间下不能存在同名功能包，不同的工作空间下可以存在同名功能包。但是要注意一个问题，ROS运行时会优先选择最前端工作空间的同名功能包。为了避免出现意想不到的问题，所以工作空间尽量不使用同名功能包。</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language- extra-class"><pre><code>    功能包的名称尽量按照a_b_c的格式书写，否则，编译过程将会出现警告。
</code></pre></div><h2 id="如何新建一个ros节点">如何新建一个ROS节点？</h2> <p>接着上面的测试功能包，我们在功能包的src文件下新建test.cpp文件：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> ~/catkin_test_ws/src/test_package/src/
<span class="token function">vim</span> test.cpp
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>然后就是ROS节点的模板程序，都是在模板程序之上做的修改。</p> <div class="language-c++ line-numbers-mode"><pre class="language-text"><code>#include &quot;ros/ros.h&quot;                    //引入ROS头文件
 
int main(int argc,char **argv)
{
	ros::init(argc,argv,&quot;test&quot;);        //初始化ROS节点
	
	ros::NodeHandle nh;                 //创建ROS句柄
 
	ros::Rate loop_rate(10);            //定义循环频率 10HZ
 
	while(ros::ok())
	{
		std::cout&lt;&lt; &quot;hello ros&quot; &lt;&lt;std::endl;
		loop_rate.sleep();             //按照循环速率延时
	}
	return 0;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><div class="language- extra-class"><pre><code>到这里，然后编译就可以了？这个功能包的编译还需要修改对应的CMakeLIsts.txt文件，一般为三步。

设置需要编译的代码和生成的可执行文件；

设置链接库；

设置依赖；

所以我们修改功能包下的CMakeLIsts.txt文件，一般功能包会自动生成CMakeLists.txt文件内容，我们进行修改即可。
</code></pre></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>add_executable<span class="token punctuation">(</span><span class="token variable">${PROJECT_NAME}</span>_node src/test.cpp<span class="token punctuation">)</span>                             <span class="token comment">#这里注意自动生成的源文件名字一般不对，一定要修改成对的名字</span>
target_link_libraries<span class="token punctuation">(</span><span class="token variable">${PROJECT_NAME}</span>_node <span class="token variable">${catkin_LIBRARIES}</span><span class="token punctuation">)</span>
add_dependencies<span class="token punctuation">(</span><span class="token variable">${PROJECT_NAME}</span>_node <span class="token variable">${${PROJECT_NAME}</span>_EXPORTED_TARGETS<span class="token punctuation">}</span> <span class="token variable">${catkin_EXPORTED_TARGETS}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>这里因为我们没有自定义的消息或者服务类型，所以其他的地方不做更改，如果使用了自定义的消息或者服务类型，注意修改其他的地方。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> ~/catkin_test_ws                                            
catkin_make                                                    <span class="token comment">#编译</span>
此时~/catkin_test_ws/devel/lib/test_package目录下生成了test_package_node的可执行文件
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>​        执行功能包，在使用rosrun执行功能包之前，使用roscore启动rosmaster。启动rosmaster是启动一切ros节点的前提。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>roscore            <span class="token comment">#启动rosmaster</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>打开一个新终端启动，test_package功能包下的test_package_node节点。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>rosrun test_package test_package_node
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>终端循环打印hello ros，一个新的ros节点就创建完成了。</p> <h2 id="如何在一个ros节点文件中调用其他的源文件">如何在一个ros节点文件中调用其他的源文件？</h2> <p>​    这个问题很常见，但是他不应该是个问题，但是发现一些小伙伴还是不太会操作。我们在开发的过程中，随着程序的不断扩大，模块化编程肯定必不可少。有时，我们要调用别人写好的特定功能的源文件，这个时候我们应该怎么做吗？</p> <div class="language- extra-class"><pre><code>    首先，将你需要的源文件复制到你需要编写的功能包的src文件夹下，规范地讲，.hpp文件应该放到include文件下，如果文件比较少，也没有必要，和.cpp文件放在一起也可以。

    ros节点源文件只需要添加你复制的头文件下就行了，函数自己调用就行了。

    CMakeLists.txt文件需要做相应的修改，添加你添加的文件名字，放在ros节点文件后面，如下所示：
</code></pre></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>add_executable<span class="token punctuation">(</span><span class="token variable">${PROJECT_NAME}</span>_node src/test.cpp src/test2.cpp src/test3.cpp<span class="token punctuation">)</span>   

<span class="token comment">#这里注意自动生成的源文件名字一般不对，一定要修改成对的名字</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>然后，编译就行了。</p> <h2 id="如何设置两台机器的分布式通信">如何设置两台机器的分布式通信？</h2> <p>​        ROS是一种分布式软件框架，节点之间通过松耦合的方式进行组合。</p> <div class="language- extra-class"><pre><code>    如何设置两台机器的分布式通信呢？

    首先，确保两台机器在同一局域网下，查看各自的ip地址。
</code></pre></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">ifconfig</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>然后，各自安装ssh，确保ssh服务，开机自启动。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> openssh-server                  <span class="token comment">#安装ssh服务端</span>
<span class="token function">sudo</span> <span class="token function">service</span> <span class="token function">ssh</span> start                               <span class="token comment">#开启ssh服务</span>
ssh服务开机不会自动启动，需要设置开机自启动
在开机自启动脚本/etc/rc.local加入下面这条命令，注意加入位置是在exit <span class="token number">0</span>这一句之前，加上service <span class="token function">ssh</span> start
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>​        然后，在两台机器的/etc/hosts文件中，添加对方的ip地址，通过ping命令，互相测试是否连通。比如在hosts添加，对方机器IP对方机器名。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token number">192.168</span>.1.5   对方机器名
<span class="token function">ping</span> 对方机器名或者对方机器ip        <span class="token comment">#ping测试</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>然后，在从机端的~/.bashrc文件末尾设置ROS_MASTER_URI，确保从机可以找到主机。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">export</span> <span class="token assign-left variable">ROS_MASTER_URI</span><span class="token operator">=</span>http://主机名称:11311最后，在从机端使用ssh用户名@IP地址，输入密码，连接远程终端。 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="ros开发常用的工具">ROS开发常用的工具</h2> <p>​        launch文件，可以同时启动多个ros节点，可自动启动rosmaster。关于launch的细节，自己学习就好。</p> <div class="language- extra-class"><pre><code>    TF坐标变换，用来描述机器人系统中繁杂的坐标系。

    QT工具箱，用来可视化各个ros节点之间的订阅或者请求关系或者可视化各种话题的数据。常用命令，rqt_graph、rqt_plot，而且还可以动态修改部分参数。

    rqt_reconfigure（不常用）。

    rviz可视化平台，机器人可视化平台，几乎是最常用的工具。使用rviz命令启动。
</code></pre></div><p><img src="https://deep-diary.oss-cn-hangzhou.aliyuncs.com/blog/20210812225612440.png" alt="img"></p> <p>Gazebo物理仿真环境，可对机器人进行三维物理仿真。需要仿真的同学常用。</p> <h2 id="ros的常用命令">ROS的常用命令</h2> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment">#最常用</span>
roscore                    <span class="token comment">#启动rosmaster</span>
rosrun  pkg_name node_name <span class="token comment">#启动ros节点</span>
roslaunch pkg_name launch_files_name <span class="token comment">#启动launch文件</span>
catkin_make                <span class="token comment">#编译工作空间</span>
rospack profile            <span class="token comment">#刷新功能包路径</span>
 
<span class="token comment">#环境变量</span>
<span class="token builtin class-name">echo</span> <span class="token variable">$ROS_PACKAGE_PATH</span>     <span class="token comment">#打印ros环境变量</span>
<span class="token builtin class-name">export</span> <span class="token operator">|</span> <span class="token function">grep</span> ROS          <span class="token comment">#确认环境变量已经设置正确</span>
<span class="token builtin class-name">source</span> devel/setup.bash    <span class="token comment">#刷新环境变量</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;source ~/catkin_test_ws/devel/setup.bash&quot;</span> <span class="token operator">&gt;&gt;</span> ~/.bashrc    <span class="token comment">#刷新环境变量，永久有效</span>
<span class="token builtin class-name">source</span> ~/.bashrc                                                <span class="token comment">#生效上一句</span>
 
<span class="token comment">#功能包</span>
catkin_create_pkg test_package std_msgs roscpp rospy            <span class="token comment">#创建名字为test_package的功能包，添加std_msgs roscpp rospy依赖</span>
rospack list               <span class="token comment">#查看软件包列表</span>
rospack <span class="token function">find</span> package-name  <span class="token comment">#定位软件包</span>
roscd package-name         <span class="token comment">#切换到指定功能包目录</span>
 
<span class="token comment">#话题</span>
rostopic list              <span class="token comment">#输出当前运行的topic列表</span>
rostopic info topic-name   <span class="token comment">#查看话题信息</span>
rostopic <span class="token builtin class-name">echo</span> topic-name   <span class="token comment">#输出话题数据</span>
rostopic hz topic-name     <span class="token comment">#每秒发布的消息数量</span>
rostopic bw topic-name     <span class="token comment">#每秒发布信息所占的字节量</span>
 
<span class="token comment">#工具</span>
rviz                       <span class="token comment">#启动rviz</span>
rqt_graph                  <span class="token comment">#可视化节点关系</span>
rqt_plot                   <span class="token comment">#可视化话题数据</span>
rosrun rqt_tf_tree rqt_tf_tree <span class="token comment">#查看tf树</span>
 
<span class="token comment">#数据记录与播放</span>
rosbag record -a           <span class="token comment">#录制所有topic到bag文件</span>
rosbag play bag_files_name <span class="token comment">#播放bag文件</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><p>版权声明：本文为CSDN博主「家门Jm」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。
原文链接：https://blog.csdn.net/qq_38167930/article/details/119168048</p></div> <footer class="page-edit" style="display:none;"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">4/13/2023, 10:02:01 PM</span></div></footer> <!----> <!----></main> <!----> <div class="comments-wrapper" data-v-4698c43e><!----></div></div></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-44bd5a18 data-v-44bd5a18><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-44bd5a18><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-44bd5a18></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-44bd5a18></path></svg></div><!----><div></div><!----><div class="reco-bgm-panel" data-v-b1d3339e><audio id="bgm" src="https://music.163.com/song/media/outer/url?id=316756.mp3" data-v-b1d3339e></audio> <div class="reco-float-box" style="bottom:200px;z-index:999999;display:none;" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><img src="https://p2.music.126.net/qOOTIykbSLw9RHB0vI83GA==/737772302281958.jpg" data-v-b1d3339e></div> <div class="reco-bgm-box" style="left:10px;bottom:10px;z-index:999999;" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><div class="reco-bgm-cover" style="background-image:url(https://p2.music.126.net/qOOTIykbSLw9RHB0vI83GA==/737772302281958.jpg);" data-v-b1d3339e><div class="mini-operation" style="display:none;" data-v-b1d3339e><i class="reco-bgm reco-bgm-pause" style="display:none;" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-play" style="display:none;" data-v-b1d3339e></i></div> <div class="falut-message" style="display:none;" data-v-b1d3339e>
          播放失败
        </div></div> <div class="reco-bgm-info" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><div class="info-box" data-v-b1d3339e><i class="reco-bgm reco-bgm-music music" data-v-b1d3339e></i>大城小事</div> <div class="info-box" data-v-b1d3339e><i class="reco-bgm reco-bgm-artist" data-v-b1d3339e></i>杨千嬅</div> <div class="reco-bgm-progress" data-v-b1d3339e><div class="progress-bar" data-v-b1d3339e><div class="bar" data-v-b1d3339e></div></div></div> <div class="reco-bgm-operation" data-v-b1d3339e><i class="reco-bgm reco-bgm-last last" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-pause pause" style="display:none;" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-play play" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-next next" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-volume1 volume" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-mute mute" style="display:none;" data-v-b1d3339e></i> <div class="volume-bar" data-v-b1d3339e><div class="bar" data-v-b1d3339e></div></div></div></div> <div class="reco-bgm-left-box" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><i class="reco-bgm reco-bgm-left" data-v-b1d3339e></i></div></div></div><!----></div></div>
    <script src="/assets/js/app.b92d5d04.js" defer></script><script src="/assets/js/4.5e854a94.js" defer></script><script src="/assets/js/1.650e7656.js" defer></script><script src="/assets/js/16.ca06e55e.js" defer></script><script src="/assets/js/10.51e38269.js" defer></script>
  </body>
</html>
